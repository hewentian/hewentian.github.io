<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="my personal blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Tim Ho&#39;s Technology Blog">
<meta property="og:url" content="https://github.com/hewentian/page/4/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="my personal blog">
<meta property="og:locale" content="en-US">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tim Ho&#39;s Technology Blog">
<meta name="twitter:description" content="my personal blog">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-solr-ikanalyzer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/08/solr-ikanalyzer/" class="article-date">
  <time datetime="2018-01-08T08:07:17.000Z" itemprop="datePublished">2018-01-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/08/solr-ikanalyzer/">solr 配置IKAnalyzer中文分词</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>配置IKAnalyzer的中文分词，基于<code>solr6.5.0</code>：</p>
<p>1、首先下载IKAnalyzer，这是最新的支持solr 6.5，<br><a href="http://files.cnblogs.com/files/wander1129/ikanalyzer-solr5.zip" target="_blank" rel="noopener">http://files.cnblogs.com/files/wander1129/ikanalyzer-solr5.zip</a></p>
<p>在<a href="https://github.com/hewentian/solr-demo/tree/master/docs">这里</a>也有提供</p>
<p>解压后会有四个文件:<br>ext.dic                        为扩展字典<br>stopword.dic                为停止词字典<br>IKAnalyzer.cfg.xml            为配置文件<br>ik-analyzer-solr5-5.x.jar    为分词jar包</p>
<p>2、将文件夹下的IKAnalyzer.cfg.xml, ext.dic和stopword.dic 三个文件复制到<code>/home/hewentian/ProjectD/solr-6.5.0/server/resources</code>目录下（视个人安装solr，而适当修改）<br>注意: 记得将stopword.dic，ext.dic的编码方式为UTF-8 无BOM的编码方式。 </p>
<p>并修改IKAnalyzer.cfg.xml（一般默认即可）<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_dict"</span>&gt;</span>ext.dic;<span class="tag">&lt;/<span class="name">entry</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_stopwords"</span>&gt;</span>stopword.dic;<span class="tag">&lt;/<span class="name">entry</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3、在ext.dic 里增加自己的扩展词典，例如，唯品会 聚美优品</p>
<p>4、复制<code>ik-analyzer-solr5-5.x.jar</code>到<code>/home/hewentian/ProjectD/solr-6.5.0/server/solr-webapp/webapp/WEB-INF/lib</code>目录下</p>
<p>5、在<code>/home/hewentian/ProjectD/solr-6.5.0/server/solr/mysqlCore/conf/managed-schema</code>文件的前增加如下配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 我添加的IK分词 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span> <span class="attr">isMaxWordLength</span>=<span class="string">"false"</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span> <span class="attr">isMaxWordLength</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重启solr:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/solr-6.5.0/bin</span><br><span class="line">$ ./solr stop -all</span><br><span class="line">$ ./solr start</span><br></pre></td></tr></table></figure></p>
<p>在浏览器中打开：<br><a href="http://localhost:8983/solr/#/mysqlCore/analysis" target="_blank" rel="noopener">http://localhost:8983/solr/#/mysqlCore/analysis</a></p>
<p>在Field Value (Index)中输入：中华人民共和国<br>在Analyse Fieldname / FieldType:选择 text_ik</p>
<p>点[Analyse Values]即可看到分词</p>
<p>至此，配置完成。</p>
<h3 id="下面说说配置solr默认的中文分词："><a href="#下面说说配置solr默认的中文分词：" class="headerlink" title="下面说说配置solr默认的中文分词："></a>下面说说配置solr默认的中文分词：</h3><p>1.首先将需要的<code>lucene-analyzers-smartcn-6.5.0.jar</code>复制到<code>WEB-INF/lib/</code>目录下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/solr-6.5.0</span><br><span class="line">$ cp contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-6.5.0.jar server/solr-webapp/webapp/WEB-INF/lib/</span><br></pre></td></tr></table></figure></p>
<p>2、为mysqlCore添加对中文分词的支持，在<code>/home/hewentian/ProjectD/solr-6.5.0/server/solr/mysqlCore/conf/managed-schema</code>文件的前增加如下配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_smartcn"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重启solr测试即可。可以与IK分词的结果作对比。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2018/01/08/solr-ikanalyzer/" data-id="ckpo1myxn002yuu3kuqv5pmv7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-solr-pinyin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/08/solr-pinyin/" class="article-date">
  <time datetime="2018-01-08T06:52:08.000Z" itemprop="datePublished">2018-01-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/08/solr-pinyin/">solr 配置拼音检索</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>配置拼音检索，基于<code>solr6.5.0</code>：</p>
<p>1、前期准备，需要用到pinyin4j-2.5.0.jar、pinyinAnalyzer4.3.1.jar这两个jar包,下载地址：<br><a href="http://files.cnblogs.com/files/wander1129/pinyin.zip" target="_blank" rel="noopener">http://files.cnblogs.com/files/wander1129/pinyin.zip</a></p>
<p>在<a href="https://github.com/hewentian/solr-demo/tree/master/docs">这里</a>也有提供pinyin.zip</p>
<p>解压后会有2个文件:<br>pinyin4j-2.5.0.jar<br>pinyinAnalyzer4.3.1.jar</p>
<p>2、将上面的两个文件复制到<code>/home/hewentian/ProjectD/solr-6.5.0/server/solr-webapp/webapp/WEB-INF/lib</code>目录下，还有执行如下命令，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/solr-6.5.0</span><br><span class="line">$ cp contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-6.5.0.jar server/solr-webapp/webapp/WEB-INF/lib/</span><br></pre></td></tr></table></figure></p>
<p>将需要的<code>lucene-analyzers-smartcn-6.5.0.jar</code>复制到<code>WEB-INF/lib/</code>目录下</p>
<p>3、在<code>/home/hewentian/ProjectD/solr-6.5.0/server/solr/mysqlCore/conf/managed-schema</code>文件的前增加如下配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_pinyin"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"com.shentong.search.analyzers.PinyinTransformTokenFilterFactory"</span> <span class="attr">minTermLenght</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"com.shentong.search.analyzers.PinyinNGramTokenFilterFactory"</span> <span class="attr">minGram</span>=<span class="string">"1"</span> <span class="attr">maxGram</span>=<span class="string">"20"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"com.shentong.search.analyzers.PinyinTransformTokenFilterFactory"</span> <span class="attr">minTermLenght</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"com.shentong.search.analyzers.PinyinNGramTokenFilterFactory"</span> <span class="attr">minGram</span>=<span class="string">"1"</span> <span class="attr">maxGram</span>=<span class="string">"20"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重启solr:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/solr-6.5.0/bin</span><br><span class="line">$ ./solr stop -all</span><br><span class="line">$ ./solr start</span><br></pre></td></tr></table></figure></p>
<p>4、在浏览器中打开：<br><a href="http://localhost:8983/solr/#/mysqlCore/analysis" target="_blank" rel="noopener">http://localhost:8983/solr/#/mysqlCore/analysis</a></p>
<p>在Field Value (Index)中输入：中国<br>在Analyse Fieldname / FieldType:选择 text_pinyin</p>
<p>点[Analyse Values]即可看到分词</p>
<p>至此，配置完成。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2018/01/08/solr-pinyin/" data-id="ckpo1myxm002vuu3k2zgrf0vu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-jdk-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/08/jdk-install/" class="article-date">
  <time datetime="2017-12-08T03:44:06.000Z" itemprop="datePublished">2017-12-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/08/jdk-install/">安装 JDK</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="下面分别说说在Windows和Linux平台下面安装JDK"><a href="#下面分别说说在Windows和Linux平台下面安装JDK" class="headerlink" title="下面分别说说在Windows和Linux平台下面安装JDK"></a>下面分别说说在<code>Windows</code>和<code>Linux</code>平台下面安装<code>JDK</code></h2><h3 id="1-在Windows下面安装JDK"><a href="#1-在Windows下面安装JDK" class="headerlink" title="1.在Windows下面安装JDK"></a>1.在<code>Windows</code>下面安装<code>JDK</code></h3><pre><code>JDK环境变量配置的步骤如下：
1. 我的电脑 -&gt; 属性 -&gt; 高级 -&gt; 环境变量；
2. 配置用户变量：
    a.新建 JAVA_HOME
    C:\Program Files\Java\jdk1.8.0_101 （JDK的安装路径，务必替换成你自已的）
    b.新建 PATH（如果系统本身已有，则修改，加入下面的代码）
    %JAVA_HOME%\bin;%JAVA_HOME%\jre\bin
    c.新建 CLASSPATH
    .;%JAVA_HOME%\lib;%JAVA_HOME%\lib\tools.jar
3. 测试环境变量配置是否成功：
    开始 -&gt; 运行 -&gt; cmd
    键盘敲入: java
出现相应的命令，而不是出错信息，即表示配置成功！
</code></pre><p>环境变量配置的理解：</p>
<ol>
<li>PATH：作用是指定命令搜索路径，在命令行下面执行命令如：<code>javac</code>编译<code>java</code>程序时，它会到<code>PATH</code>变量所指定的路径中查找看是否能找到相应的命令程序。我们需要把<code>jdk</code>安装目录下的<code>bin</code>目录增加到现有的<code>PATH</code>变量中，<code>bin</code>目录中包含经常要用到的可执行文件如<code>javac/java/javadoc</code>等待，设置好<code>PATH</code>变量后，就可以在任何目录下执行<code>javac/java</code>等工具了；</li>
<li>CLASSPATH：作用是指定类搜索路径，要使用已经编写好的类，前提当然是能够找到它们了，<code>JVM</code>就是通过<code>CLASSPTH</code>来寻找类的。我们需要把<code>jdk</code>安装目录下的<code>lib子</code>目录中的<code>dt.jar</code>和<code>tools.jar</code>设置到<code>CLASSPATH</code>中，当然，当前目录“<code>.</code>”也必须加入到该变量中；</li>
<li>JAVA_HOME：它指向<code>jdk</code>的安装目录，<code>Eclipse/NetBeans/Tomcat</code>等软件就是通过搜索<code>JAVA_HOME</code>变量来找到并使用安装好的<code>jdk</code>。</li>
</ol>
<h3 id="2-在Linux下面安装JDK"><a href="#2-在Linux下面安装JDK" class="headerlink" title="2.在Linux下面安装JDK"></a>2.在<code>Linux</code>下面安装<code>JDK</code></h3><p>第一步：下载<code>jdk-8u102-linux-x64.tar.gz</code><br>直接在<code>ORACLE</code>的官网中下载就可以:<br><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a><br>PS：要注意系统版本的选择，32位 还是 64位，执行如下命令即可知道答案<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">Linux hewentian-Lenovo-IdeaPad-Y470 4.10.0-28-generic <span class="comment">#32~16.04.2-Ubuntu SMP Thu Jul 20 10:19:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure></p>
<p>第二步：解压安装<br>接着就是解压<code>tar.gz</code>的文件了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/Downloads</span><br><span class="line">$ tar -xzvf jdk-8u102-linux-x64.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>解压后会得到<code>jdk1.8.0_102</code>文件夹，接着就是将解压出来的文件夹移动到<code>/usr/local</code>的目录下<br>在这之前当然需要你拥有root的权限<code>su root</code>(对于ubuntu)再输入root账户的密码，做好这些准备之后，我们就可以把jdk的文件移动到我们想要的位置了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ su root</span><br><span class="line">Password: </span><br><span class="line">$ mv jdk1.8.0_102 /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure></p>
<p>第三步：修改环境变量，若<code>PATH</code>已存在，则用冒号作间隔，将jdk的bin目录地址加上，这样java的环境变量将配置成功了，配置完成如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile </span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_102</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JRE_HOME</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p>
<p>记得保存 后执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>第四步：但这样默认使用的JDK可能还不是我们刚才安装的，因为ubuntu可能还会有默认的jdk，如openjdk；所以，为了使默认使用的是我们安装的jdk，还需执行如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/java java /usr/<span class="built_in">local</span>/jdk1.8.0_102/bin/java 300  </span><br><span class="line">$ sudo update-alternatives --install /usr/bin/javac javac /usr/<span class="built_in">local</span>/jdk1.8.0_102/bin/javac 300    </span><br><span class="line"></span><br><span class="line">$ sudo update-alternatives --config java</span><br><span class="line">$ sudo update-alternatives --config javac</span><br><span class="line">这时如果有多个jdk的话（比如openJDK和SUN JDK），就会出来一个列表，当前默认的会在列表前面有一个<span class="string">"`*`"</span>号，</span><br><span class="line">这时我们就要选择我们刚装的SUN JDK的java的那个序号，输入这个序号，回车就行了。</span><br></pre></td></tr></table></figure></p>
<p>第五步：成功执行命令后，我们安装的JDK就是系统默认的了，执行如下命令，就可以成功看到JDK的相关信息了如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ java -version　</span><br><span class="line">java version <span class="string">"1.8.0_102"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_102-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.102-b14, mixed mode)</span><br></pre></td></tr></table></figure></p>
<p>第六步：在ubuntu下面，可能root用户无法使用JDK，这样的话，执行下面的配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ vi /root/.bashrc</span><br><span class="line"></span><br><span class="line">在文件中加上(注意，下面的变量参数有<span class="variable">$&#123;&#125;</span>的，与上面的不同)</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_102</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$&#123;JRE_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">最后：</span><br><span class="line"><span class="built_in">source</span> /root/.bashrc</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/08/jdk-install/" data-id="ckpo1myx4001buu3kzweskuif" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jdk/">jdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/07/mysql-note/" class="article-date">
  <time datetime="2017-12-07T02:26:13.000Z" itemprop="datePublished">2017-12-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/db/">db</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/07/mysql-note/">mysql 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="mysql-查询重复数据"><a href="#mysql-查询重复数据" class="headerlink" title="mysql 查询重复数据"></a>mysql 查询重复数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_name, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> c </span><br><span class="line"><span class="keyword">FROM</span> user_table </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_name </span><br><span class="line"><span class="keyword">HAVING</span> c &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>当查询几个列的组合的时候，可以这样<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(first_name, <span class="string">'_'</span>, last_name) <span class="keyword">AS</span> user_name, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> c </span><br><span class="line"><span class="keyword">FROM</span> user_table </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_name </span><br><span class="line"><span class="keyword">HAVING</span> c &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>当使用<code>CONCAT(str1,str2,...)</code>函数的时候，只要有一个参数为<code>NULL</code>，则整个结果为<code>NULL</code>，而有时候这不是我们所想要的结果，这时候，我们可以使用<code>IFNULL(expr1,expr2)</code>函数来做一个转换，当<code>expr1</code>为<code>NULL</code>的时候，表达式的结果为<code>expr2</code>，否则为<code>expr1</code>，示例如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONCAT('Tim', ' ', 'Ho') FROM DUAL; # Tim Ho</span><br><span class="line">SELECT IFNULL(NULL, 'expr2') FROM DUAL;    # expr2</span><br><span class="line">SELECT IFNULL('expr1', 'expr2') FROM DUAL; # expr1</span><br></pre></td></tr></table></figure></p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>显示索引信息：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> tableName;</span><br></pre></td></tr></table></figure></p>
<p>创建索引，语法一：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tableName <span class="keyword">ADD</span> <span class="keyword">INDEX</span> indexName(columnName);</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>创建索引，语法二：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> indexName <span class="keyword">ON</span> tableName(columnName(<span class="keyword">length</span>));</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_sex <span class="keyword">ON</span> t_user(sex);</span><br></pre></td></tr></table></figure></p>
<p>如果是CHAR，VARCHAR类型，length可以小于字段实际长度或者省略；如果是BLOB和TEXT类型，必须指定length。</p>
<p>创建索引，语法三：<br>创建表的时候直接指定<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tableName (</span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">columnName <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="keyword">INDEX</span> [indexName] (columnName(<span class="keyword">length</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>删除索引：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> [indexName] <span class="keyword">ON</span> tableName;</span><br></pre></td></tr></table></figure></p>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>创建索引，语法一：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tableName <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> [indexName] (columnName)</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> index_name (<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>创建索引，语法二：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> indexName <span class="keyword">ON</span> tableName(columnName(<span class="keyword">length</span>))</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> t_user(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>表<code>t_user</code>结构如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Field        Type          Collation        Null    Key     Default            Extra           Privileges                       <span class="keyword">Comment</span></span><br><span class="line"><span class="comment">-----------  ------------  ---------------  ------  ------  -----------------  --------------  -------------------------------  ----------------------</span></span><br><span class="line"><span class="keyword">id</span>           <span class="built_in">int</span>(<span class="number">11</span>)       (<span class="literal">NULL</span>)           <span class="keyword">NO</span>      PRI     (<span class="literal">NULL</span>)             auto_increment  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  用户<span class="keyword">ID</span></span><br><span class="line">login_name   <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  <span class="keyword">NO</span>              (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  登录名</span><br><span class="line">passwd       <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  <span class="keyword">NO</span>              (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  登录密码</span><br><span class="line">nick_name    <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  别名</span><br><span class="line">gender       tinyint(<span class="number">4</span>)    (<span class="literal">NULL</span>)           YES             <span class="number">1</span>                                  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  性别：<span class="number">1.</span>男；<span class="number">2.</span>女</span><br><span class="line">phone        <span class="built_in">varchar</span>(<span class="number">20</span>)   utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  手机号码</span><br><span class="line">address      <span class="built_in">varchar</span>(<span class="number">255</span>)  utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  地址</span><br><span class="line">create_time  <span class="keyword">timestamp</span>     (<span class="literal">NULL</span>)           YES             <span class="keyword">CURRENT_TIMESTAMP</span>                  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  创建时间</span><br><span class="line">update_time  <span class="keyword">timestamp</span>     (<span class="literal">NULL</span>)           YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  修改时间</span><br></pre></td></tr></table></figure></p>
<p>给 login_name 和 phone 添加联合唯一约束<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (login_name, phone);</span><br></pre></td></tr></table></figure></p>
<p>你也可以在创建唯一约束的时候，给唯一约束起名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_login_name_phone`</span> (login_name, phone);</span><br></pre></td></tr></table></figure></p>
<p>查看结果：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'用户ID'</span>,</span><br><span class="line">  <span class="string">`login_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'登录名'</span>,</span><br><span class="line">  <span class="string">`passwd`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'登录密码'</span>,</span><br><span class="line">  <span class="string">`nick_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'别名'</span>,</span><br><span class="line">  <span class="string">`gender`</span> tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'性别：1.男；2.女'</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'手机号码'</span>,</span><br><span class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'地址'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'修改时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_login_name_phone`</span> (<span class="string">`login_name`</span>,<span class="string">`phone`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure></p>
<p>删除唯一约束:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">DROP</span> <span class="keyword">INDEX</span> uk_login_name_phone;</span><br></pre></td></tr></table></figure></p>
<h3 id="LIMIT-语句"><a href="#LIMIT-语句" class="headerlink" title="LIMIT 语句"></a>LIMIT 语句</h3><p>取得某一范围的记录集。如前5条、第5到第10条，数据分页等。LIMIT写在查询语句的最后位置上。</p>
<pre><code>语法：
SELECT * FROM tableName LIMIT 长度;
SELECT * FROM tableName LIMIT 起始位置, 长度;
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">2</span> <span class="keyword">LIMIT</span> <span class="number">5</span>;     // 前5条记录</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">2</span> <span class="keyword">LIMIT</span> <span class="number">5</span>, <span class="number">10</span>; // 第5条记录之后的前10条记录，不包括第5条记录</span><br></pre></td></tr></table></figure>
<h3 id="MySQL中GROUP-CONCAT函数"><a href="#MySQL中GROUP-CONCAT函数" class="headerlink" title="MySQL中GROUP_CONCAT函数"></a>MySQL中GROUP_CONCAT函数</h3><p><a href="https://www.mysqltutorial.org/mysql-group_concat/" target="_blank" rel="noopener">https://www.mysqltutorial.org/mysql-group_concat/</a></p>
<p>完整的语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT(</span><br><span class="line">    DISTINCT expression</span><br><span class="line">    ORDER BY expression</span><br><span class="line">    SEPARATOR sep</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>基本查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> aa;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| id| name |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|1 | 10|</span><br><span class="line">|1 | 20|</span><br><span class="line">|1 | 20|</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 200 |</span><br><span class="line">|3 | 500 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，逗号分隔(默认)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(name) |</span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">|1 | 10,20,20|</span><br><span class="line">|2 | 20 |</span><br><span class="line">|3 | 200,500|</span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，分号分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">name</span> separator <span class="string">';'</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(name separator ';') |</span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">|1 | 10;20;20 |</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 200;500 |</span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把去冗余的name字段的值打印在一行，逗号分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">distinct</span> <span class="keyword">name</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(distinct name) |</span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">|1 | 10,20|</span><br><span class="line">|2 | 20 |</span><br><span class="line">|3 | 200,500 |</span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，逗号分隔，以name排倒序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">name</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">DESC</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(name ORDER BY name DESC) |</span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">|1 | 20,20,10 |</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 500,200|</span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="GROUP-CONCAT使用及报错分析"><a href="#GROUP-CONCAT使用及报错分析" class="headerlink" title="GROUP_CONCAT使用及报错分析"></a>GROUP_CONCAT使用及报错分析</h3><p>函数GROUP_CONCAT，但在使用时，结果报了如下错误。</p>
<pre><code>ERROR 1260 (HY000): Row 17 was cut by GROUP_CONCAT()
</code></pre><p>原因：GROUP_CONCAT截断了结果，GROUP_CONCAT有个最大长度的限制，超过最大长度就会被截断掉。可以用下面命令查看其内存限制。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @@global.group_concat_max_len;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">| @@global.group_concat_max_len |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">|                      1024     |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>1024这就是一般MySQL系统默认的最大长度，解决限制方法有二：<br>方法一：在MySQL配置文件中加上<br>group_concat_max_len = 102400 #你要的最大长度</p>
<p>方法二：可以简单一点，执行语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> group_concat_max_len=<span class="number">102400</span>;</span><br></pre></td></tr></table></figure></p>
<p>我是用方法一解决的</p>
<h3 id="对连接要注意的事项"><a href="#对连接要注意的事项" class="headerlink" title="对连接要注意的事项"></a>对连接要注意的事项</h3><p>当用多个值连接起来产生一个MD5值、或其他用于确定唯一性的时候，几个值之间一定要加分隔符，否则不同记录可能会产生一样的MD5值。如下表：</p>
<pre><code>NAME    AGE    FAMLY_NUM
张三    51     5
李四    5      15
</code></pre><p>如果用AGE， FAMLY_NUM来产生一个MD5值来唯一确定这一条记录，在它们之间一定要加分隔符，否则连接结果都是515</p>
<h3 id="mysql禁用root远程登录"><a href="#mysql禁用root远程登录" class="headerlink" title="mysql禁用root远程登录"></a>mysql禁用root远程登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM mysql.user WHERE User=<span class="string">'root'</span> AND Host NOT IN (<span class="string">'localhost'</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>);</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h3 id="创建数据库用户并授权"><a href="#创建数据库用户并授权" class="headerlink" title="创建数据库用户并授权"></a>创建数据库用户并授权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> bfg_user <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'gXk9IDpybrJPVMKq'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="comment">-- GRANT ALL PRIVILEGES ON *.* TO 'bfg_user'@'%';</span></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>在MYSQL中用<code>数据库管理员</code>用户创建了一个db，其他MYSQL用户是暂时看不到的，除非得到<code>数据库管理员</code>用户的授权<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> bfg_db <span class="keyword">COLLATE</span> = <span class="string">'utf8mb4_general_ci'</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = <span class="string">'utf8mb4'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> bfg_db.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'gXk9IDpybrJPVMKq'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> bfg_db.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'gXk9IDpybrJPVMKq'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="查看用户的权限"><a href="#查看用户的权限" class="headerlink" title="查看用户的权限"></a>查看用户的权限</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW GRANTS;</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">| Grants for canal@%                                                        |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">| <span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'canal'</span>@<span class="string">'%'</span> |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h3><p>删除数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> databaseName;</span><br></pre></td></tr></table></figure></p>
<p>显示所有数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>;</span><br></pre></td></tr></table></figure></p>
<p>进入某一个数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> databaseName;</span><br></pre></td></tr></table></figure></p>
<p>显示所有表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br></pre></td></tr></table></figure></p>
<p>查看指定表的结构<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC tableName;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql添加、删除主键"><a href="#mysql添加、删除主键" class="headerlink" title="mysql添加、删除主键"></a>mysql添加、删除主键</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">添加自增长的主键id</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">删除自增长的主键id，先删除自增长，再删除主键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>); //删除自增长</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>; //删除主建</span><br></pre></td></tr></table></figure>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>创建插入记录的存储过程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE IF EXISTS `proc_insert_student`$$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE `proc_insert_student`(_sname VARCHAR(20), _sex TINYINT(4), _age INT)</span><br><span class="line">BEGIN</span><br><span class="line">    INSERT INTO student(sname, sex, age) VALUES(_sname, _sex, _age);</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>创建统计数据的存储过程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE IF EXISTS `proc_count_student`$$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE `proc_count_student`(OUT cs INT)</span><br><span class="line">BEGIN</span><br><span class="line">    # CALL proc_count_student(@cs)</span><br><span class="line">    SELECT COUNT(*) INTO cs FROM student;</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>查看数据库中的存储过程<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW PROCEDURE STATUS;</span><br><span class="line">+<span class="comment">--------+---------------------+-----------+------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| Db     | Name                | Type      | Definer    | Modified            | Created             | Security_type | <span class="keyword">Comment</span> | character_set_client | collation_connection | <span class="keyword">Database</span> <span class="keyword">Collation</span> |</span><br><span class="line">+<span class="comment">--------+---------------------+-----------+------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| bfg_db | proc_count_student  | <span class="keyword">PROCEDURE</span> | bfg_user@% | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">33</span>:<span class="number">15</span> | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">33</span>:<span class="number">15</span> | DEFINER       |         | utf8                 | utf8_general_ci      | utf8_general_ci    |</span><br><span class="line">| bfg_db | proc_insert_student | <span class="keyword">PROCEDURE</span> | bfg_user@% | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">38</span> | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">38</span> | DEFINER       |         | utf8                 | utf8_general_ci      | utf8_general_ci    |</span><br><span class="line">+<span class="comment">--------+---------------------+-----------+------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-删除记录"><a href="#mysql-删除记录" class="headerlink" title="mysql 删除记录"></a>mysql 删除记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="mysql-仅保留-1000-条记录而删除其他记录"><a href="#mysql-仅保留-1000-条记录而删除其他记录" class="headerlink" title="mysql 仅保留 1000 条记录而删除其他记录"></a>mysql 仅保留 1000 条记录而删除其他记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">求取总记录数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"></span><br><span class="line">删除部分记录</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tb_name <span class="keyword">LIMIT</span> 总记录数<span class="number">-1000</span></span><br><span class="line"></span><br><span class="line">例如，比如一个表有 <span class="number">10000</span> 条记录，现想保留 <span class="number">1000</span> 条数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tb_name <span class="keyword">LIMIT</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>
<h3 id="mysql查找删除重复数据并只保留一条"><a href="#mysql查找删除重复数据并只保留一条" class="headerlink" title="mysql查找删除重复数据并只保留一条"></a>mysql查找删除重复数据并只保留一条</h3><p>有表数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | age  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | zhang |   21 |</span><br><span class="line">|    2 | li    |   22 |</span><br><span class="line">|    3 | zhang |   23 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>从上面可知，name字段有两条相同的记录zhang，我们要删除重复记录，保存id最小的一条<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    t_user </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    <span class="keyword">name</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t1.name <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> t_user <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span>) t1 ) </span><br><span class="line">    <span class="keyword">AND</span> </span><br><span class="line">    <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t2.id <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>) <span class="keyword">id</span> <span class="keyword">FROM</span> t_user <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span>) t2 );</span><br><span class="line"></span><br><span class="line">然后再执行查询语句：</span><br><span class="line">mysql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | age  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | zhang |   21 |</span><br><span class="line">|    2 | li    |   22 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可知，id为3的记录已经被删掉了。</p>
<h3 id="MySQL中CHAR和VARCHAR的区别"><a href="#MySQL中CHAR和VARCHAR的区别" class="headerlink" title="MySQL中CHAR和VARCHAR的区别"></a>MySQL中CHAR和VARCHAR的区别</h3><table>
<thead>
<tr>
<th style="text-align:left">CHAR</th>
<th style="text-align:left">VARCHAR</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">全称是 CHARACTER</td>
<td style="text-align:left">全称是 VARIABLE CHARACTER</td>
</tr>
<tr>
<td style="text-align:left">存储固定长度的数据，如果不足，会用空格补全，读取的时候可能会调用trim()</td>
<td style="text-align:left">按数据的实际长度存储，不会用空格补全</td>
</tr>
<tr>
<td style="text-align:left">占空间大</td>
<td style="text-align:left">占空间小</td>
</tr>
<tr>
<td style="text-align:left">最大能存储255个字符</td>
<td style="text-align:left">最大能存储65535个字符</td>
</tr>
<tr>
<td style="text-align:left">静态内存分配</td>
<td style="text-align:left">动态内存分配</td>
</tr>
<tr>
<td style="text-align:left">索引效率高</td>
<td style="text-align:left">索引效率没CHAR高</td>
</tr>
</tbody>
</table>
<p><strong>VARCHAR存储的实际长度是它的值的长度+1，多出的这一个用于保存它实际使用了多大的长度。</strong></p>
<h3 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h3><p>语法一，会复制完整的表结构（包括索引、主键等），但不包括数据：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tableName_new <span class="keyword">LIKE</span> tableName_old;</span><br></pre></td></tr></table></figure></p>
<p>语法二，只会复制简单的表结构（不包括索引、主键等），但可以包括数据（根据FROM后的WHERE条件）：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tableName_new <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tableName_old;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-修改字段定义"><a href="#mysql-修改字段定义" class="headerlink" title="mysql 修改字段定义"></a>mysql 修改字段定义</h3><p>下面的关键字<code>COLUMN</code>是可以省略的：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [表名] <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> [字段名] [类型];</span><br><span class="line"></span><br><span class="line">示例: sys_user表里的user_name字段，由原来长度是10个字符，修改改成40个字符</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> user_name <span class="built_in">VARCHAR</span>(<span class="number">40</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-修改字段名"><a href="#mysql-修改字段名" class="headerlink" title="mysql 修改字段名"></a>mysql 修改字段名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [表名] <span class="keyword">CHANGE</span> [旧字段名] [新字段名] [类型];</span><br><span class="line"></span><br><span class="line">示例: sys_user表里的user_name字段，修改改成user_name_new</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">CHANGE</span> user_name user_name_new <span class="built_in">VARCHAR</span>(<span class="number">40</span>);</span><br></pre></td></tr></table></figure>
<h3 id="mysql-增加列（字段）"><a href="#mysql-增加列（字段）" class="headerlink" title="mysql 增加列（字段）"></a>mysql 增加列（字段）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [表名] <span class="keyword">ADD</span> [列名] [列类型] [其他属性，如默认值];</span><br><span class="line"></span><br><span class="line">示例: sys_user表增加一个地址列，长度为200个字符，默认值为null</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">ADD</span> address <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">ADD</span> address <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">AFTER</span> age;</span><br><span class="line"></span><br><span class="line">可以一次增加多个列：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">ADD</span> (</span><br><span class="line">  sex <span class="built_in">VARCHAR</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="string">'男'</span>,</span><br><span class="line">  tel <span class="built_in">VARCHAR</span>(<span class="number">11</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">如果新增加的列有默认值，则SQL执行后，该新增的列会自动获得该值。</span><br></pre></td></tr></table></figure>
<h3 id="mysql-删除列（字段）"><a href="#mysql-删除列（字段）" class="headerlink" title="mysql 删除列（字段）"></a>mysql 删除列（字段）</h3><p>语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tableName <span class="keyword">DROP</span> columnName;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-删除表"><a href="#mysql-删除表" class="headerlink" title="mysql 删除表"></a>mysql 删除表</h3><p>语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> tableName;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-分组统计"><a href="#mysql-分组统计" class="headerlink" title="mysql 分组统计"></a>mysql 分组统计</h3><p>表结构和数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>, </span><br><span class="line"><span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">salary <span class="built_in">INT</span>,</span><br><span class="line">birthday <span class="keyword">TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (1, "a", 4000, STR_TO_DATE("2018-01-25 09:30:05","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (2, "a", 2000, STR_TO_DATE("2018-01-25 09:30:14","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (3, "a", 3000, STR_TO_DATE("2018-01-25 09:30:10","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (4, "b", 6000, STR_TO_DATE("2018-01-25 09:30:29","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (5, "b", 5000, STR_TO_DATE("2018-01-25 09:30:24","%Y-%m-%d %h:%i:%s"));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  1 | a    |   4000 | 2018-01-25 09:30:05 |</span><br><span class="line">|  2 | a    |   2000 | 2018-01-25 09:30:14 |</span><br><span class="line">|  3 | a    |   3000 | 2018-01-25 09:30:10 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">|  5 | b    |   5000 | 2018-01-25 09:30:24 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>按用户名分组，查询salary最大的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; SELECT id, name, MAX(salary) FROM t_user GROUP BY name;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----+------+-------------+</span></span><br><span class="line">| id | name | MAX(salary) |</span><br><span class="line">+<span class="comment">----+------+-------------+</span></span><br><span class="line">|  1 | a    |        4000 |</span><br><span class="line">|  4 | b    |        6000 |</span><br><span class="line">+<span class="comment">----+------+-------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">sql &gt; SELECT * FROM (SELECT * FROM t_user ORDER BY salary DESC) t GROUP BY t.name;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  1 | a    |   4000 | 2018-01-25 09:30:05 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>按用户名分组，取生日最小的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; SELECT * FROM (SELECT * FROM t_user ORDER BY birthday DESC) t GROUP BY t.name;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  2 | a    |   2000 | 2018-01-25 09:30:14 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="MySQL数据库备份和还原常用的命令"><a href="#MySQL数据库备份和还原常用的命令" class="headerlink" title="MySQL数据库备份和还原常用的命令"></a>MySQL数据库备份和还原常用的命令</h3><h4 id="一、备份命令"><a href="#一、备份命令" class="headerlink" title="一、备份命令"></a>一、备份命令</h4><p>如果只需要导出表的结构,可以使用mysqldump的<code>-d</code>选项<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、备份MySQL数据库的命令，备份指定的整个库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename &gt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">2、备份MySQL数据库为带删除表的格式，能够让该备份覆盖已有数据库而不需要手动删除原有数据库</span><br><span class="line">mysqldump <span class="comment">--add-drop-table -hhostname -uusername -ppassword databasename &gt; ~/backupfile.sql</span></span><br><span class="line"></span><br><span class="line">3、直接将MySQL数据库压缩备份</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename | gzip &gt; ~/backupfile.sql.gz</span><br><span class="line"></span><br><span class="line">4、备份MySQL数据库某个(些)表</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename specific_table1 [specific_table2] &gt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">5、同时备份多个MySQL数据库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword <span class="comment">--databases databasename1 databasename2 databasename3 &gt; ~/multibackupfile.sql</span></span><br><span class="line"></span><br><span class="line">6、仅仅备份数据库结构</span><br><span class="line">mysqldump -hhostname -uusername -ppassword -d <span class="comment">--databases databasename1 databasename2 databasename3 &gt; ~/structurebackupfile.sql</span></span><br><span class="line"></span><br><span class="line">7、备份服务器上所有数据库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword <span class="comment">--all-databases &gt; ~/allbackupfile.sql</span></span><br><span class="line"></span><br><span class="line">8、备份MySQL数据库某个表中指定条件的数据</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename specific_table1 <span class="comment">--where='age &gt; 10' &gt; ~/backupfile.sql</span></span><br></pre></td></tr></table></figure></p>
<h4 id="二、还原命令"><a href="#二、还原命令" class="headerlink" title="二、还原命令"></a>二、还原命令</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、还原MySQL数据库的命令</span><br><span class="line">mysql -hhostname -uusername -ppassword databasename &lt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">2、还原压缩的MySQL数据库</span><br><span class="line">gunzip &lt; ~/backupfile.sql.gz | mysql -uusername -ppassword databasename</span><br><span class="line"></span><br><span class="line">3、将数据库转移到新服务器</span><br><span class="line">mysqldump -uusername -ppassword databasename | mysql -host=*.*.*.* -C databasename</span><br></pre></td></tr></table></figure>
<h3 id="SELECT-INTO"><a href="#SELECT-INTO" class="headerlink" title="SELECT INTO"></a>SELECT INTO</h3><p>除此之外，你还可以使用<code>SELECT INTO</code>命令来导出数据，它与mysqldump的区别是：</p>
<ol>
<li>mysqldump: 导出的文本包括了数据库的结构和记录；</li>
<li>SELECT INTO: 导出的文本只有记录，并且，一般要数据库的管理员帐号，例如root才能执行；</li>
</ol>
<p>SELECT INTO 有两种使用方式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line">mysql&gt; SELECT * FROM t_user INTO OUTFILE 't_user.txt';</span><br><span class="line">Query OK, 2 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line">mysql&gt; SELECT * INTO OUTFILE 't_user.txt' FROM t_user;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>导出的数据一般在数据库的安装目录下，你也可以使用<code>find / -name t_user.txt</code>来查找到</p>
<h3 id="ERROR-3-HY000-Error-writing-file-‘-tmp-MYeaZGpS’-Errcode-28-No-space-left-on-device"><a href="#ERROR-3-HY000-Error-writing-file-‘-tmp-MYeaZGpS’-Errcode-28-No-space-left-on-device" class="headerlink" title="ERROR 3 (HY000): Error writing file ‘/tmp/MYeaZGpS’ (Errcode: 28 - No space left on device)"></a>ERROR 3 (HY000): Error writing file ‘/tmp/MYeaZGpS’ (Errcode: 28 - No space left on device)</h3><p>根据提示，是说mysql中/tmp使用的磁盘空间不足。<br>在MYSQL命令行下执行：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE 'tmpdir';</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| tmpdir        | /tmp  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可以看到MYSQL的tmpdir是使用/tmp这个临时目录的，使用<code>df -h</code>看下/tmp的空间，确实不足。我们修改tmpdir所指定的目录，我们在空间比较大的分区上面建一个目录。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/data</span><br><span class="line">$ mkdir mysqltmp</span><br><span class="line">$ chmod a+w mysqltmp</span><br></pre></td></tr></table></figure></p>
<p>然后修改my.cnf配置文件在其中修改tmpdir<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ whereis my.cnf</span><br><span class="line">$ <span class="built_in">cd</span> &#123;my.cnf所在的目录&#125;</span><br><span class="line">$ vi my.cnf</span><br><span class="line"></span><br><span class="line">修改的内容如下</span><br><span class="line">tmpdir = /opt/data/mysqltmp</span><br></pre></td></tr></table></figure></p>
<p>重启mysql<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /etc/init.d/mysqld restart    <span class="comment"># 不同Linux系统，命令可能不同</span></span><br></pre></td></tr></table></figure></p>
<p>在MYSQL命令行中查看下是否生效<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE 'tmpdir';</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">| Variable_name | Value              |</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">| tmpdir        | /opt/data/mysqltmp |</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>问题解决。</p>
<h3 id="读一致性"><a href="#读一致性" class="headerlink" title="读一致性"></a>读一致性</h3><p>mysql有一个表，有1000W条记录。在9:00的时候A用户对表进行查询，查询需10分钟才能完成，表没索引，FULL SCAN，表中某条记录的值为100。在9:05分的时候B对表进行了UPDATE操作，将记录的值修改为200。那么在9:10的时候，A获致到的是100还是200？结果是100。因为这是读一致性的问题，在A查的时候，它看到的是整个表在那一刻的快照的数据，返回的是那一刻的结果。不过，它有可能会抛出 snapshot too old 这个异常。</p>
<h3 id="mysql-修改表名"><a href="#mysql-修改表名" class="headerlink" title="mysql 修改表名"></a>mysql 修改表名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name RENAME TO new_table_name;</span><br></pre></td></tr></table></figure>
<h3 id="INSERT-INTO插入数据"><a href="#INSERT-INTO插入数据" class="headerlink" title="INSERT INTO插入数据"></a>INSERT INTO插入数据</h3><p>如果不指定插入的列名，则VALUES的值必须与表的所有列名一一对应<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'Scott'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user <span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'Scott'</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user <span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'Scott'</span>, <span class="number">20</span>), (<span class="literal">NULL</span>, <span class="string">'tiger'</span>, <span class="number">21</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="MYSQL插入数据时忽略重复数据的方法"><a href="#MYSQL插入数据时忽略重复数据的方法" class="headerlink" title="MYSQL插入数据时忽略重复数据的方法"></a>MYSQL插入数据时忽略重复数据的方法</h3><p>使用<code>IGNORE</code>关键字，示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT IGNORE INTO tableName(column_list)</span><br><span class="line">VALUES (value_list),</span><br><span class="line">       (value_list),</span><br><span class="line">       ...</span><br></pre></td></tr></table></figure></p>
<h3 id="将一个数据库中的表导入到另一个数据库中的表"><a href="#将一个数据库中的表导入到另一个数据库中的表" class="headerlink" title="将一个数据库中的表导入到另一个数据库中的表"></a>将一个数据库中的表导入到另一个数据库中的表</h3><p>将数据库A中的表a的数据导入到数据库B中的表b中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT [IGNORE] INTO 数据库B.`表名b` SELECT * FROM 数据库A.`表名a`;</span><br><span class="line">INSERT [IGNORE] INTO 数据库B.`表名b` SELECT col1, col2, col3 FROM 数据库A.`表名a`;</span><br><span class="line">INSERT [IGNORE] INTO 数据库B.`表名b`(col1, col2, col3) SELECT col1, col2, col3 FROM 数据库A.`表名a`;</span><br></pre></td></tr></table></figure></p>
<h3 id="MySQL千万级数据快速分页"><a href="#MySQL千万级数据快速分页" class="headerlink" title="MySQL千万级数据快速分页"></a>MySQL千万级数据快速分页</h3><p>数据量少的时候，可以这样写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName ORDER BY id LIMIT 1000, 10;</span><br></pre></td></tr></table></figure></p>
<p>但在数据量达到百万级，甚至千万级的时候，这样写会慢死：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName ORDER BY id LIMIT 1000000, 10;</span><br></pre></td></tr></table></figure></p>
<p>可能耗费几十秒，网上有很多优化的方法是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName WHERE id &gt;= (SELECT id FROM tableName LIMIT 1000000, 1) LIMIT 10;</span><br></pre></td></tr></table></figure></p>
<p>是的，速度提升到0.x秒了，看样子还行。但，还不是完美的！下面这句才是完美的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName WHERE id BETWEEN 1000000 AND 1000010;</span><br></pre></td></tr></table></figure></p>
<p>比上面那句，还要再快5至10倍</p>
<p>另外，如果需要查询<code>id</code>不是连续的一段，最佳的方法就是先找出<code>id</code>，然后用<code>IN</code>查询，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName WHERE id IN (10000, 100000, 1000000, ...);</span><br></pre></td></tr></table></figure></p>
<p>如果查询的字段是一较长字符串的时候，表设计时要为该字段多加一个字段。如，存储网址的字段，查询的时候，不要直接查询该字符串，这样效率低下，应该查询该字符串的CRC32或MD5。</p>
<h3 id="mysql-查询一个字符串字段最长的一条记录"><a href="#mysql-查询一个字符串字段最长的一条记录" class="headerlink" title="mysql 查询一个字符串字段最长的一条记录"></a>mysql 查询一个字符串字段最长的一条记录</h3><p>参考：<a href="http://stackoverflow.com/questions/2357620/maxlengthfield-in-mysql" target="_blank" rel="noopener">http://stackoverflow.com/questions/2357620/maxlengthfield-in-mysql</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, LENGTH(name)</span><br><span class="line">FROM my_table</span><br><span class="line">WHERE LENGTH(name) = (SELECT MAX(LENGTH(name)) FROM my_table);</span><br></pre></td></tr></table></figure></p>
<h3 id="skip-grant-tables-参数的使用"><a href="#skip-grant-tables-参数的使用" class="headerlink" title="skip-grant-tables 参数的使用"></a>skip-grant-tables 参数的使用</h3><p>这是个非常有用的mysql启动参数</p>
<p>在my.cnf文件中增加一行：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure></p>
<p>或者以命令行参数启动mysql：</p>
<pre><code>/usr/bin/mysqld_safe --skip-grant-tables &amp;
</code></pre><p>登陆mysql修改管理员密码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line">UPDATE user SET password=password(&apos;root&apos;) WHERE user=&apos;root&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">EXIT;</span><br></pre></td></tr></table></figure></p>
<p>重启mysql</p>
<h3 id="DELETE和TRUNCATE的区别"><a href="#DELETE和TRUNCATE的区别" class="headerlink" title="DELETE和TRUNCATE的区别"></a>DELETE和TRUNCATE的区别</h3><p>TRUNCATE TABLE 属于DDL，它虽然和对整张表执行DELETE操作产生的效果差不多，但是它是不能回滚的。</p>
<h3 id="三大范式"><a href="#三大范式" class="headerlink" title="三大范式"></a>三大范式</h3><p>第一范式(1NF)：在关系模式R中的每一个具体关系r，必须要有主键，并且每个属性值都是不可再分的最小数据单位，则称R是第一范式的关系；<br>第二范式(2NF)：如果关系模式R中的所有非主属性都完全依赖于主关键字，则称关系R是属于第二范式的；<br>第三范式(3NF)：关系模式R中的非主关键字不能依赖于其他非主关键字。即非主关键字之间不能有函数（传递）依赖关系，则称关系R是属于第三范式的。</p>
<h3 id="VARCHAR类型的说明"><a href="#VARCHAR类型的说明" class="headerlink" title="VARCHAR类型的说明"></a>VARCHAR类型的说明</h3><p>在官方手册中，VARCHAR类型最大支持65535，单位是字节，但实际上。在创建表的时候VARCHAR(N)中的N，指的是字符的长度。但是，如果表的字符集不同，能支持的最大长度也不同。</p>
<ol>
<li>表的CHARSET=latin1时，能使用VARCHAR(65532)；</li>
<li>表的CHARSET=GBK时，能使用VARCHAR(32767)；</li>
<li>表的CHARSET=UTF8，能使用VARCHAR(21845)；</li>
<li>如果表的SQL_MODE为非严格模式，则表的CHARSET=latin1时，或者能使用VARCHAR(65535)成功创建表，但是可能会有warning。warning可能是数据库将那列自动转换为TEXT类型了；</li>
<li>还有一个需要注意的地方是，65535长度是指表中所有VARCHAR列的长度总和。如果列的长度总和超出这个限制，依然无法创建表。</li>
</ol>
<h3 id="CHAR类型的说明"><a href="#CHAR类型的说明" class="headerlink" title="CHAR类型的说明"></a>CHAR类型的说明</h3><p>CHAR(N)中的N指的是字符，对于多字节字符编码的CHAR数据类型，在InnoDB存储引擎中，会将其视为变长类型。对于未能占满长度的字符，还是填充<code>0X20</code>，也即是空格。</p>
<p>在多字节字符集的情况下，CHAR和VARCHAR的实际行存储基本是没有区别的。</p>
<h3 id="强制使用索引"><a href="#强制使用索引" class="headerlink" title="强制使用索引"></a>强制使用索引</h3><p>在查询的过程中可以使用<code>FORCE INDEX</code>来强制查询优化器使用指定的索引，例如表<code>t_user</code>有索引<code>idx_name</code>，则我们可以这样查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t_user FORCE INDEX(idx_name) WHERE name=&apos;Tim&apos; AND age=22;</span><br></pre></td></tr></table></figure></p>
<h3 id="索引提示"><a href="#索引提示" class="headerlink" title="索引提示"></a>索引提示</h3><p>在查询的过程中可以使用<code>USE INDEX</code>来显式地告诉查询优化器使用哪个索引，例如表<code>t_user</code>有索引<code>idx_name</code>，则我们可以这样查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t_user USE INDEX(idx_name) WHERE name=&apos;Tim&apos; AND age=22;</span><br></pre></td></tr></table></figure></p>
<p>主要在以下2种情况下要使用索引提示：</p>
<ol>
<li>MYSQL数据库的优化器错误地选择了某个索引，导致SQL语句运行得很慢；</li>
<li>某SQL语句可以选择的索引非常多，优化器选择执行计划时间的开销大于SQL语句本身。</li>
</ol>
<p><code>USE INDEX</code>只是告诉优化器可以选择该索引，但实际上优化器可能还是会再根据自已的判断进行选择，除非使用<code>FORCE INDEX</code>。</p>
<p>对数据库执行了一个删除操作，实际上并不会删除索引中的数据，相反还会在对应的DELETED表中插入记录，因此随着应用程序的运行，索引会变得非常大。即使索引中的有些数据已经被删除，查询也不会选择这类记录。InnoDb存储引擎，可以在必要时手动将已经删除的记录在索引中删除，命令是 OPTIMIZE TABLE。它还会对Cardinality进行统计，因此可以关闭它的统计。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL innodb_optimize_fulltext_only=1;</span><br><span class="line">mysql&gt; OPTIMIZE TABLE table_name;</span><br></pre></td></tr></table></figure></p>
<h3 id="锁问题"><a href="#锁问题" class="headerlink" title="锁问题"></a>锁问题</h3><p>锁问题有三个：</p>
<ol>
<li><p>脏读：首先了解一下脏数据，脏数据是指事务对缓冲池中行记录的修改，并且还没有被提交。如果读到了脏数据，即一个事务可以读到另外一个事务中未提交的数据，这显然违反了数据库的隔离性。而对脏页的读取，是非常正常的。脏页是因为数据库实例内存和磁盘的异步造成的，这并不影响数据的一致性，因为内存中的数据最终是要刷新回磁盘的。</p>
</li>
<li><p>不可重复读：在同一个事务中多次读取同一个表，在多次读取之间，还有另外一个事务对该表进行了DML，从而导致多次读取到的数据可能不一致。与脏读的区别是：脏读读取到的是未提交的数据，而不可重复读读到的是已经提交的数据。这违反了数据库事务的一致性。</p>
</li>
<li><p>丢失更新：就是一个事务的更新操作，会被另一个事务的更新操作所覆盖，从而导致数据的不一致。可以将事务的处理模式变成串行的，这样来避免。在更新数据的时候，特别是敏感数据的时候，一定要先加一个排他X锁，这样也方便对帐户余额进行先检查，再更新。而不是仅仅学会了简单的SELECT、UPDATE操作就开始处理数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT cash FROM account WHERE user=&apos;user_name&apos; FOR UPDATE;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="事务的ACID特性"><a href="#事务的ACID特性" class="headerlink" title="事务的ACID特性"></a>事务的ACID特性</h3><pre><code>事务是作为一个逻辑单元执行的一系列操作，一个逻辑工作单元必须有四个属性，
</code></pre><p>称为 ACID（原子性、一致性、隔离性和持久性）属性，只有这样才能成为一个事务。</p>
<p>原子性（Atomicity）<br>整个事务中的所有操作，要么全部成功执行，要么全部失败。</p>
<p>一致性（Consistency）<br>事务提交前后，表的所有约束条件都保持完好。对表的修改符合所有的Keys、数据类型、Checks和触发器的约束，没有约束被破坏。</p>
<p>隔离性（Isolation）<br>一个事务，无法访问到另一个事务未提交的数据。</p>
<p>持久性（Durability）<br>事务成功执行后，对数据的修改会持久保存在数据库中，不会被回滚，就算系统死机。</p>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p>对于InnoDB存储引擎而言，它默认的事务隔离级别为REPEATABLE READ，完全遵循和满足事务的ACID特性。而Oracle、sqlServer则是READ COMMITTED。</p>
<p>SQL标准定义了4个隔离级别：<br>READ UNCOMMITTED：会出现脏读、不可重复读、幻读（隔离级别最低，并发性能高）<br>READ COMMITTED：会出现不可重复读、幻读问题（锁定正在读取的行）<br>REPEATABLE READ：会出幻读（锁定所读取的所有行）<br>SERIALIZABLE：保证所有的情况不会发生（锁表）</p>
<p>可以在数据库启动的时候设置它的默认隔离级别：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">transaction-isolation=READ-COMMITTED</span><br></pre></td></tr></table></figure></p>
<p>查看当前会话的事务隔离级别：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @@tx_isolation;</span><br></pre></td></tr></table></figure></p>
<h3 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h3><p>InnoDB存储引擎提供了对XA事务的支持，并通过XA事务来支持分布式事务的实现。分布式事务指的是允许多个独立的事务资源参与到一个全局的事务中。事务资源通常是关系型数据库系统，但也可以是其他类型的资源。全局事务要求在其中的所有参与事务要么都提交，要么都ROLLBACK，这对于事务原有的ACID要求又有了提高。另外，在使用分布式事务时，InnoDB存储引擎的事务隔离级别必须设置为SERIALIZABLE。<br>XA事务允许不同数据库之间的分布式事务，如一台服务器是MySQL数据库，另一台是Oracle数据库，只要参与在全局事务中的每个节点都支持XA事务。分布式事务可能在银行系统的转帐中比较常见。可以通过变量查看数据库是否启用了XA事务支持（默认为ON）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &apos;innodb_support_xa&apos;;</span><br></pre></td></tr></table></figure></p>
<p>MySQL数据库是自动提交的。当用户显式的使用命令<code>START TRANSACTION</code>或<code>BEGIN</code>来开启一个事务时，MySQL会自动地执行<code>SET AUTOCOMMIT=0</code>命令，并在<code>COMMIT</code>或<code>ROLLBACK</code>结束一个事务后，再执行<code>SET AUTOCOMMIT=1</code>。</p>
<p>对长事务的处理，是将长事务分解为多个小事务来分批处理。在应用程序中，最好是将事务的START TRANSACTION、COMMIT、ROLLBACK操作交给程序端来控制，而不是在存储过程中。</p>
<h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><p>Hot Backup 热备： 在数据库运行中直接备份，对运行中的数据库操作没有任何的影响；<br>Cold Backup 冷备： 在数据库停机状态下进行备份，一般备份数据库的物理文件；<br>Warm Backup 温备：也是在数据库运行中进行备份，但是会对当前的数据库操作有所影响，例如它会加一个全局读锁以保证备份数据的一致性。</p>
<p>对于mysqldump备份工具来说，可以通过添加<code>--single-transaction</code>选项获得InnoDB存储引擎的一致性备份，此时的备份是在一个执行时间很长的事务中完成的。请务必加上此选项。</p>
<p>mysqldump不能导出视图。免费好用的开源热备份工具有XtraBackup。</p>
<h3 id="连接到mysql"><a href="#连接到mysql" class="headerlink" title="连接到mysql"></a>连接到mysql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -h192.168.1.100 -uscoot -p</span><br><span class="line">$ mysql -h192.168.1.100 -uscoot -ptiger</span><br></pre></td></tr></table></figure>
<h3 id="不登录MYSQL来执行查询"><a href="#不登录MYSQL来执行查询" class="headerlink" title="不登录MYSQL来执行查询"></a>不登录MYSQL来执行查询</h3><p>可以在操作系统命令行下通过<code>-e</code>参数实现，例如查询test库下的表t_user：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -h192.168.1.100 -uscoot -ptiger test -e &quot;SELECT * FROM t_user&quot;</span><br><span class="line"></span><br><span class="line">+----+-------+------+</span><br><span class="line">| id | name  | age  |</span><br><span class="line">+----+-------+------+</span><br><span class="line">|  1 | zhang |   21 |</span><br><span class="line">|  2 | zhang |   23 |</span><br><span class="line">|  4 | zhang |   21 |</span><br><span class="line">|  5 | zhang |   21 |</span><br><span class="line">+----+-------+------+</span><br></pre></td></tr></table></figure></p>
<p>说明：</p>
<pre><code>-e, --execute=name  Execute command and quit. (Disables --force and history file.)
</code></pre><h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><p>概述：</p>
<ol>
<li>通过约束可以更好的保证数据表里数据的完整性；</li>
<li>约束是在表上强制执行的数据校验规则，约束主要保证数据的完整性；</li>
<li>当表中的数据存在相互依赖时，可以通过约束保护相关的数据不被删除。</li>
</ol>
<p>MYSQL中支持以下五类约束：</p>
<ol>
<li>NOT NULL：非空约束，指定某列不能为空；</li>
<li>UNIQUE：唯一约束，指定某列或者几列组合不能重复，允许空；</li>
<li>PRIMARY KEY：主键，指定该列的值可以唯一的表示每条记录；</li>
<li>FOREIGN KEY：外键，指定该行记录从属于主表中的一条记录，主要用于保证参照完整性；</li>
<li>CHECK：检查，指定一个布尔表达式，用于指定对应列的值必须满足该表达式。</li>
</ol>
<h3 id="NOT-NULL约束"><a href="#NOT-NULL约束" class="headerlink" title="NOT NULL约束"></a>NOT NULL约束</h3><p>如果我们向NOT NULL的字段插入一下NULL值，MySQL数据库会将其更改为0再进行插入。我们可以通过设置SQL_MODE来严格审核输入参数。<br>所有数据类型值都可以为null，如：int，float等。空字符串不等于null，0也不等于null。</p>
<h3 id="UNIQUE约束"><a href="#UNIQUE约束" class="headerlink" title="UNIQUE约束"></a>UNIQUE约束</h3><p>UNIQUE约束用于保证指定列或指定列的组合不允许出现重复，但可以允许出现多个null值。同一张表内可以建多个UNIQUE约束。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> index_uk <span class="keyword">UNIQUE</span>(<span class="keyword">id</span>, userName)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="PRIMARY-KEY约束"><a href="#PRIMARY-KEY约束" class="headerlink" title="PRIMARY KEY约束"></a>PRIMARY KEY约束</h3><p>主键约束相当于唯一约束和非空约束，每个表中最多允许一个主键。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> index_pk PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="FOREIGN-KEY约束"><a href="#FOREIGN-KEY约束" class="headerlink" title="FOREIGN KEY约束"></a>FOREIGN KEY约束</h3><p>概述：</p>
<ol>
<li>外键约束主要用于保证一个或两个数据表之间的参照完整性，外键构建于一个表的两个字段或者两个表的两个字段之间；</li>
<li>建立外键时mysql也会为该列建立索引；</li>
<li>子表外键列的值必须在主表被参照列值的范围之内，或者为空；</li>
<li>为了保证子表参照的主表存在，通常应先建主表；</li>
<li>使用列级约束语法建立外键约束直接使用<code>REFERENCES</code>关键字。指定该列参照的哪个主表，以及参照主表的哪一列。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> teacher (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  teacher_id <span class="built_in">INT</span>,</span><br><span class="line">  FOREIGN <span class="keyword">KEY</span>(teacher_id) <span class="keyword">REFERENCES</span> teacher(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="CHECK约束"><a href="#CHECK约束" class="headerlink" title="CHECK约束"></a>CHECK约束</h3><p>CHECK约束在建表的列定义后增加逻辑表达式即可。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="built_in">INT</span>,</span><br><span class="line">  <span class="keyword">CHECK</span>(age &gt; <span class="number">0</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>目前所有MYSQL存储引擎并没有实现CHECK约束，也就是说，上面的建表语句正确，但约束无效。<br><a href="https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-indexes-keys" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-indexes-keys</a></p>
<pre><code>The CHECK clause is parsed but ignored by all storage engines.
</code></pre><h3 id="COUNT-1-、COUNT-、COUNT-pk-的区别"><a href="#COUNT-1-、COUNT-、COUNT-pk-的区别" class="headerlink" title="COUNT(1)、COUNT(*)、COUNT(pk)的区别"></a>COUNT(1)、COUNT(*)、COUNT(pk)的区别</h3><p>下面两句产生的结果是一样的:<br>COUNT(*) 统计表中有多少行，包括字段为NULL的行<br>COUNT(1) 统计表中有多少行，包括字段为NULL的行</p>
<p>当pk为主键的时候，因为主键不允许为NULL，所以<br>COUNT(pk) 同样是，统计表中有多少行，包括字段为NULL的行</p>
<p>但是，如果pk代表的字段允许为NULL，那么将产生不同的结果<br>COUNT(pk) 统计表中有多少行，不包括pk为NULL的行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  1 | a    |   4000 | 2018-01-25 09:30:05 |</span><br><span class="line">|  2 | a    |   2000 | 2018-01-25 09:30:14 |</span><br><span class="line">|  3 | a    |   3000 | 2018-01-25 09:30:10 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">|  5 | b    |   5000 | 2018-01-25 09:30:24 |</span><br><span class="line">|  6 | NULL |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">sql</span>&gt; <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*), <span class="keyword">COUNT</span>(<span class="number">1</span>), <span class="keyword">COUNT</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> t_user;</span><br><span class="line">+<span class="comment">----------+----------+-------------+</span></span><br><span class="line">| COUNT(*) | COUNT(1) | COUNT(name) |</span><br><span class="line">+<span class="comment">----------+----------+-------------+</span></span><br><span class="line">|        6 |        6 |           5 |</span><br><span class="line">+<span class="comment">----------+----------+-------------+</span></span><br></pre></td></tr></table></figure>
<p>通常，建议使用COUNT(*)，因为它是SQL推荐的，SQL会自动优化到一个字段。</p>
<p>执行效率：</p>
<ol>
<li>当pk为主键时，COUNT(pk)比COUNT(1)快，否则COUNT(1)比COUNT(pk)快；</li>
<li>当表有多个列时，如果没有主键，则COUNT(1)比COUNT(*)快； 如果有主键，则COUNT(pk)的效率是最优的；</li>
<li>当表只有一个列时，COUNT(*)最优。</li>
</ol>
<h3 id="left-join-right-join-inner-join-join区别"><a href="#left-join-right-join-inner-join-join区别" class="headerlink" title="left join, right join, inner join, join区别"></a>left join, right join, inner join, join区别</h3><p>有如下表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_contact (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'t_user的主键 id'</span>,</span><br><span class="line">  card <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'Scott'</span>),(<span class="number">2</span>, <span class="string">'Tiger'</span>),(<span class="number">3</span>, <span class="string">'Larry'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_contact <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'A'</span>),(<span class="number">1</span>, <span class="string">'B'</span>),(<span class="number">2</span>, <span class="string">'C'</span>),(<span class="number">4</span>, <span class="string">'D'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL [test]&gt; select * from t_user;</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">| id | name  |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">|  1 | Scott |</span><br><span class="line">|  2 | Tiger |</span><br><span class="line">|  3 | Larry |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t_contact;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | card |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  1 | A    |</span><br><span class="line">|  1 | B    |</span><br><span class="line">|  2 | C    |</span><br><span class="line">|  4 | D    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br></pre></td></tr></table></figure></p>
<p>join 查询<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">| id | name  | id | card |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">|  1 | Scott |  1 | A    |</span><br><span class="line">|  1 | Scott |  1 | B    |</span><br><span class="line">|  2 | Tiger |  2 | C    |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br></pre></td></tr></table></figure></p>
<p>inner join 查询<br>只返回两个表中联结字段相等的行<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu inner join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">| id | name  | id | card |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">|  1 | Scott |  1 | A    |</span><br><span class="line">|  1 | Scott |  1 | B    |</span><br><span class="line">|  2 | Tiger |  2 | C    |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br></pre></td></tr></table></figure></p>
<p>left join 查询<br>返回左表中的所有记录和右表中联结字段相等的记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu left join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">----+-------+------+------+</span></span><br><span class="line">| id | name  | id   | card |</span><br><span class="line">+<span class="comment">----+-------+------+------+</span></span><br><span class="line">|  1 | Scott |    1 | A    |</span><br><span class="line">|  1 | Scott |    1 | B    |</span><br><span class="line">|  2 | Tiger |    2 | C    |</span><br><span class="line">|  3 | Larry | NULL | NULL |</span><br><span class="line">+<span class="comment">----+-------+------+------+</span></span><br></pre></td></tr></table></figure></p>
<p>right join 查询<br>返回右表中的所有记录和左表中联结字段相等的记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu right join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">------+-------+----+------+</span></span><br><span class="line">| id   | name  | id | card |</span><br><span class="line">+<span class="comment">------+-------+----+------+</span></span><br><span class="line">|    1 | Scott |  1 | A    |</span><br><span class="line">|    1 | Scott |  1 | B    |</span><br><span class="line">|    2 | Tiger |  2 | C    |</span><br><span class="line">| NULL | NULL  |  4 | D    |</span><br><span class="line">+<span class="comment">------+-------+----+------+</span></span><br></pre></td></tr></table></figure></p>
<h3 id="查询满足多个属性的产品列表"><a href="#查询满足多个属性的产品列表" class="headerlink" title="查询满足多个属性的产品列表"></a>查询满足多个属性的产品列表</h3><p>像淘宝中搜索满足多个条件的产品列表，准备数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'产品名'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product_property (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">product_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'产品id'</span>,</span><br><span class="line">property_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'属性名'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product(<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'car'</span>),(<span class="number">2</span>,<span class="string">'plane'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product_property(<span class="keyword">id</span>, product_id, property_name)</span><br><span class="line">  <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">'drive'</span>),(<span class="number">2</span>,<span class="number">1</span>,<span class="string">'black'</span>),(<span class="number">3</span>,<span class="number">1</span>,<span class="string">'benz'</span>),(<span class="number">4</span>,<span class="number">2</span>,<span class="string">'fly'</span>),(<span class="number">5</span>,<span class="number">2</span>,<span class="string">'white'</span>),(<span class="number">6</span>,<span class="number">2</span>,<span class="string">'boeing'</span>);</span><br></pre></td></tr></table></figure></p>
<p>匹配一个属性：drive<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> p.product_id <span class="keyword">FROM</span> (</span><br><span class="line">    t_product_property p</span><br><span class="line">  ) <span class="keyword">WHERE</span> p.id = <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>匹配两个属性：drive, black<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> p.product_id <span class="keyword">FROM</span> (</span><br><span class="line">    t_product_property p,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">id</span>, product_id <span class="keyword">FROM</span> t_product_property) p2</span><br><span class="line">  ) <span class="keyword">WHERE</span> p.id = <span class="number">1</span> <span class="keyword">AND</span> p2.id = <span class="number">2</span> <span class="keyword">AND</span> p.product_id = p2.product_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>匹配三个属性:drive, black, benz<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> p.product_id <span class="keyword">FROM</span> (</span><br><span class="line">    t_product_property p,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">id</span>, product_id <span class="keyword">FROM</span> t_product_property) p2,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">id</span>, product_id <span class="keyword">FROM</span> t_product_property) p3</span><br><span class="line">  ) <span class="keyword">WHERE</span> p.id = <span class="number">1</span> <span class="keyword">AND</span> p2.id = <span class="number">2</span> <span class="keyword">AND</span> p3.id = <span class="number">3</span> <span class="keyword">AND</span> p.product_id = p2.product_id <span class="keyword">AND</span> p.product_id = p3.product_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="命令行连接mysql"><a href="#命令行连接mysql" class="headerlink" title="命令行连接mysql"></a>命令行连接mysql</h3><pre><code>mysql -hip_address -uuser_name -Pport -ppassword db_name
</code></pre><p>如果<code>-p</code>后面的密码中有特殊字符，就要加个<code>\</code>来转义<br>        mysql -h192.168.1.100 -uroot -P3306 -pT3O\$8yKl%aRi user_db</p>
<h3 id="mysql报错ERROR-1064-42000"><a href="#mysql报错ERROR-1064-42000" class="headerlink" title="mysql报错ERROR 1064 (42000)"></a>mysql报错ERROR 1064 (42000)</h3><p>原因是使用了mysql的保留字。如果表的字段使用了mysql的保留字，在查询的时候要用反引号将其引起来。<br>        SELECT * FROM t_user WHERE <code>key</code> = ‘abc’;</p>
<h3 id="mysql-update"><a href="#mysql-update" class="headerlink" title="mysql update"></a>mysql update</h3><p>单表更新语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> [<span class="keyword">LOW_PRIORITY</span>] [<span class="keyword">IGNORE</span>] table_name</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    column_name1 = expr1,</span><br><span class="line">    column_name2 = expr2,</span><br><span class="line">    ...</span><br><span class="line">[<span class="keyword">WHERE</span></span><br><span class="line">    condition];</span><br></pre></td></tr></table></figure></p>
<p>也可以用从其他表SELECT出来的数据来SET值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    column_name1 = (<span class="keyword">SELECT</span> column_name1 <span class="keyword">FROM</span> table_name2 <span class="keyword">WHERE</span> column_name2 = <span class="string">'h'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">RAND</span>() <span class="keyword">LIMIT</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    column_name1 <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure></p>
<p>连表更新语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> T1, T2</span><br><span class="line">[<span class="keyword">INNER</span> <span class="keyword">JOIN</span> | <span class="keyword">LEFT</span> <span class="keyword">JOIN</span>] T1 <span class="keyword">ON</span> T1.C1 = T2. C1</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    T1.C2 = T2.C2,</span><br><span class="line">    T2.C3 = expr</span><br><span class="line"><span class="keyword">WHERE</span> condition</span><br></pre></td></tr></table></figure></p>
<p>示例：<br>Suppose you want to adjust the salary of employees based on their performance.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> merits m <span class="keyword">ON</span> e.performance = m.performance</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    e.salary = e.salary + e.salary * m.percentage;</span><br></pre></td></tr></table></figure></p>
<p>The UPDATE LEFT JOIN  statement basically updates a row in a table when it does not have a corresponding row in another table.</p>
<p>For example, you can increase the salary for a new hire by 1.5%  using the following statement:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> merits m <span class="keyword">ON</span> e.performance = m.performance</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    e.salary = e.salary + e.salary * <span class="number">0.015</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    m.percentage <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="FOREIGN-KEY引用导致无法删表"><a href="#FOREIGN-KEY引用导致无法删表" class="headerlink" title="FOREIGN KEY引用导致无法删表"></a>FOREIGN KEY引用导致无法删表</h3><p>这时候，只要按如下方式删除，即可。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> table_name;</span><br></pre></td></tr></table></figure></p>
<h3 id="对MySQL数据库性能的测试工具"><a href="#对MySQL数据库性能的测试工具" class="headerlink" title="对MySQL数据库性能的测试工具"></a>对MySQL数据库性能的测试工具</h3><p>这里有2款比较好的工具：sysbench和mysql-tpcc</p>
<p>主要测试：<br>CPU性能<br>磁盘IO性能<br>调度程序性能<br>内存分配及传输速度<br>POSIX线程性能<br>数据库OLTP基准测试</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/07/mysql-note/" data-id="ckpo1myxo0031uu3k8fa3ikqh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-zookeeper-cluster" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/06/zookeeper-cluster/" class="article-date">
  <time datetime="2017-12-06T08:33:35.000Z" itemprop="datePublished">2017-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/06/zookeeper-cluster/">zookeeper 集群版安装方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="计划在一台Ubuntu-Linux服务器上部署3台zookeeper服务器，分别为server1-server2-server3"><a href="#计划在一台Ubuntu-Linux服务器上部署3台zookeeper服务器，分别为server1-server2-server3" class="headerlink" title="计划在一台Ubuntu Linux服务器上部署3台zookeeper服务器，分别为server1, server2, server3"></a>计划在一台<code>Ubuntu Linux</code>服务器上部署3台<code>zookeeper</code>服务器，分别为<code>server1</code>, <code>server2</code>, <code>server3</code></h3><p>因为三台<code>zookeeper</code>服务器的配置都差不多，所以我们先设置好一台<code>server1</code>的配置，再将其复制成<code>server2</code>, <code>server3</code>并修改其中的配置即可。</p>
<h3 id="1-建目录，如下："><a href="#1-建目录，如下：" class="headerlink" title="1.建目录，如下："></a>1.建目录，如下：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /home/hewentian/ProjectD/zookeeperCluster/server1</span><br><span class="line">$ mkdir -p /home/hewentian/ProjectD/zookeeperCluster/server1/data</span><br></pre></td></tr></table></figure>
<h3 id="2-将zookeeper-3-4-6-tar-gz放到-home-hewentian-ProjectD-zookeeperCluster-server1目录下，并执行如下脚本解压"><a href="#2-将zookeeper-3-4-6-tar-gz放到-home-hewentian-ProjectD-zookeeperCluster-server1目录下，并执行如下脚本解压" class="headerlink" title="2.将zookeeper-3.4.6.tar.gz放到/home/hewentian/ProjectD/zookeeperCluster/server1目录下，并执行如下脚本解压"></a>2.将<code>zookeeper-3.4.6.tar.gz</code>放到<code>/home/hewentian/ProjectD/zookeeperCluster/server1</code>目录下，并执行如下脚本解压</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1</span><br><span class="line">$ tar xzvf zookeeper-3.4.6.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="3-解压后得到zookeeper-3-4-6文件夹，进入conf目录"><a href="#3-解压后得到zookeeper-3-4-6文件夹，进入conf目录" class="headerlink" title="3.解压后得到zookeeper-3.4.6文件夹，进入conf目录"></a>3.解压后得到<code>zookeeper-3.4.6</code>文件夹，进入<code>conf</code>目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> zookeeper-3.4.6/conf/</span><br></pre></td></tr></table></figure>
<h3 id="4-执行如下命令，新建一个配置文件zoo-cfg"><a href="#4-执行如下命令，新建一个配置文件zoo-cfg" class="headerlink" title="4.执行如下命令，新建一个配置文件zoo.cfg"></a>4.执行如下命令，新建一个配置文件zoo.cfg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure>
<h3 id="5-修改zoo-cfg并在其中修改如下内容："><a href="#5-修改zoo-cfg并在其中修改如下内容：" class="headerlink" title="5.修改zoo.cfg并在其中修改如下内容："></a>5.修改zoo.cfg并在其中修改如下内容：</h3><pre><code>tickTime=2000
initLimit=10
syncLimit=5
dataDir=/home/hewentian/ProjectD/zookeeperCluster/server1/data # 这里必须为绝对路径，否则有可能无法启动
clientPort=2181                 # 这台服务器的端口为2181（即默认值），当部署为真集群的时候各个节点的端口都是2181
server.1=127.0.0.1:2888:3888    # 当部署成真集群的时候：
server.2=127.0.0.1:2889:3889    # server.1、server.2和server.3后面的IP要修改成各个节点的真实IP或者域名
server.3=127.0.0.1:2890:3890    # 并且server.2、server.3后面的两个端口要和server.1的是一样的，都是2888:3888
</code></pre><h3 id="6-在-home-hewentian-ProjectD-zookeeperCluster-server1-data目录下建myid文件并在其中输入1，只输入1，代表server-1"><a href="#6-在-home-hewentian-ProjectD-zookeeperCluster-server1-data目录下建myid文件并在其中输入1，只输入1，代表server-1" class="headerlink" title="6.在/home/hewentian/ProjectD/zookeeperCluster/server1/data目录下建myid文件并在其中输入1，只输入1，代表server.1"></a>6.在<code>/home/hewentian/ProjectD/zookeeperCluster/server1/data</code>目录下建<code>myid</code>文件并在其中输入1，只输入1，代表server.1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1/data</span><br><span class="line">$ vi myid</span><br></pre></td></tr></table></figure>
<p>这样第一台服务器已经配置完毕。</p>
<h3 id="7-接下来我们将server1复制为server2-server3"><a href="#7-接下来我们将server1复制为server2-server3" class="headerlink" title="7.接下来我们将server1复制为server2, server3"></a>7.接下来我们将<code>server1</code>复制为<code>server2</code>, <code>server3</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster</span><br><span class="line">$ cp -r server1 server2</span><br><span class="line">$ cp -r server1 server3</span><br></pre></td></tr></table></figure>
<h3 id="8-将server2-data目录下的myid的内容修改为2"><a href="#8-将server2-data目录下的myid的内容修改为2" class="headerlink" title="8.将server2/data目录下的myid的内容修改为2"></a>8.将<code>server2/data</code>目录下的<code>myid</code>的内容修改为2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/data</span><br><span class="line">$ vi myid</span><br></pre></td></tr></table></figure>
<p>同理，将将<code>server3/data</code>目录下的<code>myid</code>的内容修改为3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/data</span><br><span class="line">$ vi myid</span><br></pre></td></tr></table></figure></p>
<h3 id="9-修改server2的配置文件"><a href="#9-修改server2的配置文件" class="headerlink" title="9.修改server2的配置文件"></a>9.修改<code>server2</code>的配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/conf/</span><br><span class="line">$ vi zoo.cfg</span><br></pre></td></tr></table></figure>
<p>仅修改两处地方即可，要修改的地方如下：</p>
<pre><code>dataDir=/home/hewentian/ProjectD/zookeeperCluster/server2/data  # 这里是数据保存的位置
clientPort=2182                                                 # 这台服务器的端口为2182
</code></pre><p>同理，修改<code>server3</code>的配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/conf/</span><br><span class="line">$ vi zoo.cfg</span><br></pre></td></tr></table></figure></p>
<p>仅修改两处地方即可，要修改的地方如下：</p>
<pre><code>dataDir=/home/hewentian/ProjectD/zookeeperCluster/server3/data  # 这里是数据保存的位置
clientPort=2183                                                 # 这台服务器的端口为2183
</code></pre><h3 id="10-到目前为此，我们已经将3台zookeeper服务器都配置好了。接下来，我们要将他们都启动"><a href="#10-到目前为此，我们已经将3台zookeeper服务器都配置好了。接下来，我们要将他们都启动" class="headerlink" title="10.到目前为此，我们已经将3台zookeeper服务器都配置好了。接下来，我们要将他们都启动"></a>10.到目前为此，我们已经将3台<code>zookeeper</code>服务器都配置好了。接下来，我们要将他们都启动</h3><p>启动server1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>启动server2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>启动server3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<h3 id="11-当三台服务器都启动好了，我们分别连到server1、server2、server3："><a href="#11-当三台服务器都启动好了，我们分别连到server1、server2、server3：" class="headerlink" title="11.当三台服务器都启动好了，我们分别连到server1、server2、server3："></a>11.当三台服务器都启动好了，我们分别连到server1、server2、server3：</h3><p>连接到server1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure></p>
<p>连接到server2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2182</span><br></pre></td></tr></table></figure></p>
<p>连接到server1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2183</span><br></pre></td></tr></table></figure></p>
<p>这样你在<code>server1</code>中所作的修改，都会同步到<code>server2</code>, <code>server3</code>。<br>例如你在server1中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ create /zk_test_cluster my_data_cluster</span><br></pre></td></tr></table></figure></p>
<p>你在server2, server3的客户端用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls /</span><br></pre></td></tr></table></figure></p>
<p>都会看到节点zk_test_cluster</p>
<h3 id="12-查看运行状态"><a href="#12-查看运行状态" class="headerlink" title="12. 查看运行状态"></a>12. 查看运行状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/</span><br><span class="line">$ ./bin/zkServer.sh status</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/bin/../conf/zoo.cfg</span><br><span class="line">Mode: leader</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/</span><br><span class="line">$ ./bin/zkServer.sh status</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br></pre></td></tr></table></figure>
<p>可以看到server2是leader，其他两台是follower。</p>
<p>集群部署结束。</p>
<h3 id="zookeeper三种角式"><a href="#zookeeper三种角式" class="headerlink" title="zookeeper三种角式"></a>zookeeper三种角式</h3><p>leader：负责进行投票的发起和决议，更新系统状态；<br>follower：负责接受客户端的请求并向客户端返回结果，在选主过程中参与投票；<br>observer：接受客户端的连接，将写请求转发给leader，但不参与投票，只同步leader的状态，observer的目的是为了扩展系统，提高读取速度。follower和observer统称为leaner。<br>client：客户端，请求发起方。</p>
<p>配置observer比较简单，只要在<code>zoo.cfg</code>中将要配置成为observer的机器加个后缀即可，如下：</p>
<pre><code>server.3=127.0.0.1:2890:3890:observer
</code></pre><h3 id="zookeeper的节点类型"><a href="#zookeeper的节点类型" class="headerlink" title="zookeeper的节点类型"></a>zookeeper的节点类型</h3><p>zookeeper有4种节点类型：</p>
<ol>
<li>PERSISTENT                持久化节点</li>
<li>PERSISTENT_SEQUENTIAL     顺序自动编号持久化节点，这种节点会根据当前已存在的节点数自动加 1</li>
<li>EPHEMERAL                 临时节点， 客户端session超时这类节点就会被自动删除</li>
<li>EPHEMERAL_SEQUENTIAL      临时自动编号节点</li>
</ol>
<p><strong> 注意：EPHEMERAL类型的节点不能有子节点 </strong></p>
<h3 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h3><ol>
<li>tickTime：zookeeper中使用的基本时间单位，毫秒值；</li>
<li>initLimit：由于zookeeper集群中包含多台server，其中一台为leader，其余的为follower。initLimit参数配置初始化连接时，follower和leader之间的最长心跳时间，此时该参数设置为5，说明时间限制为5倍tickTime, 即：5 * 2000 = 10000ms = 10s；</li>
<li>syncLimit：该参数配置leader和follower之间发送消息，请求和应答的最大时间长度。此时该参数设置为2，说明时间限制为2倍tickTime，即4000ms；</li>
<li>dataDir: 数据存放目录，可以是任意目录；</li>
<li>dataLogDir: log目录，同样可以是任意目录。如果没有设置该参数，将使用和dataDir相同的设置；</li>
<li>clientPort: 监听client连接的端口号；</li>
<li>server.X=A:B:C：其中X是一个数字，表示这是第几号server。A是该server所在的IP地址；B配置该server和集群中的leader交换消息所使用的端口；C配置选举leader时所使用的端口。由于配置的是伪集群模式，所以各个server的B，C参数必须不同。</li>
</ol>
<h3 id="zookeeper能帮我们做什么"><a href="#zookeeper能帮我们做什么" class="headerlink" title="zookeeper能帮我们做什么"></a>zookeeper能帮我们做什么</h3><ol>
<li>Hadoop使用zookeeper的事件处理确保整个集群只有一个NameNode存储配置信息等；</li>
<li>HBase使用zookeeper的事件处理确保整个集群只有一个HMaster，察觉HRegionServer联机和宕机、存储访问控制列表等。</li>
</ol>
<h3 id="一些要注意的"><a href="#一些要注意的" class="headerlink" title="一些要注意的"></a>一些要注意的</h3><ol>
<li>注册的Watcher消息只会通知一次；</li>
<li>节点需要奇数个的原因有二：（1）容错和偶数是一样的，所以没必要多台；（2）防止脑裂；</li>
<li>zookeeper两种模式：恢复模式（选主）和广播模式（Zab原子广播更新数据）；</li>
<li>zookeeper的4个特点：最终一致性、可靠性、原子性、顺序性（因为增删改都发给Leader）；</li>
<li>zookeeper的数据存放在内存中，但是会定期flush到磁盘dataDir的目录中。</li>
</ol>
<p>通过java api使用zookeeper的例子可以参见这里： <a href="https://github.com/hewentian/bigdata/blob/master/codes/hadoop-demo/src/main/java/com/hewentian/hadoop/utils/ZookeeperUtil.java">ZookeeperUtil.java</a>、<a href="https://github.com/hewentian/bigdata/tree/master/codes/hadoop-demo/src/main/java/com/hewentian/hadoop/zookeeper">zookeeper实现分布式锁、rmi高可用</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/06/zookeeper-cluster/" data-id="ckpo1myxv003quu3kc7ssytm0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-zookeeper-standalone" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/06/zookeeper-standalone/" class="article-date">
  <time datetime="2017-12-06T08:33:23.000Z" itemprop="datePublished">2017-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/06/zookeeper-standalone/">zookeeper 单机版安装方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="下面演示在-Ubuntu-16-04-LTS-下面安装-zookeeper"><a href="#下面演示在-Ubuntu-16-04-LTS-下面安装-zookeeper" class="headerlink" title="下面演示在 Ubuntu 16.04 LTS 下面安装 zookeeper"></a>下面演示在 Ubuntu 16.04 LTS 下面安装 zookeeper</h3><p>将<code>zookeeper-3.4.6.tar.gz</code>放到一个目录下，如<code>/home/hewentian/ProjectD</code><br>执行如下脚本解压<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD</span><br><span class="line">$ tar xzvf zookeeper-3.4.6.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>解压后得到zookeeper-3.4.6文件夹，进入conf目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> zookeeper-3.4.6/conf/</span><br></pre></td></tr></table></figure></p>
<p>执行如下命令，新建一个配置文件zoo.cfg<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure></p>
<p>修改zoo.cfg并在其中修改如下内容：</p>
<pre><code>tickTime=2000
dataDir=/home/hewentian/ProjectD/zookeeper-3.4.6/data
clientPort=2181
</code></pre><p>解压后的<code>zookeeper-3.4.6</code>目录下是没有<code>data</code>这个文件夹的，要执行如下命令创建<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeper-3.4.6/</span><br><span class="line">$ mkdir data</span><br></pre></td></tr></table></figure></p>
<p>修改好后，我们就可以进入bin目录下启动zookeeper了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeper-3.4.6/bin</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>启动后，我们可以连到zookeeper服务器，命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeper-3.4.6/bin</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure></p>
<h3 id="一些操作例子，如下："><a href="#一些操作例子，如下：" class="headerlink" title="一些操作例子，如下："></a>一些操作例子，如下：</h3><p>From here, you can try a few simple commands to get a feel for this simple command line interface. First, start by issuing the list command, as in ls, yielding:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 8] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure></p>
<p>Next, create a new znode by running create /zk_test my_data. This creates a new znode and associates the string “my_data” with the node. You should see:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 9] create /zk_test my_data</span><br><span class="line">Created /zk_test</span><br></pre></td></tr></table></figure></p>
<p>Issue another ls / command to see what the directory looks like:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 11] ls /</span><br><span class="line">[zookeeper, zk_test]</span><br></pre></td></tr></table></figure></p>
<p>Notice that the zk_test directory has now been created.<br>Next, verify that the data was associated with the znode by running the get command, as in:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 12] get /zk_test</span><br><span class="line">my_data</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 5</span><br><span class="line">mtime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure></p>
<p>We can change the data associated with zk_test by issuing the set command, as in:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 14] <span class="built_in">set</span> /zk_test junk</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 6</span><br><span class="line">mtime = Fri Jun 05 14:01:52 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br><span class="line">[zkshell: 15] get /zk_test</span><br><span class="line">junk</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 6</span><br><span class="line">mtime = Fri Jun 05 14:01:52 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure></p>
<p>(Notice we did a get after setting the data and it did, indeed, change.</p>
<p>Finally, let’s delete the node by issuing:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 16] delete /zk_test</span><br><span class="line">[zkshell: 17] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line">[zkshell: 18]</span><br></pre></td></tr></table></figure></p>
<p>That’s it for now. To explore more, continue with the rest of this document and see the Programmer’s Guide.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/06/zookeeper-standalone/" data-id="ckpo1myxu003muu3kszlz5hn2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/02/hexo-note/" class="article-date">
  <time datetime="2017-12-02T05:59:48.000Z" itemprop="datePublished">2017-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/02/hexo-note/">hexo 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h2 id="下面将详细说说安装过程，基于-Ubuntu-16-04-LTS："><a href="#下面将详细说说安装过程，基于-Ubuntu-16-04-LTS：" class="headerlink" title="下面将详细说说安装过程，基于 Ubuntu 16.04 LTS："></a>下面将详细说说安装过程，基于 Ubuntu 16.04 LTS：</h2><h3 id="1-安装-Git"><a href="#1-安装-Git" class="headerlink" title="1. 安装 Git"></a>1. 安装 Git</h3><p>在 Ubuntu 下面安裝非常方便，可以先在命令行中輸入<code>git</code>，如果没显示命令，则输入如下命令安装即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install git</span><br></pre></td></tr></table></figure></p>
<h3 id="2-安装-Node-js"><a href="#2-安装-Node-js" class="headerlink" title="2. 安装 Node.js"></a>2. 安装 Node.js</h3><p>先测试一下Node.js是否已安装，在命令行中直接输入<code>node</code>可以看到提示符变成了一个向右<br>的箭头就表示成功了，然后按ctrl + c退出node模式，出现$符号才表示正常了</p>
<p>如果未安裝 node，安裝方法如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install nodejs-legacy</span><br></pre></td></tr></table></figure></p>
<h3 id="3-安装-Hexo"><a href="#3-安装-Hexo" class="headerlink" title="3. 安装 Hexo"></a>3. 安装 Hexo</h3><p>进入到我们博客的仓库, 输入以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install -g hexo-cli</span><br><span class="line">或者</span><br><span class="line">$ sudo npm install hexo --save  <span class="comment"># 或者去掉 sudo</span></span><br></pre></td></tr></table></figure></p>
<p>敲完回车可能没有任何提示，请一定要耐心等待<br>安装成功后，可以输入以下命令测试一下Hexo是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo version</span><br></pre></td></tr></table></figure></p>
<p>如果能看到hexo的版本号信息，就表示安装成功了<br>接下来，进入到我们博客的仓库</p>
<p>然后依次输入以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init  <span class="comment"># 注意此命令，要求当前仓库为空，可以先将仓库的文件移走，再执行此命令，然后再将文件移回来。</span></span><br><span class="line">$ <span class="comment"># 可以先在当前目录的父目录创建临时目录hgi</span></span><br><span class="line">$ mkdir ../hgi</span><br><span class="line">$ mv * ../hgi <span class="comment"># 这个命令不会将 .git .gitignore这两个文件夹移走，所以，还要执行如下命令</span></span><br><span class="line">$ mv .git .gitignore ../hgi/</span><br><span class="line">$ npm install</span><br><span class="line">$ hexo g</span><br><span class="line">$ hexo s</span><br></pre></td></tr></table></figure></p>
<p>这时候在浏览器输入<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a> 就可以看到hexo已经成功生成了博客，当然这只是我们本地可以看到的</p>
<p>最后将博客的仓库目录下除了<code>node_modules</code>之外的文件都删掉，然后将 ../hgi 中的除了<code>node_modules</code>之外的文件都复制回来(不要忘记.git .gitignore)，大功告成。<br>重启hexo</p>
<p>配置Hexo到Github</p>
<p>找到我们刚刚创建的文件夹，在里面找到_config.yml文件，用notepad++打开，直接拖到最后，添加如下：</p>
<pre><code>deploy:
  type: git
  repository: git@github.com:hewentian/hewentian.github.io.git
  branch: master
</code></pre><p>发布到 github<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo g</span><br><span class="line">$ hexo d</span><br></pre></td></tr></table></figure></p>
<p>如果出现以下异常</p>
<pre><code>ERROR Deployer not found: git
</code></pre><p>尝试输入以下命令，然后重新执行刚刚的两条命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p>
<p>这时候我们就可以在浏览器输入 <a href="https://hewentian.github.io" target="_blank" rel="noopener">https://hewentian.github.io</a> 就可以看到博客已经搭建成功了。</p>
<p>使用以下命令验证是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">$ npm -v</span><br><span class="line">$ hexo -v</span><br></pre></td></tr></table></figure></p>
<p>解释一下：<br>node_modules：是依赖包<br>public：存放的是生成的页面<br>scaffolds：命令生成文章等的模板<br>source：用命令创建的各种文章<br>themes：主题<br>_config.yml：整个博客的配置<br>db.json：source解析所得到的<br>package.json：项目所需模块项目的配置信息</p>
<p>添加博文<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">"postName"</span>  <span class="comment">#新建博文,其中postName是博文题目</span></span><br></pre></td></tr></table></figure></p>
<p>博文会自动生成在博客目录下source/_posts/postName.md</p>
<p>注意事项</p>
<p>所有键的冒号后面留一个空格，如 <code>language: zh-CN</code></p>
<p>一些常用命令：<br>hexo new “postName” #新建文章<br>hexo new page “pageName” #新建页面<br>hexo generate #生成静态页面至public目录, hexo g<br>hexo server #开启预览访问端口（默认端口4000，’ctrl + c’关闭server）, hexo s<br>hexo deploy #将.deploy目录部署到GitHub, hexo d<br>hexo help # 查看帮助<br>hexo version #查看Hexo的版本</p>
<h3 id="ENOSPC-Error-Linux-报错的处理"><a href="#ENOSPC-Error-Linux-报错的处理" class="headerlink" title="ENOSPC Error (Linux)报错的处理"></a>ENOSPC Error (Linux)报错的处理</h3><p>如果启动的时候报如下错误：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br><span class="line">INFO  Start processing</span><br><span class="line">FATAL Something<span class="string">'s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span></span><br><span class="line"><span class="string">Error: watch /home/hewentian/ProjectD/gitHub/hewentian.github.io/themes/landscape/ ENOSPC</span></span><br><span class="line"><span class="string">    at _errnoException (util.js:1022:11)</span></span><br><span class="line"><span class="string">    at FSWatcher.start (fs.js:1382:19)</span></span><br><span class="line"><span class="string">    at Object.fs.watch (fs.js:1408:11)</span></span><br><span class="line"><span class="string">    at createFsWatchInstance (/home/hewentian/ProjectD/gitHub/hewentian.github.io/node_modules/chokidar/lib/nodefs-handler.js:37:15)</span></span><br><span class="line"><span class="string">    at setFsWatchListener (/home/hewentian/ProjectD/gitHub/hewentian.github.io/node_modules/chokidar/lib/nodefs-handler.js:80:15)</span></span><br><span class="line"><span class="string">    at FSWatcher.NodeFsHandler._watchWithNodeFs (/home/hewentian/ProjectD/gitHub/hewentian.github.io/node_modules/chokidar/lib/nodefs-handler.js:228:14)</span></span><br><span class="line"><span class="string">    at FSWatcher.NodeFsHandler._handleDir (/home/hewentian/ProjectD/gitHub/hewentian.github.io/node_modules/chokidar/lib/nodefs-handler.js:407:19)</span></span><br><span class="line"><span class="string">    at FSWatcher.&lt;anonymous&gt; (/home/hewentian/ProjectD/gitHub/hewentian.github.io/node_modules/chokidar/lib/nodefs-handler.js:455:19)</span></span><br><span class="line"><span class="string">    at FSWatcher.&lt;anonymous&gt; (/home/hewentian/ProjectD/gitHub/hewentian.github.io/node_modules/chokidar/lib/nodefs-handler.js:460:16)</span></span><br><span class="line"><span class="string">    at FSReqWrap.oncomplete (fs.js:153:5)</span></span><br></pre></td></tr></table></figure></p>
<p>可以尝试通过如下方式解决：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm dedupe</span><br><span class="line">$ <span class="built_in">echo</span> fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf &amp;&amp; sudo sysctl -p</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/02/hexo-note/" data-id="ckpo1mywx000puu3ktb8hcn8o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/16/java-note/" class="article-date">
  <time datetime="2017-11-16T11:58:45.000Z" itemprop="datePublished">2017-11-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/16/java-note/">java 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="想在eclipse中新建类的时候，自动在类的头部插入作者、时间等信息"><a href="#想在eclipse中新建类的时候，自动在类的头部插入作者、时间等信息" class="headerlink" title="想在eclipse中新建类的时候，自动在类的头部插入作者、时间等信息"></a>想在<code>eclipse</code>中新建类的时候，自动在类的头部插入作者、时间等信息</h3><p>方法是<code>Window -&gt; Preferences -&gt; Java -&gt; Code Style -&gt; Code Templates</code>在右则民展开<code>Code -&gt; New Java files</code>点<code>Edit...</code>并加入如下代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$&#123;filecomment&#125;</span><br><span class="line">$&#123;package_declaration&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;$&#123;file_name&#125;&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> $&#123;currentDate:date('yyyy-MM-dd')&#125; $&#123;time&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$&#123;typecomment&#125;</span><br><span class="line">$&#123;type_declaration&#125;</span><br></pre></td></tr></table></figure></p>
<p>而在IDEA中的操作方法是：<br><code>File -&gt; Settings -&gt; File and Code Templates</code>，在右则选中Class，然后填入：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#if ($&#123;PACKAGE_NAME&#125; &amp;&amp; $&#123;PACKAGE_NAME&#125; != "")package $&#123;PACKAGE_NAME&#125;;#end</span><br><span class="line">#parse("File Header.java")</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;$&#123;NAME&#125;&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> $&#123;YEAR&#125;-$&#123;MONTH&#125;-$&#123;DAY&#125; $&#123;HOUR&#125;:$&#123;MINUTE&#125;:$&#123;SECOND&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;NAME&#125; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Remote-System-Explorer-Operation总是运行后台服务，卡死eclipse解决办法"><a href="#Remote-System-Explorer-Operation总是运行后台服务，卡死eclipse解决办法" class="headerlink" title="Remote System Explorer Operation总是运行后台服务，卡死eclipse解决办法"></a>Remote System Explorer Operation总是运行后台服务，卡死eclipse解决办法</h3><p>eclipse后台进程在远程操作，右下角显示的“Remote System Explorer Operation”。折腾了半天，在Stack Overflow找到答案 <a href="https://stackoverflow.com/questions/1631817/remote-system-explorer-operation-causing-freeze-for-couple-of-seconds" target="_blank" rel="noopener">源地址</a>。解决方案如下：</p>
<pre><code>step1: Eclipse -&gt; Preferences -&gt; General -&gt; Startup and Shutdown.
    -Uncheck RSE UI.

step2: Eclipse -&gt; Preferences -&gt; Remote Systems.
    -Uncheck Re-open Remote Systems view to previous state.
</code></pre><p>Update your Eclipse to 4.3.1 (at least) due to a bug on previous version.</p>
<p>Restart Eclipse and its done.</p>
<ol>
<li>线程安全概念：当多个线程访问某一个类（对象或方法）时，这个类始终都能表现出正确的行为，那么这个类（对象或方法）就是线程安全的。</li>
<li>synchronized：可以在何意对象及方法上加锁，而加锁的这段段码称为“互斥区”或“临界区”。</li>
</ol>
<p>当多个线程访问某个synchronized修饰的方法时，以排队的方式进行处理（这里的排除是按照CPU分配时间片的先后顺序而定的），一个线程想要执行这个方法时，首先是尝试获得锁，如果拿到锁，就执行；否则，就会不断的尝试去获得这把锁，直到拿到为止，而且是多个线程同时去竞争这把锁。在static方法上加上synchronized关键字，表示锁定.class类，类一级别的锁（独占.class类)</p>
<p>一个类中有两个方法都有synchronized修饰的话，多线程分别访问这两个方法都会进行等待，因为它们都共用同一个锁。如果其中一个没有synchronized修饰的话，多线程就可以同时访问，而不需等待。</p>
<h3 id="Integer-valueOf产生的死锁"><a href="#Integer-valueOf产生的死锁" class="headerlink" title="Integer.valueOf产生的死锁"></a>Integer.valueOf产生的死锁</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncAddRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a;</span><br><span class="line">	<span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SyncAddRunnable</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.a = a;</span><br><span class="line">		<span class="keyword">this</span>.b = b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">synchronized</span> (Integer.valueOf(a)) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (Integer.valueOf(b)) &#123;</span><br><span class="line">				System.out.println(a + b);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> SyncAddRunnable(<span class="number">1</span>, <span class="number">2</span>)).start();</span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> SyncAddRunnable(<span class="number">2</span>, <span class="number">1</span>)).start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>上面的程序会造成死锁，其原因是Integer.valueOf方法基于减少对象创建次数和节省内存的考虑，[-128, 127]之间的数字会被缓存（默认值，实际值取决于<code>java.lang.Integer.IntegerCache.high</code>参数的设置），当valueOf()方法传入的参数在这个范围之内，将直接返回缓存中的对象，也就是说，代码中调用了200次Integer.valueOf方法一共就只返回了2个不同的对象。假如在某个线程的两个synchronized块之间发生了线程切换，那就会出现线程A等待被线程B持有的Integer.valueOf(1)，而线程B又等待着线程A持有的Integer.valueOf(2)，结果就出现了死锁了。</p>
<h3 id="只保留3位小数"><a href="#只保留3位小数" class="headerlink" title="只保留3位小数"></a>只保留3位小数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.text.NumberFormat numberFormat = java.text.NumberFormat.getNumberInstance();</span><br><span class="line">numberFormat.setMaximumFractionDigits(<span class="number">3</span>);</span><br><span class="line">System.out.println(numberFormat.format(<span class="number">3.1415927</span>d)); <span class="comment">// 3.142</span></span><br></pre></td></tr></table></figure>
<h3 id="数字转成百分比"><a href="#数字转成百分比" class="headerlink" title="数字转成百分比"></a>数字转成百分比</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.text.NumberFormat percentFormat = java.text.NumberFormat.getPercentInstance();</span><br><span class="line">percentFormat.setMaximumFractionDigits(<span class="number">2</span>); <span class="comment">// 最大小数位数</span></span><br><span class="line">percentFormat.setMinimumFractionDigits(<span class="number">2</span>); <span class="comment">// 最小小数位数</span></span><br><span class="line">percentFormat.setMaximumIntegerDigits(<span class="number">2</span>); <span class="comment">// 最大整数位数，多了会截掉最前面的</span></span><br><span class="line">percentFormat.setMinimumIntegerDigits(<span class="number">2</span>); <span class="comment">// 最小整数位数，不够会在最前面补0</span></span><br><span class="line">System.out.println(percentFormat.format(<span class="number">3.1415927</span>d)); <span class="comment">// 14.16%</span></span><br><span class="line">System.out.println(percentFormat.format(<span class="number">0.0415927</span>d)); <span class="comment">// 04.16%</span></span><br></pre></td></tr></table></figure>
<h3 id="btrace的使用"><a href="#btrace的使用" class="headerlink" title="btrace的使用"></a>btrace的使用</h3><p>要使用btrace，必须先到这里下载：<br><a href="https://github.com/btraceio/btrace">https://github.com/btraceio/btrace</a><br>下载之后，解压到指定目录，还要配置系统的环境变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/hewentian/Downloads</span><br><span class="line"></span><br><span class="line">$ tar xf btrace-bin-1.3.11.tar.gz </span><br><span class="line">$ mv btrace-bin-1.3.11 /usr/<span class="built_in">local</span>/btrace-bin-1.3.11/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改环境变量</span></span><br><span class="line">$ vi /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在/etc/profile中增加以下内容</span></span><br><span class="line"><span class="comment"># add btrace</span></span><br><span class="line"><span class="built_in">export</span> BTRACE_HOME=/usr/<span class="built_in">local</span>/btrace-bin-1.3.11</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$BTRACE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>下面用一个例子，演示如何使用：<br>示例1：获取方法参数以及返回值<br>将下面的代码保存为BTraceTest.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hewentian;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;BTtraceTest.java&lt;/b&gt; 是</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-04-19 3:57:22 PM</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BTraceTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">whoAreYou</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"I'm "</span> + name + <span class="string">", "</span> + age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			String sayYou = whoAreYou(<span class="string">"Lily"</span>, <span class="number">23</span>);</span><br><span class="line">			System.out.println(sayYou);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面的是测试代码，同样是JAVA代码，将其保存为Btrace.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;Btrace.java&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-04-19 4:02:37 PM</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.sun.btrace.BTraceUtils.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.btrace.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Btrace</span> </span>&#123;</span><br><span class="line">	<span class="meta">@OnMethod</span>(clazz = <span class="string">"com.hewentian.BTraceTest"</span>, method = <span class="string">"whoAreYou"</span>, location = <span class="meta">@Location</span>(Kind.RETURN))</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">whoAreYou</span><span class="params">(String name, <span class="keyword">int</span> age, @Return String result)</span> </span>&#123;</span><br><span class="line">		println(<span class="string">"name: "</span> + name);</span><br><span class="line">		println(<span class="string">"age: "</span> + age);</span><br><span class="line">		println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面开始测试：<br>在一个console中执行如下命令，将程序启动<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ javac -d . BTraceTest.java	<span class="comment"># 编译</span></span><br><span class="line">$ java com.hewentian.BTraceTest <span class="comment"># 运行</span></span><br><span class="line"></span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">btrace WARNING: Invalid <span class="string">'libs'</span> configuration [null]. Path <span class="string">'/usr/local/btrace-bin-1.3.11/build/btrace-libs'</span> does not exist.</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br></pre></td></tr></table></figure></p>
<p>在另一个console中执行如下命令，查询上面的程序的PID，以便用于监控<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ jps -v</span><br><span class="line">4498 BTraceTest</span><br><span class="line">4516 Jps -Denv.class.path=.:/usr/<span class="built_in">local</span>/java/jdk1.8.0_102/lib:/usr/<span class="built_in">local</span>/java/jdk1.8.0_102/jre/lib: -Dapplication.home=/usr/<span class="built_in">local</span>/java/jdk1.8.0_102 -Xms8m</span><br><span class="line">2614 org.eclipse.equinox.launcher_1.4.0.v20161219-1356.jar -Dosgi.requiredJavaVersion=1.8 -Xms40m -Dosgi.module.lock.timeout=10 -Xverify:none -Xmx1200m</span><br></pre></td></tr></table></figure></p>
<p>可以看到，我们的程序BTraceTest的PID为4498，执行下面的程序，开启btrace<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ btrace 4498 Btrace.java</span><br><span class="line"></span><br><span class="line">name: Lily</span><br><span class="line">age: 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">name: Lily</span></span><br><span class="line"><span class="string">age: 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">name: Lily</span><br><span class="line">age: 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">name: Lily</span></span><br><span class="line"><span class="string">age: 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">name: Lily</span><br><span class="line">age: 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br></pre></td></tr></table></figure></p>
<p>示例2：计算方法运行消耗的时间，这在实际中非常有用<br>将下面的代码保存为BtraceDuration.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;BtraceDuration.java&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-04-19 4:46:50 PM</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.sun.btrace.BTraceUtils.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.btrace.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtraceDuration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@OnMethod</span>(clazz = <span class="string">"com.hewentian.BTraceTest"</span>, method = <span class="string">"whoAreYou"</span>, location = <span class="meta">@Location</span>(Kind.RETURN))</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">whoAreYou</span><span class="params">(@Duration <span class="keyword">long</span> duration)</span> </span>&#123;</span><br><span class="line">		println(strcat(<span class="string">"duration(ms): "</span>, str(duration / <span class="number">1000000</span>))); <span class="comment">// duration的单位是纳秒，要除以 1,000,000 才是毫秒</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同样是按示例1的流程执行即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ jps</span><br><span class="line"><span class="number">2614</span> org.eclipse.equinox.launcher_1.4.0.v20161219-<span class="number">1356</span>.jar</span><br><span class="line"><span class="number">5258</span> Jps</span><br><span class="line"><span class="number">5243</span> BTraceTest</span><br><span class="line"></span><br><span class="line">$ btrace <span class="number">5243</span> BtraceDuration.java </span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br></pre></td></tr></table></figure></p>
<p>btrace的介绍就到这里，这只是入门。更多内容，参考<a href="http://calvin1978.blogcn.com/articles/btrace1.html" target="_blank" rel="noopener">这篇文章</a>，它写得非常好。</p>
<p>在我们对一个对象的方法加锁的时候，需要考虑业务的整体性，即为getter/setter方法同时加锁synchronized同步关键字，保证业务的原子性。以免出现脏读。</p>
<p>关键字synchronized拥有重入锁的功能，也就是说在使用synchronized时，当一个线程得到了一个对象的锁后，再次请求此对象时是可以再次得到该对象的锁。</p>
<p>同步方法直接在方法上加synchronized实现加锁，同步代码块则在方法内部加锁，很明显，同步方法锁的范围比较大，而同步代码块范围要小点，一般同步的范围越大，性能就越差，一般需要加锁进行同步的时候，肯定是范围越小越好，这样性能更好</p>
<p>ReentrantLock可重入锁的意思是，一个线程可以对已被加锁的ReentrantLock锁再次加锁，ReentrantLock对象会维持一个计数器来追踪lock()方法的嵌套调用，线程在每次调用lock()加锁后，必须显式调用unlock()来释放锁，所以一段被锁保护的代码可以调用另一个被相同锁保护的方法。</p>
<p>所以我们在用synchronized关键字的时候，能缩小代码段的范围就尽量缩小，能在代码段上加同步就不要再整个方法上加同步。这叫减小锁的粒度，使代码更大程度的并发。</p>
<p>wait notfiy 方法，wait释放锁，notfiy不释放锁。用这种方式会有不实时的坏处。因为虽然A线程发出了notify，但是它不释放锁，这样B线程还需要wait直到A执行完它的时间片。可以使用CountDownLatch来实现实时。</p>
<p>Object类的方法有：</p>
<ol>
<li>public: notify(), notifyAll();</li>
<li>public: wait(), wait(long),wait(long, int);</li>
<li>public: toString(), equals(Object), hashCode(), getClass();</li>
<li>protected: clone(), finalize();</li>
<li>private: registerNatives().</li>
</ol>
<p>动态类型语言的关键特征是它的类型检查的主体过程是在运行期而不是在编译期。</p>
<p>java性能测试工具jmeter：<a href="http://jmeter.apache.org/" target="_blank" rel="noopener">http://jmeter.apache.org/</a><br>和它的好搭档badboy：<a href="http://www.badboy.com.au/" target="_blank" rel="noopener">http://www.badboy.com.au/</a><br>jvisualvm</p>
<h3 id="trim-无法去掉空格"><a href="#trim-无法去掉空格" class="headerlink" title="trim()无法去掉空格"></a>trim()无法去掉空格</h3><p>ascii码里有两个空格(space), 一个是ascii码32，一个是ascii码160，它们的区别是：</p>
<ol>
<li>平时我们用键盘输入的空格的ASCII值是32；</li>
<li>而这个ASCII值为160的空格，其实是不间断空格(non-breaking space)，我们平时一定也用过很多次，就是页面上的<code>&amp;nbsp;</code>所产生的空格；</li>
<li><p>不间断空格non-breaking space的缩写正是nbsp。这中空格的作用就是在页面换行时不被打断，例如：页面某一行的末尾是一个人名Zhu Xiaoli</p>
<ol>
<li><p>如果使用了平常的空格，就会被页面压缩，变成下边这样<br>Zhu<br>Xiaoli</p>
</li>
<li><p>如果使用了160空格，就会是这样： Zhu Xiaoli</p>
</li>
</ol>
</li>
</ol>
<p>但是不间断空格有个问题，就是它无法被trim()所裁剪，也无法被正则表达式的\s所匹配，也无法被StringUtils的isBlank()所识别，也就是说，无法像裁剪寻常空格那样移除这个不间断空格。不过，我们可以利用不间断空格的Unicode编码来移除它，其编码为<code>\u00A0</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"abc"</span>;</span><br><span class="line">s = (<span class="keyword">char</span>) <span class="number">32</span> + s;</span><br><span class="line">s = s + (<span class="keyword">char</span>) <span class="number">160</span>;</span><br><span class="line"></span><br><span class="line">s = s.trim();</span><br><span class="line">System.out.println(s); <span class="comment">// abc ，前面的空格去掉了，但是后面的还在</span></span><br><span class="line"></span><br><span class="line">s = s.replaceAll(<span class="string">"[\\u00A0]+"</span>, <span class="string">""</span>);</span><br><span class="line">System.out.println(s); <span class="comment">// abc，这里后面的空格也去掉了</span></span><br></pre></td></tr></table></figure></p>
<h3 id="命令行下替换jar包中指定文件"><a href="#命令行下替换jar包中指定文件" class="headerlink" title="命令行下替换jar包中指定文件"></a>命令行下替换jar包中指定文件</h3><ol>
<li><p>列出指定文件的路径</p>
<pre><code>jar -tvf test.jar | grep config.properties
</code></pre></li>
<li><p>解压指定路径下的文件</p>
<pre><code>jar -xvf test.jar conf/config.properties
</code></pre></li>
<li><p>修改文件</p>
</li>
<li><p>更新到jar包中</p>
<pre><code>jar -uvf test.jar conf/config.properties
</code></pre></li>
</ol>
<h3 id="IDEA一个工作空间打开多个项目"><a href="#IDEA一个工作空间打开多个项目" class="headerlink" title="IDEA一个工作空间打开多个项目"></a>IDEA一个工作空间打开多个项目</h3><p>如果，多个项目之间不是parent和module的关系，IDEA一个工作空间只能打开一个项目。这样的话，<br>如果有多个项目，来回切换视图让人烦不胜烦。在IDEA一个工作空间中打开多个项目的方法。</p>
<ol>
<li>首先打开一个项目；</li>
<li>点击项目右边的Maven Project，并点击绿色的<code>+</code>号；</li>
<li>找到要打开的另一个项目，选中pom.xml文件，点击 [ok] 即可。</li>
</ol>
<h3 id="Ubuntu卸载IDEA"><a href="#Ubuntu卸载IDEA" class="headerlink" title="Ubuntu卸载IDEA"></a>Ubuntu卸载IDEA</h3><p>缓存目录：~/.cache/JetBrains<br>配置目录：~/.config/JetBrains<br>插件目录：~/.local/share/JetBrains<br>快速启动图标：~/.local/share/applications/jetbrains-idea.desktop</p>
<h3 id="IntelliJ-IDEA-版本控制不显示颜色提示的解决方法"><a href="#IntelliJ-IDEA-版本控制不显示颜色提示的解决方法" class="headerlink" title="IntelliJ IDEA 版本控制不显示颜色提示的解决方法"></a>IntelliJ IDEA 版本控制不显示颜色提示的解决方法</h3><p>依次点击<code>File -&gt; Settings -&gt; Version Control</code>，在右则面板中可以看到<code>Unregistered roots</code>，选择下面的项目，然后点击右则的<code>+</code>，最后点击<code>Apply</code>即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/16/java-note/" data-id="ckpo1myx5001duu3kz5o6oh4r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-maven-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/10/maven-note/" class="article-date">
  <time datetime="2017-11-09T16:48:44.000Z" itemprop="datePublished">2017-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/maven-note/">maven 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="在ubuntu上面安装-maven"><a href="#在ubuntu上面安装-maven" class="headerlink" title="在ubuntu上面安装 maven"></a>在ubuntu上面安装 maven</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ su root</span><br><span class="line">$ <span class="built_in">cd</span> /home/hewentian/Downloads</span><br><span class="line">$ tar xzvf apache-maven-3.3.9-bin.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">$ mv /home/hewentian/Downloads/apache-maven-3.3.9 ./</span><br><span class="line"></span><br><span class="line">$ vi /etc/profile</span><br><span class="line"><span class="comment"># 在打开的文件中添加如下代码</span></span><br><span class="line"><span class="comment"># add maven</span></span><br><span class="line"><span class="built_in">export</span> M2_HOME=/usr/<span class="built_in">local</span>/apache-maven-3.3.9</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$M2_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br><span class="line">$ mvn -version</span><br><span class="line"></span><br><span class="line">Maven home: /usr/<span class="built_in">local</span>/apache-maven-3.3.9</span><br><span class="line">Java version: 1.8.0_102, vendor: Oracle Corporation</span><br><span class="line">Java home: /usr/<span class="built_in">local</span>/java/jdk1.8.0_102/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: <span class="string">"linux"</span>, version: <span class="string">"4.10.0-28-generic"</span>, arch: <span class="string">"amd64"</span>, family: <span class="string">"unix"</span></span><br></pre></td></tr></table></figure>
<p>maven的学习有个好网站：<a href="https://howtodoinjava.com/maven/" target="_blank" rel="noopener">https://howtodoinjava.com/maven/</a></p>
<h3 id="Maven-Dependency-Scopes"><a href="#Maven-Dependency-Scopes" class="headerlink" title="Maven Dependency Scopes"></a>Maven Dependency Scopes</h3><p>Maven dependency scope attribute is used to specify the visibility of a dependency, relative to the different lifecycle phases (build, test, runtime etc). Maven provides six scopes i.e. compile, provided, runtime, test, system, and import.</p>
<ol>
<li>Compile Scope</li>
<li>Provided Scope</li>
<li>Runtime Scope</li>
<li>Test Scope</li>
<li>System Scope</li>
<li>Import Scope</li>
</ol>
<p>详情：<a href="https://howtodoinjava.com/maven/maven-dependency-scopes/" target="_blank" rel="noopener">https://howtodoinjava.com/maven/maven-dependency-scopes/</a></p>
<h3 id="External-Dependency"><a href="#External-Dependency" class="headerlink" title="External Dependency"></a>External Dependency</h3><p>Some times, you will have to refer jar files which are not in maven repository (neither local, central or remote repository). You can use these jars by placing them in project’s lib folder and configure the external dependency like this:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>extDependency<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>extDependency<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;basedir&#125;\war\WEB-INF\lib\extDependency.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>The groupId and artifactId are both set to the name of the dependency.</li>
<li>The scope element value is set to system.</li>
<li>The systemPath element refer to the location of the JAR file.</li>
</ul>
<h3 id="Maven-Dependency-Tree"><a href="#Maven-Dependency-Tree" class="headerlink" title="Maven Dependency Tree"></a>Maven Dependency Tree</h3><p>Using maven’s dependency:tree command, you can view list of all dependencies into your project – transitively. Transitive dependency means that if A depends on B and B depends on C, then A depends on both B and C.</p>
<p>Transitivity brings a very serious problem when different versions of the same artifacts are included by different dependencies. It may cause version mismatch issue in runtime. In this case, dependency:tree command is be very useful in dealing with conflicts of JARs.</p>
<pre><code>$ mvn dependency:tree
</code></pre><h3 id="Maven-Dependency-Exclusion"><a href="#Maven-Dependency-Exclusion" class="headerlink" title="Maven Dependency Exclusion"></a>Maven Dependency Exclusion</h3><p>Apart from version mismatch issue caused with transitive dependency, there can be version mismatch between project artifacts and artifacts from the platform of deployment, such as Tomcat or another server.</p>
<p>To resolve such version mismatch issues, maven provides <exclusion> tag, in order to break the transitive dependency.</exclusion></p>
<p>For example, when you have JUnit 4.12 in classpath and including DBUnit dependency, then you will need to remove JUnit 3.8.2 dependency. It can be done with exclusion tag.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.dbunit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dbunit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;dbunit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Exclude transitive dependency to JUnit-3.8.2 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="maven常用命令"><a href="#maven常用命令" class="headerlink" title="maven常用命令"></a>maven常用命令</h3><p>编译，编译后会生成target目录<br>        mvn compile</p>
<p>清理，将编译生成的target目录删掉<br>        mvn clean</p>
<p>打包，将编译生成的target目录下的class文件打成jar包<br>        mvn package</p>
<p>安装到本地仓库，把打好的包放入本地仓库(~/.m2/repository)<br>        mvn install</p>
<p>安装到远程仓库，把打好的包发布到远程仓库<br>        mvn deploy</p>
<p>一般组合使用这些使用，如<code>mvn clean compile</code>、<code>mvn clean package</code></p>
<p>在<code>eclipse</code>中，遇到Missing artifact jdk.tools:jdk.tools:jar:1.8</p>
<p>原因：tools.jar包是JDK的，而tools.jar并未在仓库<code>maven repository</code>中</p>
<p>解决方案：在pom文件中添加如下代码即可<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jdk.tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jdk.tools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;JAVA_HOME&#125;/lib/tools.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 pom.xml文件中不要写如下这样的配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.home</span>&gt;</span>/usr/local/java/jdk1.8.0_102<span class="tag">&lt;/<span class="name">java.home</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jre<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jre<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;java.home&#125;/lib/rt.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>去掉<code>&lt;java.home&gt;/usr/local/java/jdk1.8.0_102&lt;/java.home&gt;</code>配置，这时<code>java.home</code>变量继承自<code>eclipse</code>的<code>java.home</code>配置。从pom.xml文件的Effective POM可以查看到java.home变量被替换了，eclipse的java.home路径在<code>help-&gt;about eclipse-&gt;Installation Details-&gt;configuration</code>页可以找到。</p>
<h3 id="解决SecurityException问题"><a href="#解决SecurityException问题" class="headerlink" title="解决SecurityException问题"></a>解决SecurityException问题</h3><p>在使用maven打JAR包，在运行的时候可能会抛如下异常：</p>
<pre><code>Exception in thread “main” java.lang.SecurityException: Invalid signature file digest for Manifest main attributes
</code></pre><p>原因：由于重复引用某些依赖，导致在maven打包之后生成了一些.SF等文件，运行jar时会抛出。在META-INF下会有多余的以SF、RSA结尾的文件，删除后不会出现次问题</p>
<p>如无法重新打包，则解决方法如下：</p>
<pre><code>zip -d yourjar.jar &apos;META-INF/.SF&apos; &apos;META-INF/.RSA&apos; &apos;META-INF/*SF&apos;
</code></pre><p>最好的方法是在pom.xml中配置打包的时候忽略这些文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filters</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifact</span>&gt;</span>*:*<span class="tag">&lt;/<span class="name">artifact</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.SF<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.DSA<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.RSA<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="maven跳过单元测试的方式"><a href="#maven跳过单元测试的方式" class="headerlink" title="maven跳过单元测试的方式"></a>maven跳过单元测试的方式</h3><ol>
<li><p><code>-DskipTests</code>： 编译测试用例类生成相应的class文件至target/test-classes下，但不执行测试用例，当然，也可以直接在POM文件中写上：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.0-M3&lt;/version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;skipTests&gt;<span class="literal">true</span>&lt;/skipTests&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-Dmaven.test.skip=true</code>： 不编译测试用例类，也不执行测试用例；</p>
</li>
</ol>
<p>打包的时候跳过单元测试：</p>
<pre><code>mvn package -Dmaven.test.skip=true
</code></pre><h3 id="maven打包并指定main方法"><a href="#maven打包并指定main方法" class="headerlink" title="maven打包并指定main方法"></a>maven打包并指定main方法</h3><p>pom.xml配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">createDependencyReducedPom</span>&gt;</span>false<span class="tag">&lt;/<span class="name">createDependencyReducedPom</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">transformer</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">implementation</span>=<span class="string">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!--指定main方法--&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.hewentian.jdk.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="创建maven项目"><a href="#创建maven项目" class="headerlink" title="创建maven项目"></a>创建maven项目</h3><p>在IDEA中可以通过<code>File -&gt; New -&gt; Module</code>，打开<code>New Module</code>对话框，在左则选择Maven，并在右则勾选<code>Create from archetype</code>：</p>
<ol>
<li>创建jar项目，则选择<code>org.apache.maven.archetypes:maven-archetype-quickstart</code>；</li>
<li>创建web项目，则选择<code>org.apache.maven.archetypes:maven-archetype-webapp</code>；</li>
</ol>
<h3 id="maven-shade-plugin插件"><a href="#maven-shade-plugin插件" class="headerlink" title="maven-shade-plugin插件"></a>maven-shade-plugin插件</h3><p>此插件的主要功能：</p>
<ol>
<li>将依赖的jar包打包到当前jar包中，常规打包是不会将所依赖jar包打进来的；</li>
<li>指定jar包的默认运行方法：<a href="https://maven.apache.org/plugins/maven-shade-plugin/examples/executable-jar.html；" target="_blank" rel="noopener">https://maven.apache.org/plugins/maven-shade-plugin/examples/executable-jar.html；</a></li>
<li>为jar包选择指定的内容：<a href="https://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html" target="_blank" rel="noopener">https://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html</a></li>
</ol>
<p>详细介绍详见：<a href="http://maven.apache.org/plugins/maven-shade-plugin/plugin-info.html" target="_blank" rel="noopener">http://maven.apache.org/plugins/maven-shade-plugin/plugin-info.html</a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- To define the plugin version in your parent POM --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- To use the plugin goals in your POM or parent POM --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/10/maven-note/" data-id="ckpo1myxb001vuu3k5ufcrik9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/">maven</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-html-css" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/10/html-css/" class="article-date">
  <time datetime="2017-11-09T16:37:57.000Z" itemprop="datePublished">2017-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/html-css/">html-css 前端相关</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>将图片二进制流显示在html端的img控件中，在获取验证码的时候用得比较多，方法如下<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/jpeg;base64,fejwiqpofewqlfjewqjfewopfjef..."</span>&gt;</span></span><br><span class="line"></span><br><span class="line">在 src 后面加上 data:image/jpeg;base64,二进制码.</span><br></pre></td></tr></table></figure></p>
<h3 id="HTTPS网页调用HTTP服务"><a href="#HTTPS网页调用HTTP服务" class="headerlink" title="HTTPS网页调用HTTP服务"></a>HTTPS网页调用HTTP服务</h3><p>有时候，我们可能会在HTTPS的站点内通过Javascript脚本访问HTTP服务器，这时候，网页可能会报如下错误：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mixed Content: The page at 'https://www.a.com' was loaded over HTTPS, but requested an insecure XMLHttpRequest endpoint 'http://api.b.com/data/user/save'. This request has been blocked; the content must be served over HTTPS.</span><br></pre></td></tr></table></figure></p>
<p>这个时候，只要在我们的<code>http://api.b.com</code>站点的服务端开放一个测试接口<code>testApi</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.b.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"data/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">save</span><span class="params">(String dataList, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        allowOrigin(response);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(dataList)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.getFalseResult(<span class="string">"缺少必要的参数"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save handler</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.getSuccResult(<span class="string">"保存成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 仅用作浏览器在https协议下自动调用一次接口，让浏览器弹出不安全提示</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"testApi"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">testApi</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        allowOrigin(response);</span><br><span class="line">        <span class="keyword">return</span> Result.getSuccResult(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">allowOrigin</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-cache, no-store, must-revalidate"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Pragma"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后在前端代码中添加如下脚本：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仅用作浏览器在https协议下自动调用一次接口，让浏览器弹出不安全提示</span></span><br><span class="line">	$.post(<span class="string">"http://api.b.com/data/user/testApi"</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure></p>
<p>确保在进入目标网页的时候会加载它，在加载它的时候在浏览器的地址栏中，我们点红色的叉会弹出一个对话框，有如下文字：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This page is trying to load scripts from unauthenticated sources.</span><br><span class="line"></span><br><span class="line">Load unsafe scripts</span><br></pre></td></tr></table></figure></p>
<p>我们点击<code>Load unsafe scripts</code>之后，再提原先的请求就可以了。</p>
<h3 id="如何刷新清除某个特定网站的缓存（Chrome浏览器）"><a href="#如何刷新清除某个特定网站的缓存（Chrome浏览器）" class="headerlink" title="如何刷新清除某个特定网站的缓存（Chrome浏览器）"></a>如何刷新清除某个特定网站的缓存（Chrome浏览器）</h3><ol>
<li>打开一个网站，如，百度；</li>
<li>按F12，进入开发者模式；</li>
<li>右键浏览器的刷新按钮，会出现三个选项：正常重新加载，硬性重新加载，清空缓存并硬性重新加载。</li>
</ol>
<p>正常重新加载<code>Ctrl+R</code>：正常重新加载。<br>硬性重新加载<code>Ctrl+Shift+R</code>：浅层次的清除历史记录，但不一定完全清除缓存（Ctrl+F5同理）。<br>清空缓存并硬性重新加载：可以深层次的清除所有的缓存。（建议用这个）</p>
<h3 id="网页请求不带cookie问题"><a href="#网页请求不带cookie问题" class="headerlink" title="网页请求不带cookie问题"></a>网页请求不带cookie问题</h3><p>为什么ajax请求没有带上cookie呢？然后去查了一下资料，原来ajax默认只会带上同源的cookie。如果只是这样还没什么，<br>重点是localhost和本机的Ip地址（我的是192.168.1.112）不是一个域，因为我在浏览器输入网址打的是<code>localhost:8761</code><br>（也就是说当前域是localhost:8761），但为ajax的请求地址是写<code>192.168.1.112:8761</code>，所以ajax请求就没带上<code>localhost:8761</code><br>下的cookie。补充一下：当然不仅ajax，比如直接在浏览器上输入地址或者通过表单提交都是默认只带上同源的cookie。</p>
<h3 id="js发送post请求下载文件"><a href="#js发送post请求下载文件" class="headerlink" title="js发送post请求下载文件"></a>js发送post请求下载文件</h3><p>JQuery的ajax函数的返回类型只有xml、text、json、html等类型，没有“流”类型，所以我们要实现ajax下载，<br>不能够使用相应的ajax函数进行文件下载。但可以用js生成一个form，用这个form提交参数，并返回“流”类型<br>的数据。在实现过程中，页面也没有进行刷新。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toExport</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> formData = getFormData();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (formData) &#123;</span><br><span class="line">        <span class="keyword">var</span> $iframe = $(<span class="string">'&lt;iframe id="down-file-iframe" /&gt;'</span>);</span><br><span class="line">        <span class="keyword">var</span> $form = $(<span class="string">'&lt;form target="down-file-iframe" method="post" /&gt;'</span>);</span><br><span class="line">        $form.attr(<span class="string">'action'</span>, <span class="string">'http://study.hewentian.com/userInfo/download'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> formData) &#123;</span><br><span class="line">            $form.append(<span class="string">'&lt;input type="hidden" name="'</span> + key + <span class="string">'" value="'</span> + formData[key] + <span class="string">'" /&gt;'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $iframe.append($form);</span><br><span class="line">        $(<span class="built_in">document</span>.body).append($iframe);</span><br><span class="line">        $form[<span class="number">0</span>].submit();</span><br><span class="line">        $iframe.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFormData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> userName = $(<span class="string">'#userName'</span>).val();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> startTime = $(<span class="string">'#startTime'</span>).val();</span><br><span class="line">    <span class="keyword">let</span> endTime = $(<span class="string">'#endTime'</span>).val();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isNull(startTime) || isNull(endTime)) &#123;</span><br><span class="line">        layer.alert(<span class="string">"请选择日期范围"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">'userName'</span>: userName,</span><br><span class="line">        <span class="string">'startTime'</span>: startTime,</span><br><span class="line">        <span class="string">'endTime'</span>: endTime</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/web/userInfo"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/download"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(String userName, String startTime, String endTime, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        XSSFWorkbook xssfWorkbook = userInfoService.getXSSFWorkbook(userName, startTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String filename = <span class="string">"用户信息-"</span> + DateFormatUtils.format(<span class="keyword">new</span> Date(), <span class="string">"yyyy-MM-dd"</span>) + <span class="string">".xlsx"</span>;</span><br><span class="line">            response.setContentType(<span class="string">"application/vnd.ms-excel;charset=UTF-8"</span>);</span><br><span class="line">            response.addHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span> + URLEncoder.encode(filename, <span class="string">"UTF-8"</span>));</span><br><span class="line"></span><br><span class="line">            response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">            OutputStream outputStream = response.getOutputStream();</span><br><span class="line"></span><br><span class="line">            xssfWorkbook.write(outputStream);</span><br><span class="line"></span><br><span class="line">            outputStream.flush();</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JAVA后台接收前端参数"><a href="#JAVA后台接收前端参数" class="headerlink" title="JAVA后台接收前端参数"></a>JAVA后台接收前端参数</h3><p>如果JAVA后台想以<code>@RequestBody</code>方式，用实体类来接收参数，那么前端就不能以form方式提交表单。<br>        @PostMapping(“/search”)<br>        public ResponseEntity search(@RequestBody UserDTO dto) {</p>
<p>此时前端必须要使用<code>contentType: &#39;application/json&#39;</code>指定参数类型。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url: url,</span><br><span class="line">    type: method,</span><br><span class="line">    <span class="keyword">async</span>: <span class="keyword">async</span>,</span><br><span class="line">    xhrFields: &#123;<span class="attr">withCredentials</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">    contentType: <span class="string">'application/json'</span>,</span><br><span class="line">    dataType: <span class="string">'json'</span>,</span><br><span class="line">    data: data ? method === <span class="string">'GET'</span> ? data : <span class="built_in">JSON</span>.stringify(data) : <span class="literal">null</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> code = data.code;</span><br><span class="line">        <span class="keyword">if</span> (code === <span class="number">4003</span>)&#123;</span><br><span class="line">            layer.confirm(data.message, <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</span><br><span class="line">                $.removeCookie(<span class="string">'username'</span>);</span><br><span class="line">                top.location.href = LOGIN_URI;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            layer.msg(data.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        layer.msg(<span class="string">"客户端繁忙..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="javascript中的字符串替换函数replace"><a href="#javascript中的字符串替换函数replace" class="headerlink" title="javascript中的字符串替换函数replace"></a>javascript中的字符串替换函数replace</h3><p>字符串 stringObject 的 replace() 方法执行的是查找并替换的操作。它将在 stringObject 中查找与 regexp 相<br>匹配的子字符串，然后用 replacement 来替换这些子串。如果 regexp 具有全局标志 g，那么 replace() 方法将替<br>换所有匹配的子串。否则，它只替换第一个匹配子串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"abcdbe"</span>;</span><br><span class="line"><span class="keyword">var</span> str1 = str.replace(<span class="string">'b'</span>,<span class="string">'B'</span>);  <span class="comment">// aBcdbe</span></span><br><span class="line"><span class="keyword">var</span> str2 = str.replace(<span class="regexp">/b/g</span>,<span class="string">'B'</span>); <span class="comment">// aBcdBe</span></span><br></pre></td></tr></table></figure>
<h3 id="javascript中字符串与数组的互转"><a href="#javascript中字符串与数组的互转" class="headerlink" title="javascript中字符串与数组的互转"></a>javascript中字符串与数组的互转</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"a,b,c,d"</span>;</span><br><span class="line"><span class="keyword">var</span> strArray = str.split(<span class="string">","</span>); <span class="comment">// 字符串转数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str1 = strArray.join(<span class="string">","</span>); <span class="comment">// 数组转字符串，用指定的分隔符分隔</span></span><br><span class="line"><span class="keyword">var</span> str2 = <span class="built_in">String</span>(strArray);   <span class="comment">// 数组转字符串，默认的分隔符为逗号</span></span><br></pre></td></tr></table></figure>
<h3 id="javascript函数的参数中有逗号的情况"><a href="#javascript函数的参数中有逗号的情况" class="headerlink" title="javascript函数的参数中有逗号的情况"></a>javascript函数的参数中有逗号的情况</h3><p>当往函数中传递的参数中包含有逗号的时候，要用单引号将其括起来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> username = <span class="string">"scott, tiger"</span>;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">printUserinfo(<span class="string">"'"</span> + username + <span class="string">"'"</span>, age);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printUserinfo</span>(<span class="params">username, age</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(username + <span class="string">", "</span> + age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="javascript将字符串转为JSON对象"><a href="#javascript将字符串转为JSON对象" class="headerlink" title="javascript将字符串转为JSON对象"></a>javascript将字符串转为JSON对象</h3><p><code>JSON.parse()</code>方法用于将一个<code>JSON</code>字符串转换为对象。<br>        var str = ‘[{“name”:”scott”,”age”:20},{“name”:”tiger”,”age”:21}]’; // str是一个字符串</p>
<pre><code>var jsonArray = JSON.parse(str); // 转换为json对象

for(var i = 0; i &lt; jsonArray.length; i++) {
    var jsonObj = jsonArray[i];
    console.log(jsonObj.name + &quot;, &quot; + jsonObj.age); // 取json中的值
}
</code></pre><h3 id="javascript将JSON对象转为字符串"><a href="#javascript将JSON对象转为字符串" class="headerlink" title="javascript将JSON对象转为字符串"></a>javascript将JSON对象转为字符串</h3><p><code>JSON.stringify()</code>方法用于将<code>javaScript</code>值转换为<code>JSON</code>字符串，一般用于将服务器端返回的对象转成JSON字符串。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objArray = [&#123;<span class="string">"name"</span>:<span class="string">"scott"</span>,<span class="string">"age"</span>:<span class="number">20</span>&#125;,&#123;<span class="string">"name"</span>:<span class="string">"tiger"</span>,<span class="string">"age"</span>:<span class="number">21</span>&#125;]; <span class="comment">// objArray是一个数组对象</span></span><br><span class="line"><span class="keyword">var</span> jsonStr = <span class="built_in">JSON</span>.stringify(objArray);</span><br><span class="line"><span class="built_in">console</span>.log(jsonStr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonStr2 = <span class="built_in">JSON</span>.stringify(objArray, <span class="literal">null</span>, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(jsonStr2);</span><br></pre></td></tr></table></figure></p>
<p>输出结果分别如下，第二个会使用4个空格格式化输出：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="string">"name"</span>:<span class="string">"scott"</span>,<span class="string">"age"</span>:<span class="number">20</span>&#125;,&#123;<span class="string">"name"</span>:<span class="string">"tiger"</span>,<span class="string">"age"</span>:<span class="number">21</span>&#125;]</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"scott"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"tiger"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">21</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> phoneRegExp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^(06|08|09)[0-9]&#123;8&#125;$'</span>, <span class="string">'i'</span>);</span><br><span class="line"><span class="keyword">var</span> postCodeRegExp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^[0-9]&#123;5&#125;$'</span>, <span class="string">'i'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(phoneRegExp.test(<span class="string">'0612345678'</span>));  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(phoneRegExp.test(<span class="string">'06123456789'</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(phoneRegExp.test(<span class="string">'0812345678'</span>));  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(postCodeRegExp.test(<span class="string">'12345'</span>));    <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(postCodeRegExp.test(<span class="string">'12345a'</span>));   <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(postCodeRegExp.test(<span class="string">'1234'</span>));     <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/10/html-css/" data-id="ckpo1myx20015uu3kh7iu8bq0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/container/">container</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web-server/">web server</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/01/mybatis-note/">mybatis 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/01/22/canal-note/">canal 学习笔记</a>
          </li>
        
          <li>
            <a href="/2020/06/08/springboot-note/">springboot 学习笔记</a>
          </li>
        
          <li>
            <a href="/2020/01/14/spark-note/">spark 学习笔记</a>
          </li>
        
          <li>
            <a href="/2019/12/30/scala-note/">scala 学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<!-- <script src="//code.jquery.com/jquery-2.2.4.min.js"></script> -->
<script src="/js/jquery-3.5.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>