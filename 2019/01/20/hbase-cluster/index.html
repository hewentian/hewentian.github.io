<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>hbase 集群的搭建 | Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Hbase 介绍Hbase的官方文档中有对Hbase的详细介绍，这里不再赘述。这里用一句话描述如下： Apache HBase™ is the Hadoop database, a distributed, scalable, big data store. Use Apache HBase™ when you need random, realtime read/write access to">
<meta name="keywords" content="hbase">
<meta property="og:type" content="article">
<meta property="og:title" content="hbase 集群的搭建">
<meta property="og:url" content="https://github.com/hewentian/2019/01/20/hbase-cluster/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="Hbase 介绍Hbase的官方文档中有对Hbase的详细介绍，这里不再赘述。这里用一句话描述如下： Apache HBase™ is the Hadoop database, a distributed, scalable, big data store. Use Apache HBase™ when you need random, realtime read/write access to">
<meta property="og:locale" content="en-US">
<meta property="og:image" content="https://github.com/img/hbase-1.png">
<meta property="og:image" content="https://github.com/img/hbase-2.png">
<meta property="og:image" content="https://github.com/img/hbase-3.png">
<meta property="og:image" content="https://github.com/img/hbase-4.png">
<meta property="og:image" content="https://github.com/img/hbase-5.png">
<meta property="og:image" content="https://github.com/img/hbase-6.png">
<meta property="og:image" content="https://github.com/img/hbase-7.png">
<meta property="og:image" content="https://github.com/img/hbase-8.png">
<meta property="og:updated_time" content="2019-01-27T14:24:20.427Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hbase 集群的搭建">
<meta name="twitter:description" content="Hbase 介绍Hbase的官方文档中有对Hbase的详细介绍，这里不再赘述。这里用一句话描述如下： Apache HBase™ is the Hadoop database, a distributed, scalable, big data store. Use Apache HBase™ when you need random, realtime read/write access to">
<meta name="twitter:image" content="https://github.com/img/hbase-1.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-hbase-cluster" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/20/hbase-cluster/" class="article-date">
  <time datetime="2019-01-20T04:31:29.000Z" itemprop="datePublished">2019-01-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      hbase 集群的搭建
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Hbase-介绍"><a href="#Hbase-介绍" class="headerlink" title="Hbase 介绍"></a>Hbase 介绍</h3><p>Hbase的<a href="http://hbase.apache.org/book.html" target="_blank" rel="noopener">官方文档</a>中有对Hbase的详细介绍，这里不再赘述。这里用一句话描述如下：</p>
<p>Apache HBase™ is the Hadoop database, a distributed, scalable, big data store.</p>
<p>Use Apache HBase™ when you need random, realtime read/write access to your Big Data. This project’s goal is the hosting of very large tables – billions of rows X millions of columns – atop clusters of commodity hardware. Apache HBase is an open-source, distributed, versioned, non-relational database modeled after Google’s Bigtable: A Distributed Storage System for Structured Data by Chang et al. Just as Bigtable leverages the distributed data storage provided by the Google File System, Apache HBase provides Bigtable-like capabilities on top of Hadoop and HDFS.</p>
<h3 id="Hbase-的安装"><a href="#Hbase-的安装" class="headerlink" title="Hbase 的安装"></a>Hbase 的安装</h3><p>安装过程参考这里：<br><a href="http://hbase.apache.org/book.html#quickstart_fully_distributed" target="_blank" rel="noopener">http://hbase.apache.org/book.html#quickstart_fully_distributed</a></p>
<p>Hbase依赖于HADOOP，我们在上一篇<a href="../../../../2019/01/01/hadoop-cluster-ha/">hadoop 集群的搭建HA</a>的基础上安装Hbase。</p>
<p>节点分布如下：</p>
<pre><code>master：
    ip: 192.168.56.110
    hostname: hadoop-host-master
slave1:
    ip: 192.168.56.111
    hostname: hadoop-host-slave-1
slave2:
    ip: 192.168.56.112
    hostname: hadoop-host-slave-2
slave3:
    ip: 192.168.56.113
    hostname: hadoop-host-slave-3
</code></pre><p>如下图（绿色代表在这些节点上面安装这些程序，与<code>hadoop 集群的搭建HA</code>安装中的图类似，这里多了后面两列）：</p>
<p><img src="/img/hbase-1.png" alt="" title="HBase集群 节点分布"></p>
<h3 id="安装NTP"><a href="#安装NTP" class="headerlink" title="安装NTP"></a>安装NTP</h3><p>可能还要在各节点服务器上面安装NTP服务，实现服务器节点间时间的一致。如果服务器节点间的时间不一致，可能会引发HBase的异常，这一点在HBase官网上有特别强调。在这里，设置我的笔记本电脑为NTP的服务端节点，即是我的电脑从国家授时中心同步时间，然后其它节点（master、slave1、slave2、slave3）作为客户端从我的笔记本同步时间。此篇的安装过程将省略这个步骤，在后续篇章中再介绍，本篇将手动将各节点的时间调成一致。</p>
<h3 id="修改ulimit"><a href="#修改ulimit" class="headerlink" title="修改ulimit"></a>修改ulimit</h3><p>Configuring the maximum number of file descriptors and processes for the user who is running the HBase process is an operating system configuration, rather than an HBase configuration. It is also important to be sure that the settings are changed for the user that actually runs HBase. To see which user started HBase, and that user’s ulimit configuration, look at the first line of the HBase log for that instance.</p>
<p>修改ulimit，以增加linux系统能同时打开文件的数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">hadoop  -       nofile  32768</span><br><span class="line">hadoop  -       nproc   32000</span><br></pre></td></tr></table></figure>
<p>修改后需重启系统才能生效。</p>
<h3 id="下载Hbase"><a href="#下载Hbase" class="headerlink" title="下载Hbase"></a>下载Hbase</h3><p>首先下载Hbase，我们下载的时候，要选择适合我们HADOOP版本的Hbase，我们下载的稳定版为<a href="http://archive.apache.org/dist/hbase/1.2.6/" target="_blank" rel="noopener">hbase-1.2.6-bin.tar.gz</a>，将压缩包首先传到<code>master</code>节点的<code>/home/hadoop/</code>目录下，先在<code>master</code>节点配置好，然后同步到其他3个节点。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/</span><br><span class="line">$ tar xzvf hbase-1.2.6-bin.tar.gz</span><br><span class="line">$ </span><br><span class="line">$ <span class="built_in">cd</span> hbase-1.2.6/</span><br><span class="line">$ ls</span><br><span class="line">bin  CHANGES.txt  conf  docs  hbase-webapps  LEGAL  lib  LICENSE.txt  NOTICE.txt  README.txt</span><br></pre></td></tr></table></figure></p>
<h3 id="配置hbase-env-sh，加上JDK绝对路径"><a href="#配置hbase-env-sh，加上JDK绝对路径" class="headerlink" title="配置hbase-env.sh，加上JDK绝对路径"></a>配置hbase-env.sh，加上JDK绝对路径</h3><ol>
<li>JDK的路径就是安装JDK的时候的路径；</li>
<li>Hbase内置有zookeeper，但是为了方便管理，我们单独部署zookeeper，即使用HADOOP中用作ZKFC的zookeeper；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/conf</span><br><span class="line">$ vi hbase-env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_102/</span><br><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h3 id="配置hbase-site-xml"><a href="#配置hbase-site-xml" class="headerlink" title="配置hbase-site.xml"></a>配置hbase-site.xml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/conf</span><br><span class="line">$ vi hbase-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hdfs://hadoop-host-master:8020/hbase&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Do not create the dir hbase, the system will create it automatically, and the value is dfs.namenode.rpc-address.hadoop-cluster-ha.nn1&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;2181&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Property from ZooKeeper<span class="string">'s config zoo.cfg. The port at which the clients will connect.&lt;/description&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;hadoop-host-master,hadoop-host-slave-1,hadoop-host-slave-2&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;/home/hadoop/zookeeper-3.4.6/data&lt;/value&gt;</span></span><br><span class="line"><span class="string">        &lt;description&gt;Property from ZooKeeper'</span>s config zoo.cfg. The directory <span class="built_in">where</span> the snapshot is stored.&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置regionservers"><a href="#配置regionservers" class="headerlink" title="配置regionservers"></a>配置regionservers</h3><p>在将要运行regionservers的节点加入此文件中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/conf</span><br><span class="line">$ vi regionservers</span><br><span class="line"></span><br><span class="line">hadoop-host-slave-1</span><br><span class="line">hadoop-host-slave-2</span><br><span class="line">hadoop-host-slave-3</span><br></pre></td></tr></table></figure></p>
<h3 id="配置backup-masters"><a href="#配置backup-masters" class="headerlink" title="配置backup-masters"></a>配置backup-masters</h3><p>我们将<code>hadoop-host-master</code>作为Hbase集群的master，并配置HBase使用<code>hadoop-host-slave-1</code>作为backup master，在conf目录下创建一个文件backup-masters, 并在其中添加作为backup master的主机名<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/conf</span><br><span class="line">$ vi backup-masters</span><br><span class="line"></span><br><span class="line">hadoop-host-slave-1</span><br></pre></td></tr></table></figure></p>
<h3 id="复制hdfs-site-xml配置文件"><a href="#复制hdfs-site-xml配置文件" class="headerlink" title="复制hdfs-site.xml配置文件"></a>复制hdfs-site.xml配置文件</h3><p>复制<code>$HADOOP_HOME/etc/hadoop/hdfs-site.xml</code>到<code>$HBASE_HOME/conf</code>目录下，这样以保证HDFS与Hbase两边配置一致，这也是官网所推荐的方式。例子，如果HDFS中配置的副本数量为5（默认为3），如果没有将hadoop的<code>hdfs-site.xml</code>复制到<code>$HBASE_HOME/conf</code>目录下，则Hbase将会按3份备份，从而两边不一致，导致出现异常。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/conf/</span><br><span class="line">$ cp /home/hadoop/hadoop-2.7.3/etc/hadoop/hdfs-site.xml .</span><br></pre></td></tr></table></figure>
<p>至此，配置完毕，将这些配置同步到其他三个节点，在<code>hadoop-host-master</code>上面执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/</span><br><span class="line">$ scp -r hbase-1.2.6 hadoop@hadoop-host-slave-1:/home/hadoop/</span><br><span class="line">$ scp -r hbase-1.2.6 hadoop@hadoop-host-slave-2:/home/hadoop/</span><br><span class="line">$ scp -r hbase-1.2.6 hadoop@hadoop-host-slave-3:/home/hadoop/</span><br></pre></td></tr></table></figure></p>
<h3 id="启动Hbase"><a href="#启动Hbase" class="headerlink" title="启动Hbase"></a>启动Hbase</h3><p>可使用<code>$HBASE_HOME/bin/start-hbase.sh</code>指令启动整个集群，如果要使用该命令，则集群的节点间必须实现ssh的免密码登录，这样才能到不同的节点启动服务。</p>
<p>按我们前面的规划，<code>hadoop-host-master</code>将作为Hbase集群的master，其实在哪台机器上面运行<code>start-hbase.sh</code>指令，那么这台机器将成为master。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/bin</span><br><span class="line">$ ./start-hbase.sh</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/hbase-2.png" alt="" title="HBase集群启动"></p>
<p>当执行<code>jps</code>指令后，可以看到<code>hadoop-host-master</code>上面多了一个<code>HMaster</code>进程，在<code>hadoop-host-slave-1</code>中会同时存在<code>HMaster</code>、<code>HRegionServer</code>进程，而在其他两个节点则只存在<code>HRegionServer</code>进程。</p>
<p>另外，我们可以在其他任何机器通过以下命令启动一个master<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/bin</span><br><span class="line">$ ./hbase-daemon.sh start master</span><br><span class="line"></span><br><span class="line">或者启动作为backup master</span><br><span class="line">$ ./hbase-daemon.sh start master --backup</span><br></pre></td></tr></table></figure></p>
<p>可以在实体机的浏览器中输入：<br><a href="http://hadoop-host-master:16010/" target="_blank" rel="noopener">http://hadoop-host-master:16010/</a><br><a href="http://hadoop-host-slave-1:16010/" target="_blank" rel="noopener">http://hadoop-host-slave-1:16010/</a></p>
<p>来查看是否启动成功，如无意外的话，你会看到如下结果页面。其中一个是Master，另一个是Back Master：</p>
<p><img src="/img/hbase-3.png" alt="" title="HBase集群管理界面 Master"></p>
<p><img src="/img/hbase-4.png" alt="" title="HBase集群管理界面 Back Master"></p>
<p>同样的它在HDFS中也自动创建了保存数据的目录：</p>
<p><img src="/img/hbase-5.png" alt="" title="HBase集群在HDFS中的目录"></p>
<p>至此，集群搭建成功。</p>
<h3 id="Hbase初体验"><a href="#Hbase初体验" class="headerlink" title="Hbase初体验"></a>Hbase初体验</h3><p>首先我们通过SHELL的方式简单体验一下Hbase：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6/</span><br><span class="line">$ ./bin/hbase shell</span><br><span class="line">2019-01-23 19:16:36,118 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library <span class="keyword">for</span> your platform... using <span class="built_in">builtin</span>-java classes <span class="built_in">where</span> applicable</span><br><span class="line">HBase Shell; enter <span class="string">'help&lt;RETURN&gt;'</span> <span class="keyword">for</span> list of supported commands.</span><br><span class="line">Type <span class="string">"exit&lt;RETURN&gt;"</span> to leave the HBase Shell</span><br><span class="line">Version 1.2.6, rUnknown, Mon May 29 02:25:32 CDT 2017</span><br><span class="line"></span><br><span class="line">hbase(main):001:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line">0 row(s) <span class="keyword">in</span> 0.6030 seconds</span><br><span class="line"></span><br><span class="line">=&gt; []</span><br></pre></td></tr></table></figure></p>
<p>由上述结果可知，Hbase中现在没有一张表。我们尝试创建一张表<code>t_student</code>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):002:0&gt; create <span class="string">'t_student'</span>, <span class="string">'cf1'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 2.4700 seconds</span><br><span class="line"></span><br><span class="line">=&gt; Hbase::Table - t_student</span><br><span class="line">hbase(main):003:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line">t_student</span><br><span class="line">1 row(s) <span class="keyword">in</span> 0.0250 seconds</span><br><span class="line"></span><br><span class="line">=&gt; [<span class="string">"t_student"</span>]</span><br><span class="line">hbase(main):004:0&gt; desc <span class="string">'t_student'</span></span><br><span class="line">Table t_student is ENABLED</span><br><span class="line">t_student</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">'cf1'</span>, BLOOMFILTER =&gt; <span class="string">'ROW'</span>, VERSIONS =&gt; <span class="string">'1'</span>, IN_MEMORY =&gt; <span class="string">'false'</span>, KEEP_DELETED_CELLS =&gt; <span class="string">'FALSE'</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">'NONE'</span>, TTL =&gt; <span class="string">'FOREVER'</span>, COMPRESSION =&gt; <span class="string">'NONE'</span>, MIN_VERSIONS =&gt; <span class="string">'0'</span>, BLO</span><br><span class="line">CKCACHE =&gt; <span class="string">'true'</span>, BLOCKSIZE =&gt; <span class="string">'65536'</span>, REPLICATION_SCOPE =&gt; <span class="string">'0'</span>&#125;</span><br><span class="line">1 row(s) <span class="keyword">in</span> 0.2010 seconds</span><br></pre></td></tr></table></figure></p>
<p>往表中插入2条数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):005:0&gt; put <span class="string">'t_student'</span>, <span class="string">'01'</span>, <span class="string">'cf1:name'</span>, <span class="string">'tim'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 0.1840 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):006:0&gt; put <span class="string">'t_student'</span>, <span class="string">'02'</span>, <span class="string">'cf1:name'</span>, <span class="string">'timho'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 0.3630 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):007:0&gt; scan <span class="string">'t_student'</span></span><br><span class="line">ROW                                                  COLUMN+CELL</span><br><span class="line"> 01                                                  column=cf1:name, timestamp=1548242390794, value=tim</span><br><span class="line"> 02                                                  column=cf1:name, timestamp=1548246522887, value=timho</span><br><span class="line">2 row(s) <span class="keyword">in</span> 0.1240 seconds</span><br></pre></td></tr></table></figure></p>
<p>插入数据之后，可能在HDFS中还不能立刻看到，因为数据还在内存中，但可以通过以下命令将数据立刻写到HDFS中：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):008:0&gt; flush <span class="string">'t_student'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 0.7290 seconds</span><br></pre></td></tr></table></figure></p>
<p>然后我们可以在HDFS、Hbase的管理界面分别看到表信息：</p>
<p><img src="/img/hbase-6.png" alt="" title="HBase的数据在HDFS中"></p>
<p><img src="/img/hbase-7.png" alt="" title="HBase集群管理界面 用户表信息"></p>
<p>当我们在HDFS中看到表中的某个块的数据，如下：</p>
<p><img src="/img/hbase-8.png" alt="" title="HBase的数据在HDFS中"></p>
<p>我们可以通过Hbase中的命令来查看数据的真实内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/hbase-1.2.6</span><br><span class="line">$ ./bin/hbase hfile -p -f /hbase/data/default/t_student/b76cccf6c6a7926bf8f40b4eafc6991e/cf1/2ed0a233411447778982edce04e96fe3</span><br><span class="line">2019-01-23 19:45:33,200 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library <span class="keyword">for</span> your platform... using <span class="built_in">builtin</span>-java classes <span class="built_in">where</span> applicable</span><br><span class="line">2019-01-23 19:45:34,046 INFO  [main] hfile.CacheConfig: Created cacheConfig: CacheConfig:disabled</span><br><span class="line">K: 01/cf1:name/1548242390794/Put/vlen=3/seqid=4 V: tim</span><br><span class="line">Scanned kv count -&gt; 1</span><br></pre></td></tr></table></figure></p>
<p>查看集群状态和节点数量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):009:0&gt; status</span><br><span class="line">1 active master, 1 backup masters, 3 servers, 0 dead, 1.0000 average load</span><br></pre></td></tr></table></figure></p>
<p>根据条件查询数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):010:0&gt; get <span class="string">'t_student'</span>, <span class="string">'01'</span></span><br><span class="line">COLUMN                                               CELL</span><br><span class="line"> cf1:name                                            timestamp=1548242390794, value=tim</span><br><span class="line">1 row(s) <span class="keyword">in</span> 0.0590 seconds</span><br></pre></td></tr></table></figure></p>
<p>表失效、表生效、删除表：</p>
<ol>
<li>使用<code>disable</code>命令可将某张表失效，失效后该表将不能使用；</li>
<li>使用<code>enable</code>命令可使表重新生效，表生效后，即可对表进行操作；</li>
<li>使用<code>drop</code>命令可对表进行删除，但只有表在失效的情况下，才能进行删除。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):011:0&gt; desc <span class="string">'t_student'</span></span><br><span class="line">Table t_student is ENABLED</span><br><span class="line">t_student</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">'cf1'</span>, BLOOMFILTER =&gt; <span class="string">'ROW'</span>, VERSIONS =&gt; <span class="string">'1'</span>, IN_MEMORY =&gt; <span class="string">'false'</span>, KEEP_DELETED_CELLS =&gt; <span class="string">'FALSE'</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">'NONE'</span>, TTL =&gt; <span class="string">'FOREVER'</span>, COMPRESSION =&gt; <span class="string">'NONE'</span>, MIN_VERSIONS =&gt; <span class="string">'0'</span>, BLO</span><br><span class="line">CKCACHE =&gt; <span class="string">'true'</span>, BLOCKSIZE =&gt; <span class="string">'65536'</span>, REPLICATION_SCOPE =&gt; <span class="string">'0'</span>&#125;</span><br><span class="line">1 row(s) <span class="keyword">in</span> 0.0480 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):012:0&gt; <span class="built_in">disable</span> <span class="string">'t_student'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 2.4070 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):013:0&gt; desc <span class="string">'t_student'</span></span><br><span class="line">Table t_student is DISABLED</span><br><span class="line">t_student</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">'cf1'</span>, BLOOMFILTER =&gt; <span class="string">'ROW'</span>, VERSIONS =&gt; <span class="string">'1'</span>, IN_MEMORY =&gt; <span class="string">'false'</span>, KEEP_DELETED_CELLS =&gt; <span class="string">'FALSE'</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">'NONE'</span>, TTL =&gt; <span class="string">'FOREVER'</span>, COMPRESSION =&gt; <span class="string">'NONE'</span>, MIN_VERSIONS =&gt; <span class="string">'0'</span>, BLO</span><br><span class="line">CKCACHE =&gt; <span class="string">'true'</span>, BLOCKSIZE =&gt; <span class="string">'65536'</span>, REPLICATION_SCOPE =&gt; <span class="string">'0'</span>&#125;</span><br><span class="line">1 row(s) <span class="keyword">in</span> 0.0320 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):014:0&gt; <span class="built_in">enable</span> <span class="string">'t_student'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 1.3260 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):015:0&gt; <span class="built_in">disable</span> <span class="string">'t_student'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 2.2550 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):016:0&gt; drop <span class="string">'t_student'</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 1.3540 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):017:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line">0 row(s) <span class="keyword">in</span> 0.0060 seconds</span><br><span class="line"></span><br><span class="line">=&gt; []</span><br></pre></td></tr></table></figure>
<p>退出 hbase shell<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):018:0&gt; quit</span><br></pre></td></tr></table></figure></p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ol>
<li><p>有时候我们重启了hadoop集群后，发现hbase无法使用，有可能是我们在hbase-site.xml中配置的hadoop master节点已经不是active了，解决办法是在hadoop中手动将其设为active状态；</p>
</li>
<li><p>主从节点时间没有同步时，极有可能出现如下错误，同步时间后可以正常启动：</p>
<pre><code>master.ServerManager: Waiting for region servers count to settle; currently checked in 0, slept for 855041 ms, expecting minimum of 1, maximum of 2147483647, timeout of 4500 ms, interval of 1500 ms.

[HBase] ERROR:org.apache.hadoop.hbase.PleaseHoldException: Master is initializing
</code></pre></li>
</ol>
<h3 id="java操作Hbase"><a href="#java操作Hbase" class="headerlink" title="java操作Hbase"></a>java操作Hbase</h3><p>java操作Hbase的例子见这里：<a href="https://github.com/hewentian/hadoop-demo/blob/master/src/main/java/com/hewentian/hadoop/utils/HbaseUtil.java">HbaseUtil.java</a>、<a href="https://github.com/hewentian/hadoop-demo/blob/master/src/main/java/com/hewentian/hadoop/hbase/HbaseDemo.java">HbaseDemo.java</a></p>
<p>未完，待续……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2019/01/20/hbase-cluster/" data-id="cjxzrqcek000usu3ka0b1is2d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hbase/">hbase</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/10/nginx-note/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          nginx 学习笔记
        
      </div>
    </a>
  
  
    <a href="/2019/01/10/hive-note/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">hive 学习笔记</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web-server/">web server</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/10/nginx-note/">nginx 学习笔记</a>
          </li>
        
          <li>
            <a href="/2019/01/20/hbase-cluster/">hbase 集群的搭建</a>
          </li>
        
          <li>
            <a href="/2019/01/10/hive-note/">hive 学习笔记</a>
          </li>
        
          <li>
            <a href="/2019/01/01/hadoop-cluster-ha/">hadoop 集群的搭建HA</a>
          </li>
        
          <li>
            <a href="/2018/12/19/hadoop-mapreduce/">hadoop mapreduce示例</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.2.4.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>