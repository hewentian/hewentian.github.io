<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>docker 学习笔记 | Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="今天开始学习一下docker，因为它越来越流行了。首先，我们来安装一下。因为我的系统为Ubuntu Linux，所以我的安装过程，参照这里：https://docs.docker.com/install/linux/docker-ce/ubuntu/ 安装过程如下，在系统上首次安装的时候需要执行安装前的准备工作： 安装前的准备工作第一步：首先卸载系统自带的旧版docker（如系统有预安装docke">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="docker 学习笔记">
<meta property="og:url" content="https://github.com/hewentian/2019/07/26/docker-note/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="今天开始学习一下docker，因为它越来越流行了。首先，我们来安装一下。因为我的系统为Ubuntu Linux，所以我的安装过程，参照这里：https://docs.docker.com/install/linux/docker-ce/ubuntu/ 安装过程如下，在系统上首次安装的时候需要执行安装前的准备工作： 安装前的准备工作第一步：首先卸载系统自带的旧版docker（如系统有预安装docke">
<meta property="og:locale" content="en-US">
<meta property="og:image" content="https://github.com/img/harbor-admin-login.png">
<meta property="og:image" content="https://github.com/img/harbor-logined.png">
<meta property="og:image" content="https://github.com/img/harbor-new-user.png">
<meta property="og:image" content="https://github.com/img/harbor-user-login.png">
<meta property="og:image" content="https://github.com/img/harbor-create-project.png">
<meta property="og:image" content="https://github.com/img/harbor-push-image-1.png">
<meta property="og:image" content="https://github.com/img/harbor-push-image-2.png">
<meta property="og:updated_time" content="2022-06-19T04:50:01.756Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker 学习笔记">
<meta name="twitter:description" content="今天开始学习一下docker，因为它越来越流行了。首先，我们来安装一下。因为我的系统为Ubuntu Linux，所以我的安装过程，参照这里：https://docs.docker.com/install/linux/docker-ce/ubuntu/ 安装过程如下，在系统上首次安装的时候需要执行安装前的准备工作： 安装前的准备工作第一步：首先卸载系统自带的旧版docker（如系统有预安装docke">
<meta name="twitter:image" content="https://github.com/img/harbor-admin-login.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-docker-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/26/docker-note/" class="article-date">
  <time datetime="2019-07-26T02:32:30.000Z" itemprop="datePublished">2019-07-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/container/">container</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      docker 学习笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天开始学习一下docker，因为它越来越流行了。首先，我们来安装一下。因为我的系统为<code>Ubuntu Linux</code>，所以我的安装过程，参照这里：<br><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p>
<p>安装过程如下，在系统上首次安装的时候需要执行<strong>安装前的准备工作</strong>：</p>
<h3 id="安装前的准备工作"><a href="#安装前的准备工作" class="headerlink" title="安装前的准备工作"></a>安装前的准备工作</h3><p>第一步：首先卸载系统自带的旧版docker（如系统有预安装docker）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure></p>
<p>第二步：更新<code>apt</code>包索引：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<p>第三步：安装允许<code>apt</code>通过HTTPS访问仓库的软件包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg-agent \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure></p>
<p>第四步： 添加docker官方的GPG key：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure></p>
<p>验证添加KEY的指纹是否是<code>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</code>，我们只需搜索最后8个字符即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class="line">pub   rsa4096 2017-02-22 [SCEA]</span><br><span class="line">      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class="line">uid           [ unknown] Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class="line">sub   rsa4096 2017-02-22 [S]</span><br></pre></td></tr></table></figure></p>
<p>第五步：将docker的下载路径添加到下载源中：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="开始正式安装"><a href="#开始正式安装" class="headerlink" title="开始正式安装"></a>开始正式安装</h3><p>第一步：更新<code>apt</code>包索引：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<p>第二步：开始安装docker最新的社区版：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></p>
<p>安装结束后，docker的daemon进程默认自动启动，否则需要手动启动。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker start</span><br></pre></td></tr></table></figure></p>
<p>可选命令有：</p>
<pre><code>service docker {start|stop|restart|status}
</code></pre><p>第三步：验证安装是否正确无误，通过运行一个测试用例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br><span class="line"></span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">1b930d010525: Pull complete </span><br><span class="line">Digest: sha256:6540fc08ee6e6b7b63468dc3317e3303aae178cb8a45ed3123180328bcc1d20f</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure></p>
<p>至此，安装完成。</p>
<h3 id="卸载方法"><a href="#卸载方法" class="headerlink" title="卸载方法"></a>卸载方法</h3><p>要卸载软件本身和删除相关的docker文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get purge docker-ce</span><br><span class="line">$ sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure></p>
<h3 id="docker的一些操作命令"><a href="#docker的一些操作命令" class="headerlink" title="docker的一些操作命令"></a>docker的一些操作命令</h3><p>一个简单的示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run ubuntu:18.04 /bin/<span class="built_in">echo</span> <span class="string">"Hello world"</span></span><br></pre></td></tr></table></figure></p>
<p>或者交互式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -i -t ubuntu:18.04 /bin/bash</span><br></pre></td></tr></table></figure></p>
<p>以后台模式启动容器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -d ubuntu:18.04 /bin/sh -c <span class="string">"while true; do echo hello world; sleep 1; done"</span></span><br><span class="line"></span><br><span class="line">d7c1549c2a495499270eb31819ce5e9ea9748ab8126f025f33b06612491fd447</span><br></pre></td></tr></table></figure></p>
<p>输出的那一长长的字符串，是容器ID。</p>
<p>查看容器内的标准输出：</p>
<pre><code>sudo docker logs -f {CONTAINER ID}|{NAMES}
</code></pre><p>示例如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker logs d7c1549c2a495499270eb31819ce5e9ea9748ab8126f025f33b06612491fd447</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure></p>
<h3 id="查看正在运行中的容器"><a href="#查看正在运行中的容器" class="headerlink" title="查看正在运行中的容器"></a>查看正在运行中的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">d7c1549c2a49        ubuntu:18.04        <span class="string">"/bin/sh -c 'while t…"</span>   4 minutes ago       Up 4 minutes                            friendly_minsky</span><br></pre></td></tr></table></figure>
<h3 id="停止容器，可以使用容器ID或者容器名"><a href="#停止容器，可以使用容器ID或者容器名" class="headerlink" title="停止容器，可以使用容器ID或者容器名"></a>停止容器，可以使用容器ID或者容器名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker stop &#123;CONTAINER ID&#125;|&#123;NAMES&#125;</span><br></pre></td></tr></table></figure>
<h3 id="docker的帮助命令"><a href="#docker的帮助命令" class="headerlink" title="docker的帮助命令"></a>docker的帮助命令</h3><p>在命令行中直接输入docker即可看到它的提示，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">$ docker</span><br><span class="line"></span><br><span class="line">Usage:	docker [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime <span class="keyword">for</span> containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default <span class="string">"/home/hewentian/.docker"</span>)</span><br><span class="line">  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and default context <span class="built_in">set</span> with <span class="string">"docker context use"</span>)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="line">  -l, --<span class="built_in">log</span>-level string   Set the logging level (<span class="string">"debug"</span>|<span class="string">"info"</span>|<span class="string">"warn"</span>|<span class="string">"error"</span>|<span class="string">"fatal"</span>) (default <span class="string">"info"</span>)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default <span class="string">"/home/hewentian/.docker/ca.pem"</span>)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default <span class="string">"/home/hewentian/.docker/cert.pem"</span>)</span><br><span class="line">      --tlskey string      Path to TLS key file (default <span class="string">"/home/hewentian/.docker/key.pem"</span>)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  engine      Manage the docker engine</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach <span class="built_in">local</span> standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  deploy      Deploy a new stack or update an existing stack</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  history     Show the history of an image</span></span><br><span class="line"><span class="string">  images      List images</span></span><br><span class="line"><span class="string">  import      Import the contents from a tarball to create a filesystem image</span></span><br><span class="line"><span class="string">  info        Display system-wide information</span></span><br><span class="line"><span class="string">  inspect     Return low-level information on Docker objects</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  load        Load an image from a tar archive or STDIN</span></span><br><span class="line"><span class="string">  login       Log in to a Docker registry</span></span><br><span class="line"><span class="string">  logout      Log out from a Docker registry</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  ps          List containers</span></span><br><span class="line"><span class="string">  pull        Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">  push        Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  rmi         Remove one or more images</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">  search      Search the Docker Hub for images</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  version     Show the Docker version information</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure></p>
<h3 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h3><p>默认从 <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a> 查找我们需要的镜像，例如，搜索<code>httpd</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker search httpd</span><br><span class="line">NAME                                 DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">httpd                                The Apache HTTP Server Project                  2567                [OK]                </span><br><span class="line">centos/httpd                                                                         23                                      [OK]</span><br><span class="line">centos/httpd-24-centos7              Platform <span class="keyword">for</span> running Apache httpd 2.4 or bui…   22                                      </span><br><span class="line">armhf/httpd                          The Apache HTTP Server Project                  8                                       </span><br><span class="line">polinux/httpd-php                    Apache with PHP <span class="keyword">in</span> Docker (Supervisor, CentO…   3                                       [OK]</span><br></pre></td></tr></table></figure></p>
<h3 id="下载并运行容器"><a href="#下载并运行容器" class="headerlink" title="下载并运行容器"></a>下载并运行容器</h3><p>我们可以在 <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a> 上面查询所有可用的镜像，找到需要的镜像后，可以下载，例如<code>training/webapp</code>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull training/webapp</span><br><span class="line">$ sudo docker run -d -P training/webapp python app.py</span><br><span class="line"></span><br><span class="line">a2d42ce3df7d0dc34b93095fe3cd526de22f75f2f49a7762e395c32cecae82e5</span><br></pre></td></tr></table></figure></p>
<p>我们也可以通过<code>-p</code>参数来设置不一样的端口，（格式为 本机端口:容器端口）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -d -p 5001:5000 training/webapp python app.py</span><br><span class="line"></span><br><span class="line">2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9</span><br><span class="line"></span><br><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">2f8c4e68d8fb        training/webapp     <span class="string">"python app.py"</span>     27 seconds ago      Up 26 seconds       0.0.0.0:5001-&gt;5000/tcp    infallible_greider</span><br><span class="line">a2d42ce3df7d        training/webapp     <span class="string">"python app.py"</span>     41 seconds ago      Up 40 seconds       0.0.0.0:32769-&gt;5000/tcp   epic_pasteur</span><br></pre></td></tr></table></figure></p>
<p>这样在本机的浏览器上面通过如下2种方式，都能访问到应用：<br><a href="http://localhost:32769/" target="_blank" rel="noopener">http://localhost:32769/</a><br><a href="http://localhost:5001/" target="_blank" rel="noopener">http://localhost:5001/</a></p>
<h3 id="查看容器内的进程状况"><a href="#查看容器内的进程状况" class="headerlink" title="查看容器内的进程状况"></a>查看容器内的进程状况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker top infallible_greider</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                28721               28694               0                   14:49               ?                   00:00:00            python app.py</span><br></pre></td></tr></table></figure>
<h3 id="查看指定容器的配置和状态信息"><a href="#查看指定容器的配置和状态信息" class="headerlink" title="查看指定容器的配置和状态信息"></a>查看指定容器的配置和状态信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker inspect infallible_greider</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2019-07-29T06:49:41.334728611Z"</span>,</span><br><span class="line">        <span class="string">"Path"</span>: <span class="string">"python"</span>,</span><br><span class="line">        <span class="string">"Args"</span>: [</span><br><span class="line">            <span class="string">"app.py"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"State"</span>: &#123;</span><br><span class="line">            <span class="string">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="string">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Pid"</span>: 28721,</span><br><span class="line">            <span class="string">"ExitCode"</span>: 0,</span><br><span class="line">            <span class="string">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"StartedAt"</span>: <span class="string">"2019-07-29T06:49:42.075479437Z"</span>,</span><br><span class="line">            <span class="string">"FinishedAt"</span>: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:6fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557"</span>,</span><br><span class="line">        <span class="string">"ResolvConfPath"</span>: <span class="string">"/var/lib/docker/containers/2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9/resolv.conf"</span>,</span><br><span class="line">        <span class="string">"HostnamePath"</span>: <span class="string">"/var/lib/docker/containers/2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9/hostname"</span>,</span><br><span class="line">        <span class="string">"HostsPath"</span>: <span class="string">"/var/lib/docker/containers/2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9/hosts"</span>,</span><br><span class="line">        <span class="string">"LogPath"</span>: <span class="string">"/var/lib/docker/containers/2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9/2f8c4e68d8fbb3130fb51197218b9024bed5de1c4614cd7cca198a68807b57a9-json.log"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"/infallible_greider"</span>,</span><br><span class="line">        <span class="string">"RestartCount"</span>: 0,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"overlay2"</span>,</span><br><span class="line">        <span class="string">"Platform"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="string">"MountLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"ProcessLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"AppArmorProfile"</span>: <span class="string">"docker-default"</span>,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="容器可以停止、重新启动和移除"><a href="#容器可以停止、重新启动和移除" class="headerlink" title="容器可以停止、重新启动和移除"></a>容器可以停止、重新启动和移除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker start infallible_greider</span><br><span class="line">$ sudo docker stop infallible_greider</span><br><span class="line">$ sudo docker rm infallible_greider</span><br></pre></td></tr></table></figure>
<h3 id="列出本机上的所有镜像"><a href="#列出本机上的所有镜像" class="headerlink" title="列出本机上的所有镜像"></a>列出本机上的所有镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line"></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              18.04               3556258649b2        5 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure>
<h3 id="列出本机上所有已创建的容器"><a href="#列出本机上所有已创建的容器" class="headerlink" title="列出本机上所有已创建的容器"></a>列出本机上所有已创建的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS               NAMES</span><br><span class="line">ee4b72860ab3        ubuntu:18.04        <span class="string">"/bin/sh -c 'while t…"</span>   8 minutes ago       Up 8 minutes                                      brave_edison</span><br><span class="line">3063341debf2        ubuntu:18.04        <span class="string">"/bin/bash"</span>              9 minutes ago       Exited (0) 9 minutes ago                          friendly_poitras</span><br><span class="line">6623f20692a4        ubuntu:18.04        <span class="string">"/bin/echo 'Hello wo…"</span>   9 minutes ago       Exited (0) 9 minutes ago                          intelligent_roentgen</span><br><span class="line">a2d42ce3df7d        training/webapp     <span class="string">"python app.py"</span>          2 hours ago         Exited (137) 48 minutes ago                       epic_pasteur</span><br><span class="line">1058cf5fafad        training/webapp     <span class="string">"python app.py"</span>          2 hours ago         Exited (137) 2 hours ago                          goofy_lewin</span><br><span class="line">2c113cc40c51        training/webapp     <span class="string">"python app.py"</span>          2 hours ago         Exited (137) 2 hours ago                          confident_gagarin</span><br><span class="line">c9102f1d9541        training/webapp     <span class="string">"python app.py"</span>          3 hours ago         Exited (137) 2 hours ago                          crazy_borg</span><br><span class="line">a4e84d331fbd        hello-world         <span class="string">"/hello"</span>                 6 hours ago         Exited (0) 6 hours ago                            epic_fermi</span><br><span class="line">b03a6f03bd39        hello-world         <span class="string">"/hello"</span>                 2 days ago          Exited (0) 2 days ago                             competent_cartwright</span><br><span class="line">b7c3f4699549        hello-world         <span class="string">"/hello"</span>                 2 days ago          Exited (0) 2 days ago                             crazy_brattain</span><br><span class="line">bb7eb9e197b4        hello-world         <span class="string">"/hello"</span>                 2 days ago          Exited (0) 2 days ago                             pensive_lalande</span><br></pre></td></tr></table></figure>
<h3 id="修改镜像"><a href="#修改镜像" class="headerlink" title="修改镜像"></a>修改镜像</h3><p>我们以已存在的ubuntu镜像为原始版本，创建新的镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -t -i ubuntu:18.04 /bin/bash</span><br><span class="line">root@d23dc5d88f11:/<span class="comment"># apt-get update</span></span><br><span class="line">root@d23dc5d88f11:/<span class="comment"># exit</span></span><br></pre></td></tr></table></figure></p>
<p>查看最后创建的容器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                          PORTS               NAMES</span><br><span class="line">d23dc5d88f11        ubuntu:18.04        <span class="string">"/bin/bash"</span>         2 minutes ago       Exited (0) About a minute ago                       amazing_vaughan</span><br></pre></td></tr></table></figure></p>
<p>可以看到ID为<code>d23dc5d88f11</code>的容器为我们刚才创建的容器，提交这个容器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker commit -m=<span class="string">"exec apt-get update"</span> -a=<span class="string">"hewentian"</span> d23dc5d88f11 hewentian/ubuntu:v2</span><br><span class="line"></span><br><span class="line">sha256:2bdf86d10fbc18204e04fe5a30dee06dfeb30683247c41e85e8cfe6d66d5d9d6</span><br></pre></td></tr></table></figure></p>
<p>查看我们刚刚创建的镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        6 seconds ago       91MB</span><br><span class="line">ubuntu              18.04               3556258649b2        5 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        6 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>然后，我们就可以使用我们新建的镜像创建容器了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -it hewentian/ubuntu:v2 /bin/bash</span><br><span class="line">root@10adcace776b:/<span class="comment"># cat /proc/version</span></span><br><span class="line">Linux version 4.15.0-47-generic (buildd@lgw01-amd64-001) (gcc version 7.3.0 (Ubuntu 7.3.0-16ubuntu3)) <span class="comment">#50-Ubuntu SMP Wed Mar 13 10:44:52 UTC 2019</span></span><br><span class="line">root@10adcace776b:/<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">root@10adcace776b:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></p>
<h3 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h3><p>从零开始创建一个镜像，我们需要一个Dockerfile文件，示例如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat /home/hewentian/Documents/docker/ubuntu/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM    ubuntu:18.04</span><br><span class="line">MAINTAINER    hewentian <span class="string">"wentian.he@qq.com"</span></span><br><span class="line"></span><br><span class="line">ENV    AUTHOR=<span class="string">"hewentian"</span></span><br><span class="line">WORKDIR    /tmp/</span><br><span class="line">RUN    /usr/bin/touch he.txt</span><br><span class="line">RUN    /bin/<span class="built_in">echo</span> <span class="string">"The author is <span class="variable">$AUTHOR</span>, created at "</span> &gt;&gt; /tmp/he.txt</span><br><span class="line">RUN    /bin/date &gt;&gt; /tmp/he.txt</span><br></pre></td></tr></table></figure></p>
<p>开始创建镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker build -t hewentian/ubuntu:v2.1 -f /home/hewentian/Documents/docker/ubuntu/Dockerfile .</span><br><span class="line"></span><br><span class="line">Sending build context to Docker daemon   2.56kB</span><br><span class="line">Step 1/7 : FROM    ubuntu:18.04</span><br><span class="line"> ---&gt; 3556258649b2</span><br><span class="line">Step 2/7 : MAINTAINER    hewentian <span class="string">"wentian.he@qq.com"</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 9684fd7dab36</span><br><span class="line">Removing intermediate container 9684fd7dab36</span><br><span class="line"> ---&gt; 87f25ba61a99</span><br><span class="line">Step 3/7 : ENV    AUTHOR=<span class="string">"hewentian"</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 22e933129053</span><br><span class="line">Removing intermediate container 22e933129053</span><br><span class="line"> ---&gt; 23c5a574b01c</span><br><span class="line">Step 4/7 : WORKDIR    /tmp/</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> a4341dbc2164</span><br><span class="line">Removing intermediate container a4341dbc2164</span><br><span class="line"> ---&gt; 94663075f2b0</span><br><span class="line">Step 5/7 : RUN    /usr/bin/touch he.txt</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> e54479ffd964</span><br><span class="line">Removing intermediate container e54479ffd964</span><br><span class="line"> ---&gt; a196207c63e9</span><br><span class="line">Step 6/7 : RUN    /bin/<span class="built_in">echo</span> <span class="string">"The author is <span class="variable">$AUTHOR</span>, created at "</span> &gt;&gt; /tmp/he.txt</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 89d010bd1b78</span><br><span class="line">Removing intermediate container 89d010bd1b78</span><br><span class="line"> ---&gt; 11aa9b6d3605</span><br><span class="line">Step 7/7 : RUN    /bin/date &gt;&gt; /tmp/he.txt</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 66627425d24c</span><br><span class="line">Removing intermediate container 66627425d24c</span><br><span class="line"> ---&gt; c6cd98aa1461</span><br><span class="line">Successfully built c6cd98aa1461</span><br><span class="line">Successfully tagged hewentian/ubuntu:v2.1</span><br></pre></td></tr></table></figure></p>
<p>查看生成的镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2.1                c6cd98aa1461        43 seconds ago      64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        18 hours ago        91MB</span><br><span class="line">ubuntu              18.04               3556258649b2        6 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>用我们新建的镜像创建容器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -it hewentian/ubuntu:v2.1 /bin/bash</span><br><span class="line"></span><br><span class="line">root@335d56425694:/tmp<span class="comment"># ls /tmp/</span></span><br><span class="line">he.txt</span><br><span class="line">root@335d56425694:/tmp<span class="comment"># more /tmp/he.txt </span></span><br><span class="line">The author is hewentian, created at </span><br><span class="line">Tue Jul 30 03:10:50 UTC 2019</span><br><span class="line">root@335d56425694:/tmp<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></p>
<p>可见，镜像包含我们自已创建的文件。</p>
<h3 id="将JAR程序部署到容器中"><a href="#将JAR程序部署到容器中" class="headerlink" title="将JAR程序部署到容器中"></a>将JAR程序部署到容器中</h3><p>假设我们现在有一个springBoot的WEB项目，里面有一个接口<code>/hello</code>，已经打好了JAR包。我们要将它部署到容器中运行，目录结构如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/hewentian/Documents/docker/showIp</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">Dockerfile  showIp-1.0.0.jar</span><br></pre></td></tr></table></figure></p>
<p>我们创建一个镜像，因此需要一个Dockerfile文件，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat /home/hewentian/Documents/docker/showIp/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM    java:8</span><br><span class="line">MAINTAINER    hewentian <span class="string">"wentian.he@qq.com"</span></span><br><span class="line"></span><br><span class="line">ADD showIp-1.0.0.jar showIp.jar</span><br><span class="line">EXPOSE 8080</span><br><span class="line">ENTRYPOINT [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"showIp.jar"</span>]</span><br></pre></td></tr></table></figure></p>
<p>开始创建镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/Documents/docker/showIp/</span><br><span class="line">$ sudo docker build -t hewentian/show-ip:v1.0.0 -f /home/hewentian/Documents/docker/showIp/Dockerfile .</span><br><span class="line"></span><br><span class="line">Sending build context to Docker daemon   13.4MB</span><br><span class="line">Step 1/5 : FROM    java:8</span><br><span class="line"> ---&gt; d23bdf5b1b1b</span><br><span class="line">Step 2/5 : MAINTAINER    hewentian <span class="string">"wentian.he@qq.com"</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 8ef66d4bf19b</span><br><span class="line">Step 3/5 : ADD showIp-1.0.0.jar showIp.jar</span><br><span class="line"> ---&gt; 74faf7fe0fdf</span><br><span class="line">Step 4/5 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 605f90040e44</span><br><span class="line">Removing intermediate container 605f90040e44</span><br><span class="line"> ---&gt; 2de558b34abc</span><br><span class="line">Step 5/5 : ENTRYPOINT [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"showIp.jar"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> e8436a5ea5e0</span><br><span class="line">Removing intermediate container e8436a5ea5e0</span><br><span class="line"> ---&gt; 5f89e1fe5e7e</span><br><span class="line">Successfully built 5f89e1fe5e7e</span><br><span class="line">Successfully tagged hewentian/show-ip:v1.0.0</span><br></pre></td></tr></table></figure></p>
<p>运行新创建的镜像：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run -p 8081:8080 -d hewentian/show-ip:v1.0.0</span><br></pre></td></tr></table></figure></p>
<p>运行成功后，可以访问：<br><a href="http://localhost:8081/hello" target="_blank" rel="noopener">http://localhost:8081/hello</a></p>
<h3 id="一些启动参数"><a href="#一些启动参数" class="headerlink" title="一些启动参数"></a>一些启动参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--network host      <span class="comment"># 用了这个参数，表示使用本机的网络，一般可以省略-p参数</span></span><br><span class="line">--restart always    <span class="comment"># 意外关闭（例如OOM）之后，的处理方式</span></span><br><span class="line">--cpus 2            <span class="comment"># 使用的CPU数量</span></span><br><span class="line">--memory 2g         <span class="comment"># 内存</span></span><br><span class="line">--memory-swap 2g    <span class="comment"># 交换空间</span></span><br></pre></td></tr></table></figure>
<p>当然，还有如下可选安装参数：</p>
<pre><code>-e TZ=Asia/Shanghai \
--net=host \
--cpus=8 \
-m 8g \
--restart=always \
</code></pre><h3 id="docker安装nginx"><a href="#docker安装nginx" class="headerlink" title="docker安装nginx"></a>docker安装nginx</h3><p>首先拉取镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker search nginx</span><br><span class="line">$ sudo docker pull nginx</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2.1                c6cd98aa1461        4 hours ago         64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        22 hours ago        91MB</span><br><span class="line">nginx               latest              e445ab08b2be        6 days ago          126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        6 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>使用nginx的默认配置来启动一个容器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run --name nginx-test -p 8081:80 -d nginx</span><br><span class="line"></span><br><span class="line">838ebabcc937cf9a8e13946f92d104b2eb153cc61f21cb47e7661d6bbe205253</span><br></pre></td></tr></table></figure></p>
<p>如果启动成功，则可以在浏览器中访问：<br><a href="http://localhost:8081/" target="_blank" rel="noopener">http://localhost:8081/</a></p>
<p>然后，开始部署我们想要的nginx，首先在本机上创建nginx相关文件目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/Documents/docker</span><br><span class="line">$ mkdir -p nginx/www nginx/logs nginx/conf</span><br></pre></td></tr></table></figure></p>
<p>将刚才启动的nginx容器内的配置文件，复制到本机中：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker cp 838ebabcc937:/etc/nginx/nginx.conf /home/hewentian/Documents/docker/nginx/conf</span><br></pre></td></tr></table></figure></p>
<p><strong>docker cp: 用于本地主机与容器之间的数据复制</strong></p>
<p>创建nginx欢迎页面<code>/home/hewentian/Documents/docker/nginx/www/index.html</code>：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">        width: 35em;</span></span><br><span class="line"><span class="undefined">        margin: 0 auto;</span></span><br><span class="line"><span class="undefined">        font-family: Tahoma, Verdana, Arial, sans-serif;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to docker nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.org/"</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.com/"</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>启动nginx：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name nginx-test2 \</span><br><span class="line">    -p 8082:80 \</span><br><span class="line">    -v /home/hewentian/Documents/docker/nginx/www:/usr/share/nginx/html \</span><br><span class="line">    -v /home/hewentian/Documents/docker/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">    -v /home/hewentian/Documents/docker/nginx/logs:/var/<span class="built_in">log</span>/nginx \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure></p>
<p>参数说明：</p>
<pre><code>-v /home/hewentian/Documents/docker/nginx/www:/usr/share/nginx/html：将在本机创建的目录，挂载到容器内的/usr/share/nginx/html目录
</code></pre><p>如果启动成功，则可以在浏览器中访问：<br><a href="http://localhost:8082/" target="_blank" rel="noopener">http://localhost:8082/</a></p>
<h3 id="docker安装redis"><a href="#docker安装redis" class="headerlink" title="docker安装redis"></a>docker安装redis</h3><p>先建立保存数据的目录和设置好配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /root/db/redis</span><br><span class="line">$ mkdir data conf</span><br><span class="line">$ <span class="built_in">cd</span> conf</span><br><span class="line">$ vi redis.conf</span><br><span class="line"></span><br><span class="line">requirepass abc123</span><br><span class="line"></span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br></pre></td></tr></table></figure></p>
<p>开始安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull redis:7.0.2</span><br><span class="line">$</span><br><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name redis-hwt \</span><br><span class="line">    -p 6379:6379 \</span><br><span class="line">    -v /root/db/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">    -v /root/db/redis/data:/data \</span><br><span class="line">    redis:7.0.2 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure></p>
<h3 id="docker安装mysql"><a href="#docker安装mysql" class="headerlink" title="docker安装mysql"></a>docker安装mysql</h3><p>先建立保存数据的目录和设置好配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /root/db/mysql</span><br><span class="line">$ mkdir data conf logs</span><br><span class="line">$ <span class="built_in">cd</span> conf</span><br><span class="line">$ vi mysql.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"><span class="comment">#port=3306</span></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">#port=3306</span></span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">max_connections=100</span><br><span class="line"><span class="comment">#sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span></span><br><span class="line"><span class="comment">#slow-query-log=1</span></span><br><span class="line"><span class="comment">#default-time_zone = '+8:00'</span></span><br><span class="line"><span class="comment">#secure-file-priv=""</span></span><br><span class="line"><span class="comment">#log_timestamps=SYSTEM</span></span><br><span class="line"><span class="comment">#skip-name-resolve</span></span><br><span class="line"><span class="comment">#sort_buffer_size =2M</span></span><br><span class="line"><span class="comment">#tmp_table_size=128M</span></span><br><span class="line"><span class="comment">#innodb_buffer_pool_size = 8G</span></span><br><span class="line"><span class="comment">#binlog_expire_logs_seconds=259200</span></span><br><span class="line"><span class="comment">#performance_schema_max_table_instances=400</span></span><br><span class="line"><span class="comment">#table_definition_cache=400</span></span><br><span class="line"><span class="comment">#table_open_cache=256</span></span><br></pre></td></tr></table></figure></p>
<p>拉取镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker search mysql</span><br><span class="line">$ sudo docker pull mysql:8.0.26</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2.1                c6cd98aa1461        4 hours ago         64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        22 hours ago        91MB</span><br><span class="line">nginx               latest              e445ab08b2be        6 days ago          126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        6 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br><span class="line">mysql               8.0.26              9da615fced53        2 months ago        514MB</span><br></pre></td></tr></table></figure></p>
<p>运行容器</p>
<ol>
<li><p>简单安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name mysql-hwt \</span><br><span class="line">    -p 3306:3306 \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">    mysql:8.0.26</span><br></pre></td></tr></table></figure>
</li>
<li><p>详细安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name mysql-hwt \</span><br><span class="line">    -p 3306:3306 \</span><br><span class="line">    -v /root/db/mysql/conf/mysql.cnf:/etc/mysql/conf.d/mysql.cnf \</span><br><span class="line">    -v /root/db/mysql/data:/var/lib/mysql \</span><br><span class="line">    -v /root/db/mysql/logs:/logs \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">    mysql:8.0.26</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                PORTS                       NAMES</span><br><span class="line">524097ed5349        mysql:8.0.26        <span class="string">"docker-entrypoint.s…"</span>   3 minutes ago       Up 3 minutes          0.0.0.0:3306-&gt;3306/tcp      mysql-hwt</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>进入mysql，将root用户密码修改，并且禁用root远程登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">exec</span> -it mysql-hwt mysql -uroot -p123456</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT ALL ON *.* TO <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'root'</span>;</span><br><span class="line">mysql&gt; DELETE FROM mysql.user WHERE User=<span class="string">'root'</span> AND Host NOT IN (<span class="string">'localhost'</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>);</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">-- 从mysql8.0开始，语法用下面的</span><br><span class="line">mysql&gt; ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'root'</span>;</span><br><span class="line">mysql&gt; GRANT ALL ON *.* TO <span class="string">'root'</span>@<span class="string">'localhost'</span>;</span><br><span class="line">mysql&gt; DELETE FROM mysql.user WHERE User=<span class="string">'root'</span> AND Host NOT IN (<span class="string">'localhost'</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>);</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></p>
<p>查看编码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'char%'</span>;</span><br><span class="line">+--------------------------+--------------------------------+</span><br><span class="line">| Variable_name            | Value                          |</span><br><span class="line">+--------------------------+--------------------------------+</span><br><span class="line">| character_set_client     | utf8mb4                        |</span><br><span class="line">| character_set_connection | utf8mb4                        |</span><br><span class="line">| character_set_database   | utf8mb4                        |</span><br><span class="line">| character_set_filesystem | binary                         |</span><br><span class="line">| character_set_results    | utf8mb4                        |</span><br><span class="line">| character_set_server     | utf8mb4                        |</span><br><span class="line">| character_set_system     | utf8mb3                        |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |</span><br><span class="line">+--------------------------+--------------------------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p>然后创建一个用于操作mysql的简单用户，参考之前的 <a href="../../../../2017/12/07/mysql-note/">mysql 学习笔记</a>。</p>
<p>如果此时尝试用 Workbench 或 Navicat 连接，会报如下错误：</p>
<pre><code>ERROR 2059 (HY000): Authentication plugin &apos;caching_sha2_password&apos; cannot be loaded: dlopen(/usr/local/mysql/lib/plugin/caching_sha2_password.so, 2): image not found
</code></pre><p>报错原因<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 8.0.26    |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.28</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'default_authentication_plugin'</span>;</span><br><span class="line">+<span class="comment">-------------------------------+-----------------------+</span></span><br><span class="line">| Variable_name                 | Value                 |</span><br><span class="line">+<span class="comment">-------------------------------+-----------------------+</span></span><br><span class="line">| default_authentication_plugin | caching_sha2_password |</span><br><span class="line">+<span class="comment">-------------------------------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.26</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> host,<span class="keyword">user</span>,<span class="keyword">plugin</span> <span class="keyword">from</span> mysql.user;</span><br><span class="line">+<span class="comment">-----------+------------------+-----------------------+</span></span><br><span class="line">| host      | user             | plugin                |</span><br><span class="line">+<span class="comment">-----------+------------------+-----------------------+</span></span><br><span class="line">| %         | hwh              | caching_sha2_password |</span><br><span class="line">| localhost | mysql.infoschema | caching_sha2_password |</span><br><span class="line">| localhost | mysql.session    | caching_sha2_password |</span><br><span class="line">| localhost | mysql.sys        | caching_sha2_password |</span><br><span class="line">| localhost | root             | caching_sha2_password |</span><br><span class="line">+<span class="comment">-----------+------------------+-----------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.31</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可以看到<code>mysql 8.0.26</code>版本默认的认证方式是<code>caching_sha2_password</code>，连接不上的原因在于连接数据库工具不支持该格式的密码。</p>
<p>解决方法：修改密码加密方式<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">user</span> <span class="string">'hwh'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span> <span class="keyword">PASSWORD</span> <span class="keyword">EXPIRE</span> <span class="keyword">NEVER</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">user</span> <span class="string">'hwh'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="docker安装mongo"><a href="#docker安装mongo" class="headerlink" title="docker安装mongo"></a>docker安装mongo</h3><p>先建立保存数据的目录和设置好配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /root/db/mongodb</span><br><span class="line">$ mkdir configdb data logs</span><br><span class="line">$ <span class="built_in">cd</span> configdb</span><br><span class="line">$ vi mongod.conf</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: <span class="literal">true</span></span><br><span class="line">  path: /var/<span class="built_in">log</span>/mongodb/mongod.log</span><br></pre></td></tr></table></figure></p>
<p>开始安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull mongo</span><br><span class="line">$</span><br><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name mongo \</span><br><span class="line">    -p 27017:27017 \</span><br><span class="line">    -v /root/db/mongodb/data:/data/db \</span><br><span class="line">    -v /root/db/mongodb/configdb:/data/configdb \</span><br><span class="line">    -v /root/db/mongodb/logs:/data/logs \</span><br><span class="line">    --auth \</span><br><span class="line">    -f /data/configdb/mongod.conf \</span><br><span class="line">    --bind_ip_all \</span><br><span class="line">    mongo:latest</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>进入mongo，添加管理员。创建第一个用户admin，该用户需要有用户管理权限，其角色为root。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">exec</span> -it mongo mongo</span><br><span class="line">MongoDB shell version v4.2.7</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session &#123; <span class="string">"id"</span> : UUID(<span class="string">"81ad33aa-6318-4854-98df-9910a8927698"</span>) &#125;</span><br><span class="line">MongoDB server version: 4.2.7</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">"help"</span>.</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line">	http://docs.mongodb.org/</span><br><span class="line">Questions? Try the support group</span><br><span class="line">	http://groups.google.com/group/mongodb-user</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt;  db.createUser(&#123;user:<span class="string">"admin"</span>,<span class="built_in">pwd</span>:<span class="string">"12345"</span>,roles:[<span class="string">"root"</span>]&#125;)</span><br><span class="line">Successfully added user: &#123; <span class="string">"user"</span> : <span class="string">"admin"</span>, <span class="string">"roles"</span> : [ <span class="string">"root"</span> ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt; show collections</span><br><span class="line">Warning: unable to run listCollections, attempting to approximate collection names by parsing connectionStatus</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.auth(<span class="string">"admin"</span>,<span class="string">"12345"</span>)</span><br><span class="line">1</span><br><span class="line">&gt;</span><br><span class="line">&gt; show collections</span><br><span class="line">system.users</span><br><span class="line">system.version</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加数据库用户<br>为数据库添加用户，添加用户前需要切换到该数据库，这里简单设置其角色为dbOwner</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; use bfg</span><br><span class="line">switched to db bfg</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.createUser(&#123;user: <span class="string">"bfg"</span>, <span class="built_in">pwd</span>: <span class="string">"bfg100"</span>, roles: [&#123; role: <span class="string">"dbOwner"</span>, db: <span class="string">"bfg"</span> &#125;]&#125;)</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">	<span class="string">"user"</span> : <span class="string">"bfg"</span>,</span><br><span class="line">	<span class="string">"roles"</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"role"</span> : <span class="string">"dbOwner"</span>,</span><br><span class="line">			<span class="string">"db"</span> : <span class="string">"bfg"</span></span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="docker安装rabbitmq"><a href="#docker安装rabbitmq" class="headerlink" title="docker安装rabbitmq"></a>docker安装rabbitmq</h3><ol>
<li>简单安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull rabbitmq:3.8.9-management</span><br><span class="line">$</span><br><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name rabbitmq-hwt \</span><br><span class="line">    -p 5672:5672 \</span><br><span class="line">    -p 15672:15672 \</span><br><span class="line">    -e RABBITMQ_DEFAULT_USER=admin \</span><br><span class="line">    -e RABBITMQ_DEFAULT_PASS=admin \</span><br><span class="line">    rabbitmq:3.8.9-management</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>访问WEB界面：<br><a href="http://192.168.56.113:15672/" target="_blank" rel="noopener">http://192.168.56.113:15672/</a></p>
<h3 id="docker安装zookeeper"><a href="#docker安装zookeeper" class="headerlink" title="docker安装zookeeper"></a>docker安装zookeeper</h3><ol>
<li>简单安装<br>先建立保存数据的目录和设置好配置文件：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /root/db/zookeeper</span><br><span class="line">$ mkdir data datalog logs</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>开始安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull zookeeper:3.6.2</span><br><span class="line">$</span><br><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name zookeeper-hwt \</span><br><span class="line">    -p 2181:2181 \</span><br><span class="line">    -e ZOO_TICK_TIME=2000 \</span><br><span class="line">    -e ZOO_INIT_LIMIT=10 \</span><br><span class="line">    -e ZOO_SYNC_LIMIT=5 \</span><br><span class="line">    -v /root/db/zookeeper/data:/data \</span><br><span class="line">    -v /root/db/zookeeper/datalog:/datalog \</span><br><span class="line">    -v /root/db/zookeeper/logs:/logs \</span><br><span class="line">    zookeeper:3.6.2</span><br></pre></td></tr></table></figure></p>
<p>客户端登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">exec</span> -it zookeeper-hwt zkCli.sh</span><br><span class="line">Connecting to localhost:2181</span><br></pre></td></tr></table></figure></p>
<h3 id="docker安装kafka"><a href="#docker安装kafka" class="headerlink" title="docker安装kafka"></a>docker安装kafka</h3><ol>
<li>简单安装<br>先建立保存数据的目录和设置好配置文件：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /root/db/kafka</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>开始安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull wurstmeister/kafka:2.13-2.7.0</span><br><span class="line">$</span><br><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name kafka-hwt \</span><br><span class="line">    -p 9092:9092 \</span><br><span class="line">    -e KAFKA_BROKER_ID=0 \</span><br><span class="line">    -e KAFKA_ZOOKEEPER_CONNECT=192.168.56.113:2181/kafka \</span><br><span class="line">    -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.56.113:9092 \</span><br><span class="line">    -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 \</span><br><span class="line">    -v /root/db/kafka:/kafka \</span><br><span class="line">    wurstmeister/kafka:2.13-2.7.0</span><br></pre></td></tr></table></figure></p>
<p>验证kafka是否可以使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">exec</span> -it kafka-hwt bash</span><br><span class="line">$ <span class="built_in">cd</span> /opt/kafka/bin/</span><br><span class="line">$</span><br><span class="line">$ 发送消息</span><br><span class="line">$ ./kafka-console-producer.sh --broker-list localhost:9092 --topic redsuns</span><br><span class="line">&gt; hello word</span><br><span class="line">$</span><br><span class="line">$ 接收消息</span><br><span class="line">$ ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic redsuns --from-beginning</span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：因为上面的<code>KAFKA_ZOOKEEPER_CONNECT</code>将kafka的数据保存到了<code>/kafka</code>目录下，所以，当我们使用<code>Kafka Tool</code>工具连接kafka的时候要记得配置<code>chroot path: /kafka</code>，否则连不上。</p>
<h3 id="docker安装zipkin"><a href="#docker安装zipkin" class="headerlink" title="docker安装zipkin"></a>docker安装zipkin</h3><p>拉取镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull openzipkin/zipkin</span><br></pre></td></tr></table></figure></p>
<ol>
<li>简单安装（数据保存到内存中）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name zipkin-hwt \</span><br><span class="line">    -p 9411:9411 \</span><br><span class="line">    openzipkin/zipkin</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>访问WEB界面：<br><a href="http://192.168.56.113:9411/zipkin/" target="_blank" rel="noopener">http://192.168.56.113:9411/zipkin/</a></p>
<ol>
<li>详细安装（数据保存到mysql中，并且从消息队列中读取数据）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run \</span><br><span class="line">    -itd --name zipkin-hwt \</span><br><span class="line">    -p 9411:9411 \</span><br><span class="line">    -e STORAGE_TYPE=mysql \</span><br><span class="line">    -e MYSQL_HOST=192.168.56.113 \</span><br><span class="line">    -e MYSQL_TCP_PORT=3306 \</span><br><span class="line">    -e MYSQL_DB=zipkin \</span><br><span class="line">    -e MYSQL_USER=zipkin \</span><br><span class="line">    -e MYSQL_PASS=HFWM8DBv6nfPXKg2 \</span><br><span class="line">    -e RABBIT_ADDRESSES=192.168.56.113:5672 \</span><br><span class="line">    -e RABBIT_USER=admin \</span><br><span class="line">    -e RABBIT_PASSWORD=admin \</span><br><span class="line">    openzipkin/zipkin</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="进入指定的容器"><a href="#进入指定的容器" class="headerlink" title="进入指定的容器"></a>进入指定的容器</h3><p>若启动容器的时候不是以交互模式，之后又想进入容器，则可以使用如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">先启动一个之前停止了的容器</span><br><span class="line">$ sudo docker start 3063341debf2</span><br><span class="line">3063341debf2</span><br><span class="line"></span><br><span class="line">直接运行容器内的脚本</span><br><span class="line">$ sudo docker <span class="built_in">exec</span> -it 3063341debf2 /bin/bash /a.sh</span><br><span class="line">Wed Jul 31 01:40:20 UTC 2019</span><br><span class="line"></span><br><span class="line">以交互模式进入容器</span><br><span class="line">$ sudo docker <span class="built_in">exec</span> -it 3063341debf2 /bin/bash</span><br><span class="line">root@3063341debf2:/<span class="comment"># ls</span></span><br><span class="line">a.sh  bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@3063341debf2:/<span class="comment"># sh a.sh </span></span><br><span class="line">Wed Jul 31 01:44:34 UTC 2019</span><br><span class="line">root@3063341debf2:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">退出后，容器并不会停止</span><br><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3063341debf2        ubuntu:18.04        <span class="string">"/bin/bash"</span>         41 hours ago        Up 18 seconds                           friendly_poitras</span><br></pre></td></tr></table></figure></p>
<p>另外，使用<code>attach</code>命令也能进入容器，但是当退出后，容器会停止<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3063341debf2        ubuntu:18.04        <span class="string">"/bin/bash"</span>         41 hours ago        Up 18 seconds                           friendly_poitras</span><br><span class="line"></span><br><span class="line">$ sudo docker attach --sig-proxy=<span class="literal">false</span> 3063341debf2</span><br><span class="line">root@3063341debf2:/<span class="comment"># ls</span></span><br><span class="line">a.sh  bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@3063341debf2:/<span class="comment"># sh a.sh </span></span><br><span class="line">Wed Jul 31 02:02:50 UTC 2019</span><br><span class="line">root@3063341debf2:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br></pre></td></tr></table></figure></p>
<h3 id="将镜像导出-导入"><a href="#将镜像导出-导入" class="headerlink" title="将镜像导出/导入"></a>将镜像导出/导入</h3><p>导出镜像语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker save --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker save [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line">Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -o, --output string   Write to a file, instead of STDOUT</span><br></pre></td></tr></table></figure></p>
<p>导入镜像语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker load --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker load [OPTIONS]</span><br><span class="line"></span><br><span class="line">Load an image from a tar archive or STDIN</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -i, --input string   Read from tar archive file, instead of STDIN</span><br><span class="line">  -q, --quiet          Suppress the load output</span><br></pre></td></tr></table></figure></p>
<p>示例：先将镜像导出，然后删除镜像，最后再将导出的镜像重新导入：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              c6cd98aa1461        27 hours ago        64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        45 hours ago        91MB</span><br><span class="line">nginx               latest              e445ab08b2be        7 days ago          126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        7 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br><span class="line"></span><br><span class="line">$ sudo docker save -o hu.tar hewentian/ubuntu:v2</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">hu.tar</span><br><span class="line"></span><br><span class="line">$ sudo docker rmi 2bdf86d10fbc</span><br><span class="line">Untagged: hewentian/ubuntu:v2</span><br><span class="line">Deleted: sha256:2bdf86d10fbc18204e04fe5a30dee06dfeb30683247c41e85e8cfe6d66d5d9d6</span><br><span class="line">Deleted: sha256:c4a9226f13fa8f48ef07e27e0954c43f38275b6aa1d24e361ed016dfff056069</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              c6cd98aa1461        27 hours ago        64.2MB</span><br><span class="line">nginx               latest              e445ab08b2be        7 days ago          126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        7 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br><span class="line"></span><br><span class="line">$ sudo docker load -i hu.tar </span><br><span class="line">ed4797628ae8: Loading layer [==================================================&gt;]  26.85MB/26.85MB</span><br><span class="line">Loaded image: hewentian/ubuntu:v2</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              c6cd98aa1461        27 hours ago        64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        45 hours ago        91MB</span><br><span class="line">nginx               latest              e445ab08b2be        7 days ago          126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        7 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>或者使用压缩方式导出导入</p>
<pre><code>$ sudo docker save mysql:5.6.42 | gzip &gt; mysql-5.6.42.tar.gz
$ sudo docker load &lt; mysql-5.6.42.tar.gz
</code></pre><p><strong>注意：导出镜像的时候，要使用<code>REPOSITORY:TAG</code>，而不是<code>IMAGE ID</code>，否则在重新导入的时候会没有<code>REPOSITORY:TAG</code>，显示为none</strong></p>
<h3 id="使用import创建镜像"><a href="#使用import创建镜像" class="headerlink" title="使用import创建镜像"></a>使用import创建镜像</h3><p>也可以从导出的tar文件中创建一个新的镜像，语法如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker import --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">Import the contents from a tarball to create a filesystem image</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -c, --change list      Apply Dockerfile instruction to the created image</span><br><span class="line">  -m, --message string   Set commit message <span class="keyword">for</span> imported image</span><br></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker import hu.tar hewentian/ubuntu:v2.1</span><br><span class="line">sha256:c389673d68c576b08ad8e3c2337de4ee3b4ed7e622fa986771323797edd2d595</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2.1                c389673d68c5        5 seconds ago       66.6MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        45 hours ago        91MB</span><br><span class="line">nginx               latest              e445ab08b2be        7 days ago          126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        7 days ago          64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p><strong>我试过使用import进去的镜像来创建容器，但是失败了，留待以后再解决</strong></p>
<h3 id="登录-登出镜像仓库"><a href="#登录-登出镜像仓库" class="headerlink" title="登录/登出镜像仓库"></a>登录/登出镜像仓库</h3><p>默认登录/登出官方仓库 <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a> ，不过，也可以登录到指定的私有仓库。</p>
<p>登录语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log <span class="keyword">in</span> to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure></p>
<p>登出语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">logout</span> --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker <span class="built_in">logout</span> [SERVER]</span><br><span class="line"></span><br><span class="line">Log out from a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br></pre></td></tr></table></figure></p>
<p>登录/登出示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login -u hewentian</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /home/hewentian/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/<span class="comment">#credentials-store</span></span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ sudo docker <span class="built_in">logout</span> </span><br><span class="line">Removing login credentials <span class="keyword">for</span> https://index.docker.io/v1/</span><br></pre></td></tr></table></figure></p>
<h3 id="将本地镜像上传到镜像仓库"><a href="#将本地镜像上传到镜像仓库" class="headerlink" title="将本地镜像上传到镜像仓库"></a>将本地镜像上传到镜像仓库</h3><p>默认上传到docker官方仓库docker.io，上传到私有仓库的例子，后面会介绍。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker push hewentian/ubuntu:v2.1</span><br><span class="line">The push refers to repository [docker.io/hewentian/ubuntu]</span><br><span class="line">8c29bfccf50c: Pushed </span><br><span class="line">v2.1: digest: sha256:992cc4e008449d8285387fe80aff3c9b0574360fc3ad21b04bccc5b6a4229923 size: 528</span><br></pre></td></tr></table></figure></p>
<h3 id="harbor的安装"><a href="#harbor的安装" class="headerlink" title="harbor的安装"></a>harbor的安装</h3><p>我们将在机器<code>192.168.56.113</code>上面安装harbor，安装过程参考这里：<br><a href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a></p>
<p>harbor依赖<code>docker 17.06.0-ce+</code>、<code>docker-compose 1.18.0+</code>，其中<code>dock-ce</code>的安装参照上文。</p>
<p>安装<code>docker-compose</code>，参考： <a href="https://docs.docker.com/compose/install/#install-compose" target="_blank" rel="noopener">https://docs.docker.com/compose/install/#install-compose</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="variable">$(uname -s)</span>-<span class="variable">$(uname -m)</span>"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">$ docker-compose -version</span><br><span class="line">docker-compose version 1.24.1, build 4667896b</span><br></pre></td></tr></table></figure></p>
<p>开始安装harbor，安装之前需要启动docker，参考： <a href="https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md">https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md</a><br>下载离线安装包，在 <a href="https://github.com/goharbor/harbor/releases">https://github.com/goharbor/harbor/releases</a> 下载最新版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop</span><br><span class="line">$ wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.2-rc1.tgz</span><br><span class="line">$ tar xf harbor-offline-installer-v1.8.2-rc1.tgz</span><br><span class="line">$ <span class="built_in">cd</span> harbor</span><br><span class="line">$ ls </span><br><span class="line">harbor.v1.8.2.tar.gz  harbor.yml  install.sh  LICENSE  prepare</span><br></pre></td></tr></table></figure></p>
<p>安装前的配置，配置文件<code>harbor.yml</code>中<code>hostname</code>可以配置成IP地址或域名，主要是用于给客户端登录使用：<br>首先查看本机的<code>hostname</code>和IP地址<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ hostname</span><br><span class="line">hadoop-host-slave-3</span><br><span class="line"></span><br><span class="line">$ ifconfig</span><br><span class="line">enp0s3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.56.113  netmask 255.255.255.0  broadcast 192.168.56.255</span><br><span class="line">        inet6 fe80::90f2:2a79:288c:984e  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 08:00:27:9f:8e:7e  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 4726  bytes 448939 (448.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 7637  bytes 9739346 (9.7 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure></p>
<p>可以看到<code>hostname</code>是<code>hadoop-host-slave-3</code>，而IP地址是<code>192.168.56.113</code>。这里我们将<code>hostname</code>配置成<code>hadoop-host-slave-3</code>，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/harbor</span><br><span class="line">$ vi harbor.yml</span><br><span class="line"></span><br><span class="line">hostname: hadoop-host-slave-3</span><br></pre></td></tr></table></figure></p>
<p>开始安装，执行一个安装脚本即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/harbor</span><br><span class="line">$ sudo ./install.sh</span><br></pre></td></tr></table></figure></p>
<p>如无意外，你会看到如下的安装日志：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">[sudo] password <span class="keyword">for</span> hadoop: </span><br><span class="line"></span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 19.03.1</span><br><span class="line"></span><br><span class="line">Note: docker-compose version: 1.24.1</span><br><span class="line"></span><br><span class="line">[Step 1]: loading Harbor images ...</span><br><span class="line">39b2d676308e: Loading layer [==================================================&gt;]  33.47MB/33.47MB</span><br><span class="line">f3583ea30104: Loading layer [==================================================&gt;]  3.552MB/3.552MB</span><br><span class="line">8290f582ffa5: Loading layer [==================================================&gt;]   6.59MB/6.59MB</span><br><span class="line">19913bc5e52b: Loading layer [==================================================&gt;]  161.3kB/161.3kB</span><br><span class="line">ae8b73743d1b: Loading layer [==================================================&gt;]    215kB/215kB</span><br><span class="line">5c811d1fe61a: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: goharbor/harbor-portal:v1.8.2</span><br><span class="line">f27812f7a2da: Loading layer [==================================================&gt;]  8.971MB/8.971MB</span><br><span class="line">c74d2b18a2d1: Loading layer [==================================================&gt;]  38.82MB/38.82MB</span><br><span class="line">c416e128ff4c: Loading layer [==================================================&gt;]  38.82MB/38.82MB</span><br><span class="line">Loaded image: goharbor/harbor-jobservice:v1.8.2</span><br><span class="line">e97909585a09: Loading layer [==================================================&gt;]  8.972MB/8.972MB</span><br><span class="line">23b18d08698d: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">9c1d8c03df3e: Loading layer [==================================================&gt;]   20.1MB/20.1MB</span><br><span class="line">9666a22cf141: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">95783fa51b82: Loading layer [==================================================&gt;]  7.465MB/7.465MB</span><br><span class="line">285e05bca91e: Loading layer [==================================================&gt;]  27.56MB/27.56MB</span><br><span class="line">Loaded image: goharbor/harbor-registryctl:v1.8.2</span><br><span class="line">6543a3ba9bd9: Loading layer [==================================================&gt;]    338MB/338MB</span><br><span class="line">43f486f0ed18: Loading layer [==================================================&gt;]    107kB/107kB</span><br><span class="line">Loaded image: goharbor/harbor-migrator:v1.8.2</span><br><span class="line">6710d86773e1: Loading layer [==================================================&gt;]  50.51MB/50.51MB</span><br><span class="line">dba91d68db46: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">4b6a61fc3477: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">efd64eeb5c31: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">25d50c6108dd: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">6c22404ddaf0: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">135fef0d64a7: Loading layer [==================================================&gt;]  12.29kB/12.29kB</span><br><span class="line">Loaded image: goharbor/harbor-log:v1.8.2</span><br><span class="line">f080cac48a5f: Loading layer [==================================================&gt;]  3.552MB/3.552MB</span><br><span class="line">Loaded image: goharbor/nginx-photon:v1.8.2</span><br><span class="line">9562b05e7bd1: Loading layer [==================================================&gt;]  8.971MB/8.971MB</span><br><span class="line">2ff1ba9952dc: Loading layer [==================================================&gt;]  5.143MB/5.143MB</span><br><span class="line">463651a0baca: Loading layer [==================================================&gt;]  15.13MB/15.13MB</span><br><span class="line">feceecff30a6: Loading layer [==================================================&gt;]  26.47MB/26.47MB</span><br><span class="line">a2d1a1b1eaaa: Loading layer [==================================================&gt;]  22.02kB/22.02kB</span><br><span class="line">2c8463eca215: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">7e91f466c852: Loading layer [==================================================&gt;]  46.74MB/46.74MB</span><br><span class="line">Loaded image: goharbor/notary-server-photon:v0.6.1-v1.8.2</span><br><span class="line">628aac791456: Loading layer [==================================================&gt;]    113MB/113MB</span><br><span class="line">32e13bd19d15: Loading layer [==================================================&gt;]  10.94MB/10.94MB</span><br><span class="line">17d6a3366a31: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">9c3d274d3072: Loading layer [==================================================&gt;]  48.13kB/48.13kB</span><br><span class="line">a3e8bc524efe: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">6edf120ab0a5: Loading layer [==================================================&gt;]  10.99MB/10.99MB</span><br><span class="line">Loaded image: goharbor/clair-photon:v2.0.8-v1.8.2</span><br><span class="line">fa7f8bd666e1: Loading layer [==================================================&gt;]  8.972MB/8.972MB</span><br><span class="line">d23a3ac1da5c: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">25ece37b9b62: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">ceff80c4799d: Loading layer [==================================================&gt;]   20.1MB/20.1MB</span><br><span class="line">4ddaf99a2326: Loading layer [==================================================&gt;]   20.1MB/20.1MB</span><br><span class="line">Loaded image: goharbor/registry-photon:v2.7.1-patch-2819-v1.8.2</span><br><span class="line">86ef8960f9fa: Loading layer [==================================================&gt;]  13.72MB/13.72MB</span><br><span class="line">4be07cab0847: Loading layer [==================================================&gt;]  26.47MB/26.47MB</span><br><span class="line">b3f2bb8db417: Loading layer [==================================================&gt;]  22.02kB/22.02kB</span><br><span class="line">4c68837d983b: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">f2526a5c0965: Loading layer [==================================================&gt;]  45.33MB/45.33MB</span><br><span class="line">Loaded image: goharbor/notary-signer-photon:v0.6.1-v1.8.2</span><br><span class="line">9c6a2b28994d: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">49bb4e719955: Loading layer [==================================================&gt;]  1.536kB/1.536kB</span><br><span class="line">47d1a63f5482: Loading layer [==================================================&gt;]  69.81MB/69.81MB</span><br><span class="line">db449d60801c: Loading layer [==================================================&gt;]  39.75MB/39.75MB</span><br><span class="line">f01c7fa07db7: Loading layer [==================================================&gt;]  144.4kB/144.4kB</span><br><span class="line">5ff7a32e9f2c: Loading layer [==================================================&gt;]  3.005MB/3.005MB</span><br><span class="line">Loaded image: goharbor/prepare:v1.8.2</span><br><span class="line">6602e119ecab: Loading layer [==================================================&gt;]  8.971MB/8.971MB</span><br><span class="line">6b45eae45c58: Loading layer [==================================================&gt;]  46.86MB/46.86MB</span><br><span class="line">e3d9614f88b3: Loading layer [==================================================&gt;]  5.632kB/5.632kB</span><br><span class="line">f0b457c2a1b1: Loading layer [==================================================&gt;]  28.67kB/28.67kB</span><br><span class="line">f4e712369f36: Loading layer [==================================================&gt;]  46.86MB/46.86MB</span><br><span class="line">Loaded image: goharbor/harbor-core:v1.8.2</span><br><span class="line">c39fa71cb1b3: Loading layer [==================================================&gt;]   63.4MB/63.4MB</span><br><span class="line">245ad05b59aa: Loading layer [==================================================&gt;]  50.88MB/50.88MB</span><br><span class="line">6fc4b5ec5705: Loading layer [==================================================&gt;]  6.656kB/6.656kB</span><br><span class="line">8a003956ed73: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">0b4d3b06d5d5: Loading layer [==================================================&gt;]   7.68kB/7.68kB</span><br><span class="line">c045e2109691: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">eef5f9c09eb0: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">75776554d401: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">Loaded image: goharbor/harbor-db:v1.8.2</span><br><span class="line">0130cb61aaba: Loading layer [==================================================&gt;]  74.58MB/74.58MB</span><br><span class="line">9f0973beb46c: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">74bd291b6f8b: Loading layer [==================================================&gt;]   59.9kB/59.9kB</span><br><span class="line">3b11caba8d3e: Loading layer [==================================================&gt;]  61.95kB/61.95kB</span><br><span class="line">Loaded image: goharbor/redis-photon:v1.8.2</span><br><span class="line">5b00b48e6ec3: Loading layer [==================================================&gt;]  8.976MB/8.976MB</span><br><span class="line">7f5008b71ec6: Loading layer [==================================================&gt;]  44.39MB/44.39MB</span><br><span class="line">02f96d3b6e35: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">da8354357ee3: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">1819913851a3: Loading layer [==================================================&gt;]   44.4MB/44.4MB</span><br><span class="line">Loaded image: goharbor/chartmuseum-photon:v0.9.0-v1.8.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 2]: preparing environment ...</span><br><span class="line">prepare base dir is <span class="built_in">set</span> to /home/hadoop/harbor</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">Generated configuration file: /config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: /config/core/env</span><br><span class="line">Generated configuration file: /config/core/app.conf</span><br><span class="line">Generated configuration file: /config/registry/config.yml</span><br><span class="line">Generated configuration file: /config/registryctl/env</span><br><span class="line">Generated configuration file: /config/db/env</span><br><span class="line">Generated configuration file: /config/jobservice/env</span><br><span class="line">Generated configuration file: /config/jobservice/config.yml</span><br><span class="line">Generated and saved secret to file: /secret/keys/secretkey</span><br><span class="line">Generated certificate, key file: /secret/core/private_key.pem, cert file: /secret/registry/root.crt</span><br><span class="line">Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">Clean up the input dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network <span class="string">"harbor_harbor"</span> with the default driver</span><br><span class="line">Creating harbor-log ... <span class="keyword">done</span></span><br><span class="line">Creating redis       ... <span class="keyword">done</span></span><br><span class="line">Creating registryctl ... <span class="keyword">done</span></span><br><span class="line">Creating registry    ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-db   ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-core ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-portal     ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-jobservice ... <span class="keyword">done</span></span><br><span class="line">Creating nginx             ... <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://hadoop-host-slave-3. </span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure></p>
<p>按照上面的提示，我们在浏览器中访问<br><a href="http://hadoop-host-slave-3" target="_blank" rel="noopener">http://hadoop-host-slave-3</a><br><a href="http://harbor.hewentian.com" target="_blank" rel="noopener">http://harbor.hewentian.com</a></p>
<p>在访问之前，我们需要在本地机器中配置一下hosts，添加如下两行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ more /etc/hosts</span><br><span class="line"></span><br><span class="line">192.168.56.113	hadoop-host-slave-3</span><br><span class="line">192.168.56.113	harbor.hewentian.com</span><br></pre></td></tr></table></figure></p>
<p>为方便docker将镜像上传到私有harbor，这里多配置一个域名。所以访问上面所列的两个站点，结果是一样的。后面的操作，我们使用<code>harbor.hewentian.com</code>这个域名。</p>
<p><img src="/img/harbor-admin-login.png" alt="" title="harbor 管理员登录"></p>
<p>输入管理员的初始用户名/密码：<code>admin/Harbor12345</code>，登录之后，在页面上可以修改密码。登录之后，如下图：</p>
<p><img src="/img/harbor-logined.png" alt="" title="harbor logined"></p>
<p>我们创建一个用户，用户名/密码：<code>hewentian/Harbor12345</code>，用于上传下载镜像：</p>
<p><img src="/img/harbor-new-user.png" alt="" title="harbor 创建用户"></p>
<p>然后我们退出管理员帐号，用新创建的用户登录：</p>
<p><img src="/img/harbor-user-login.png" alt="" title="harbor 普通用户登录"></p>
<p>创建一个project，名为hp，可见性为public：</p>
<p><img src="/img/harbor-create-project.png" alt="" title="harbor 普通用户登录"></p>
<p>docker登录到harbor<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login harbor.hewentian.com -u hewentian</span><br><span class="line">Password: </span><br><span class="line">Error response from daemon: Get https://harbor.hewentian.com/v2/: dial tcp 192.168.56.113:443: connect: connection refused</span><br></pre></td></tr></table></figure></p>
<p>有可能会报上面的错误，原因是docker与registry交互默认使用的是HTTPS，但是我们搭建的harbor默认使用的是HTTP服务。解决方法：<br>在要登录到harbor的机器（本地机器）作如下配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"insecure-registries"</span>: [<span class="string">"harbor.hewentian.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>文件<code>/etc/docker/daemon.json</code>原先可能并不存在，它所有可能的配置，可以参考这里：<br><a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file</a></p>
<p>重启（本地机器）的docker，并重新尝试登录到harbor<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker restart</span><br><span class="line"></span><br><span class="line">$ sudo docker login harbor.hewentian.com -u hewentian</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /home/hewentian/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/<span class="comment">#credentials-store</span></span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure></p>
<h3 id="将本地镜像上传到私有镜像仓库harbor"><a href="#将本地镜像上传到私有镜像仓库harbor" class="headerlink" title="将本地镜像上传到私有镜像仓库harbor"></a>将本地镜像上传到私有镜像仓库harbor</h3><p>上传到私库的命令，和上传到官方仓库的命令差不多，命令如下：</p>
<pre><code>docker push reg.yourdomain.com/myproject/myrepo:mytag
</code></pre><p>先查看本地的所有镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2.1                3712fd008024        8 days ago          64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        10 days ago         91MB</span><br><span class="line">nginx               latest              e445ab08b2be        2 weeks ago         126MB</span><br><span class="line">ubuntu              18.04               3556258649b2        2 weeks ago         64.2MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>例如我们要将<code>ubuntu:18.04</code>上传到harbor<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker push harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line">[sudo] password <span class="keyword">for</span> hewentian: </span><br><span class="line">The push refers to repository [harbor.hewentian.com/hp/ubuntu]</span><br><span class="line">An image does not exist locally with the tag: harbor.hewentian.com/hp/ubuntu</span><br></pre></td></tr></table></figure></p>
<p>可以看到，不能直接上传，要先为待上传的镜像打tag<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker tag ubuntu:18.04 harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY                       TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu                 v2.1                3712fd008024        8 days ago          64.2MB</span><br><span class="line">hewentian/ubuntu                 v2                  2bdf86d10fbc        10 days ago         91MB</span><br><span class="line">nginx                            latest              e445ab08b2be        2 weeks ago         126MB</span><br><span class="line">harbor.hewentian.com/hp/ubuntu   18.04               3556258649b2        2 weeks ago         64.2MB</span><br><span class="line">ubuntu                           18.04               3556258649b2        2 weeks ago         64.2MB</span><br><span class="line">hello-world                      latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp                  latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>从上面可以看到，打tag后的镜像只是原镜像的一个引用，它们的<code>IMAGE ID</code>是一样的。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker push harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line">The push refers to repository [harbor.hewentian.com/hp/ubuntu]</span><br><span class="line">b079b3fa8d1b: Pushed </span><br><span class="line">a31dbd3063d7: Pushed </span><br><span class="line">c56e09e1bd18: Pushed </span><br><span class="line">543791078bdb: Pushed </span><br><span class="line">18.04: digest: sha256:d91842ef309155b85a9e5c59566719308fab816b40d376809c39cf1cf4de3c6a size: 1152</span><br></pre></td></tr></table></figure></p>
<p>上传成功。同样在浏览器上面，也可以看到，已经成功上传了。</p>
<p><img src="/img/harbor-push-image-1.png" alt="" title="harbor 查看镜像"></p>
<p><img src="/img/harbor-push-image-2.png" alt="" title="harbor 查看镜像"></p>
<h3 id="从harbor下载镜像"><a href="#从harbor下载镜像" class="headerlink" title="从harbor下载镜像"></a>从harbor下载镜像</h3><p>先将本地的镜像删掉<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker rmi harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line">Untagged: harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line">Untagged: harbor.hewentian.com/hp/ubuntu@sha256:d91842ef309155b85a9e5c59566719308fab816b40d376809c39cf1cf4de3c6a</span><br><span class="line"></span><br><span class="line">$ sudo docker rmi ubuntu:18.04</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu    v2.1                3712fd008024        8 days ago          64.2MB</span><br><span class="line">hewentian/ubuntu    v2                  2bdf86d10fbc        10 days ago         91MB</span><br><span class="line">nginx               latest              e445ab08b2be        2 weeks ago         126MB</span><br><span class="line">hello-world         latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp     latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<p>然后从harbor下载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line">18.04: Pulling from hp/ubuntu</span><br><span class="line">7413c47ba209: Pull complete </span><br><span class="line">0fe7e7cbb2e8: Pull complete </span><br><span class="line">1d425c982345: Pull complete </span><br><span class="line">344da5c95cec: Pull complete </span><br><span class="line">Digest: sha256:d91842ef309155b85a9e5c59566719308fab816b40d376809c39cf1cf4de3c6a</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line">harbor.hewentian.com/hp/ubuntu:18.04</span><br><span class="line"></span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY                       TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hewentian/ubuntu                 v2.1                3712fd008024        8 days ago          64.2MB</span><br><span class="line">hewentian/ubuntu                 v2                  2bdf86d10fbc        10 days ago         91MB</span><br><span class="line">nginx                            latest              e445ab08b2be        2 weeks ago         126MB</span><br><span class="line">harbor.hewentian.com/hp/ubuntu   18.04               3556258649b2        2 weeks ago         64.2MB</span><br><span class="line">hello-world                      latest              fce289e99eb9        7 months ago        1.84kB</span><br><span class="line">training/webapp                  latest              6fae60ef3446        4 years ago         349MB</span><br></pre></td></tr></table></figure></p>
<h3 id="查看harbor进程状态"><a href="#查看harbor进程状态" class="headerlink" title="查看harbor进程状态"></a>查看harbor进程状态</h3><p>harbor的日志默认存放在<code>/var/log/harbor</code>，如果有下列哪个服务不是<code>Up</code>状态，可以查看相关日志<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker-compose ps</span><br><span class="line">[sudo] password <span class="keyword">for</span> hadoop: </span><br><span class="line">      Name                     Command                  State                 Ports          </span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">harbor-core         /harbor/start.sh                 Up (healthy)                            </span><br><span class="line">harbor-db           /entrypoint.sh postgres          Up (healthy)   5432/tcp                 </span><br><span class="line">harbor-jobservice   /harbor/start.sh                 Up                                      </span><br><span class="line">harbor-log          /bin/sh -c /usr/<span class="built_in">local</span>/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal       nginx -g daemon off;             Up (healthy)   80/tcp                   </span><br><span class="line">nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;80/tcp       </span><br><span class="line">redis               docker-entrypoint.sh redis ...   Up             6379/tcp                 </span><br><span class="line">registry            /entrypoint.sh /etc/regist ...   Up (healthy)   5000/tcp                 </span><br><span class="line">registryctl         /harbor/start.sh                 Up (healthy)</span><br></pre></td></tr></table></figure></p>
<h3 id="harbor生命周期管理"><a href="#harbor生命周期管理" class="headerlink" title="harbor生命周期管理"></a>harbor生命周期管理</h3><p>可以使用<code>docker-compose</code>命令来启动、停止harbor<br>停止harbor：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker-compose stop</span><br><span class="line"></span><br><span class="line">Stopping nginx             ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-jobservice ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-portal     ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-core       ... <span class="keyword">done</span></span><br><span class="line">Stopping registry          ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-db         ... <span class="keyword">done</span></span><br><span class="line">Stopping registryctl       ... <span class="keyword">done</span></span><br><span class="line">Stopping redis             ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-log        ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>启动harbor：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker-compose start</span><br><span class="line"></span><br><span class="line">Starting <span class="built_in">log</span>         ... <span class="keyword">done</span></span><br><span class="line">Starting registry    ... <span class="keyword">done</span></span><br><span class="line">Starting registryctl ... <span class="keyword">done</span></span><br><span class="line">Starting postgresql  ... <span class="keyword">done</span></span><br><span class="line">Starting core        ... <span class="keyword">done</span></span><br><span class="line">Starting portal      ... <span class="keyword">done</span></span><br><span class="line">Starting redis       ... <span class="keyword">done</span></span><br><span class="line">Starting jobservice  ... <span class="keyword">done</span></span><br><span class="line">Starting proxy       ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>参考文献：<br><a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a><br><a href="https://blog.docker.com/" target="_blank" rel="noopener">https://blog.docker.com/</a><br><a href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a></p>
<h3 id="将宿主机的文件复制到容器里面"><a href="#将宿主机的文件复制到容器里面" class="headerlink" title="将宿主机的文件复制到容器里面"></a>将宿主机的文件复制到容器里面</h3><pre><code>sudo docker cp /data.txt containerID:/
</code></pre><p>注意：一定要指定复制到的目录位置</p>
<p>未完待续……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2019/07/26/docker-note/" data-id="clf9thvks000d6h3kt7mrczdd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/12/30/scala-note/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          scala 学习笔记
        
      </div>
    </a>
  
  
    <a href="/2019/06/10/nginx-note/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">nginx 学习笔记</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/container/">container</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web-server/">web server</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/03/07/xxl-job-note/">xxl-job 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/11/28/seata-note/">seata 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/09/25/spring-note/">spring 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/04/01/mybatis-note/">mybatis 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/01/22/canal-note/">canal 学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<!-- <script src="//code.jquery.com/jquery-2.2.4.min.js"></script> -->
<script src="/js/jquery-3.5.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>