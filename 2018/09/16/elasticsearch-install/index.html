<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>elasticsearch 的安装 | Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="单节点的安装本文将说下elasticsearch的单节点安装，我的机器为Ubuntu 18.04 LTS，当前用户为hadoop 首先，我们要将elasticsearch安装包下载回来，截止本文写时，它的最新版本为8.4.0，可以在它的官网下载。 123456789$ cd /home/hadoop/$ wget https://artifacts.elastic.co/downloads/ela">
<meta name="keywords" content="elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch 的安装">
<meta property="og:url" content="https://github.com/hewentian/2018/09/16/elasticsearch-install/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="单节点的安装本文将说下elasticsearch的单节点安装，我的机器为Ubuntu 18.04 LTS，当前用户为hadoop 首先，我们要将elasticsearch安装包下载回来，截止本文写时，它的最新版本为8.4.0，可以在它的官网下载。 123456789$ cd /home/hadoop/$ wget https://artifacts.elastic.co/downloads/ela">
<meta property="og:locale" content="en-US">
<meta property="og:updated_time" content="2023-03-15T02:36:27.690Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="elasticsearch 的安装">
<meta name="twitter:description" content="单节点的安装本文将说下elasticsearch的单节点安装，我的机器为Ubuntu 18.04 LTS，当前用户为hadoop 首先，我们要将elasticsearch安装包下载回来，截止本文写时，它的最新版本为8.4.0，可以在它的官网下载。 123456789$ cd /home/hadoop/$ wget https://artifacts.elastic.co/downloads/ela">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-elasticsearch-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/16/elasticsearch-install/" class="article-date">
  <time datetime="2018-09-16T03:18:34.000Z" itemprop="datePublished">2018-09-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      elasticsearch 的安装
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="单节点的安装"><a href="#单节点的安装" class="headerlink" title="单节点的安装"></a>单节点的安装</h3><p>本文将说下<code>elasticsearch</code>的单节点安装，我的机器为<code>Ubuntu 18.04 LTS</code>，当前用户为<code>hadoop</code></p>
<p>首先，我们要将<code>elasticsearch</code>安装包下载回来，截止本文写时，它的最新版本为<code>8.4.0</code>，可以在它的<a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="noopener">官网</a>下载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/</span><br><span class="line">$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.0-linux-x86_64.tar.gz</span><br><span class="line">$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.0-linux-x86_64.tar.gz.sha512</span><br><span class="line"></span><br><span class="line">验证下载文件的完整性</span><br><span class="line">$ sha512sum -c elasticsearch-8.4.0-linux-x86_64.tar.gz.sha512</span><br><span class="line">elasticsearch-8.4.0-linux-x86_64.tar.gz: OK</span><br><span class="line"></span><br><span class="line">$ tar -xzf elasticsearch-8.4.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>对<code>elasticsearch</code>进行设置（目前是单节点，所以也可以不对<code>elasticsearch.yml</code>进行设置，可直接跳过）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/config</span><br><span class="line">$ vi elasticsearch.yml 		     <span class="comment"># 增加下面的配置</span></span><br><span class="line"></span><br><span class="line">cluster.name: hewentian-cluster	 <span class="comment"># 配置集群的名字</span></span><br><span class="line">node.name: node-1		         <span class="comment"># 配置集群下的节点的名字</span></span><br><span class="line"></span><br><span class="line">network.host: 192.168.56.113	 <span class="comment"># 设置本机IP地址，这里可不设置，但是在集群环境中必须设置。如果在这里指定了IP，则localhost可能无法使用，这个要注意</span></span><br><span class="line"></span><br><span class="line">http.port: 9200			         <span class="comment"># 默认也是这个端口</span></span><br><span class="line"></span><br><span class="line">下面的配置保持默认即可，它会将数据和日志保存到elasticsearch-8.4.0目录下的data和logs目录</span><br><span class="line"><span class="comment">#path.data: /path/to/data</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Path to log files:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#path.logs: /path/to/logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cluster.initial_master_nodes: ["node-1"]  # 启动后，这个会自动产生</span></span><br></pre></td></tr></table></figure></p>
<p>内存大小的设置，根据机器内存大小而设置，一般不超过系统总内存的一半：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/config</span><br><span class="line">$ vi jvm.options</span><br><span class="line"></span><br><span class="line">-Xms1g</span><br><span class="line">-Xmx1g</span><br></pre></td></tr></table></figure></p>
<p><strong>Do not modify the root jvm.options file. Use files in jvm.options.d/ instead.</strong></p>
<p>To configure the heap size, add the Xms and Xmx JVM arguments to a custom JVM options file with the extension <code>.options</code> and store it in the <code>jvm.options.d/</code> directory. For example, to set the maximum heap size to 2GB, set both Xms and Xmx to 2g:<br>-Xms2g<br>-Xmx2g</p>
<p><strong>cluster.initial_master_nodes</strong><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.5/modules-discovery-settings.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/8.5/modules-discovery-settings.html</a></p>
<p>(Static) Sets the initial set of master-eligible nodes in a brand-new cluster. By default this list is empty, meaning that this node expects to join a cluster that has already been bootstrapped. Remove this setting once the cluster has formed. Do not use this setting when restarting nodes or when adding new nodes to an existing cluster.</p>
<h3 id="修改linux系统参数"><a href="#修改linux系统参数" class="headerlink" title="修改linux系统参数"></a>修改linux系统参数</h3><p>你在安装的过程中，有可能会遇到下面的问题之一：</p>
<pre><code>bootstrap check failure [1] of [2]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]
bootstrap check failure [2] of [2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]
</code></pre><p>解决方法如下，就算它不报上面的错误，我们也应该根据机器的性能，对下面的选项作相应配置（下面是根据我机器的情况作的配置）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ su root			            <span class="comment"># 必须在 root 下才有权限修改系统配置文件</span></span><br><span class="line">Password: </span><br><span class="line">$ vi /etc/security/limits.conf	<span class="comment"># 添加如下配置</span></span><br><span class="line">* soft nofile 65536             <span class="comment"># 上面第一个错误有提示</span></span><br><span class="line">* hard nofile 131072            <span class="comment"># 一般为 soft nofile 的2倍</span></span><br><span class="line">* soft nproc 4096               <span class="comment"># 这个设置线程数</span></span><br><span class="line">* hard nproc 8192</span><br><span class="line"></span><br><span class="line">$ vi /etc/sysctl.conf		    <span class="comment"># 添加如下配置</span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"></span><br><span class="line">$ sysctl -p			            <span class="comment"># 最后执行这个命令，你会见到如下输出</span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">exit</span>				            <span class="comment"># 退出 root</span></span><br></pre></td></tr></table></figure></p>
<p>设置好之后，要重新登录，才会生效。</p>
<h3 id="启动elasticsearch"><a href="#启动elasticsearch" class="headerlink" title="启动elasticsearch"></a>启动elasticsearch</h3><p>注意，不能以root帐号启动elasticsearch。要用普通用户，并且要以 sudo 方式启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/</span><br><span class="line">$ sudo su hadoop</span><br><span class="line">$ ./bin/elasticsearch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">✅ Elasticsearch security features have been automatically configured!</span><br><span class="line">✅ Authentication is enabled and cluster connections are encrypted.</span><br><span class="line"></span><br><span class="line">ℹ️  Password <span class="keyword">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class="line">  wnh=7lOdD*uF=TpYny2x</span><br><span class="line"></span><br><span class="line">ℹ️  HTTP CA certificate SHA-256 fingerprint:</span><br><span class="line">  da2e917d8c6cf3b1d32068092cff23985ad4fcc0c1eb0e6a215744ca6f1cc4e4</span><br><span class="line"></span><br><span class="line">ℹ️  Configure Kibana to use this cluster:</span><br><span class="line">• Run Kibana and click the configuration link <span class="keyword">in</span> the terminal when Kibana starts.</span><br><span class="line">• Copy the following enrollment token and paste it into Kibana <span class="keyword">in</span> your browser (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjQuMCIsImFkciI6WyIxOTIuMTY4LjU2LjExMzo5MjAwIl0sImZnciI6ImRhMmU5MTdkOGM2Y2YzYjFkMzIwNjgwOTJjZmYyMzk4NWFkNGZjYzBjMWViMGU2YTIxNTc0NGNhNmYxY2M0ZTQiLCJrZXkiOiI1Z3lUdDRJQnVuYXpXOHNIdFFYUjpNZzdYSzRlLVFTbUxCQnVOQm5qNXhRIn0=</span><br><span class="line"></span><br><span class="line">ℹ️ Configure other nodes to join this cluster:</span><br><span class="line">• Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjQuMCIsImFkciI6WyIxOTIuMTY4LjU2LjExMzo5MjAwIl0sImZnciI6ImRhMmU5MTdkOGM2Y2YzYjFkMzIwNjgwOTJjZmYyMzk4NWFkNGZjYzBjMWViMGU2YTIxNTc0NGNhNmYxY2M0ZTQiLCJrZXkiOiI1d3lUdDRJQnVuYXpXOHNIdFFYazpoRzBUVzlwZVE4eWtJLW5Sdll0ZGFRIn0=</span><br><span class="line"></span><br><span class="line">  If you<span class="string">'re running in Docker, copy the enrollment token and run:</span></span><br><span class="line"><span class="string">  `docker run -e "ENROLLMENT_TOKEN=&lt;token&gt;" docker.elastic.co/elasticsearch/elasticsearch:8.4.0`</span></span><br></pre></td></tr></table></figure>
<p>You can complete the following actions at any time:<br>Reset the password of the elastic built-in superuser with<br>‘bin/elasticsearch-reset-password -u elastic’.</p>
<p>Generate an enrollment token for Kibana instances with<br>‘bin/elasticsearch-create-enrollment-token -s kibana’.</p>
<p>Generate an enrollment token for Elasticsearch nodes with<br>‘bin/elasticsearch-create-enrollment-token -s node’.</p>
<p>我们也可以在启动的时候加上参数<code>-d</code>，以后台运行方式启动：<code>./bin/elasticsearch -d -p pid</code>，进程id将会记录在<code>$ES_HOME</code>目录下，相应的停止命令为：<code>pkill -F pid</code>。</p>
<p>这样单节点版本的<code>elasticsearch</code>就安装完了。</p>
<h3 id="检查elasticsearch是否正确启动"><a href="#检查elasticsearch是否正确启动" class="headerlink" title="检查elasticsearch是否正确启动"></a>检查elasticsearch是否正确启动</h3><p>使用命令<br>        curl –cacert $ES_HOME/config/certs/http_ca.crt -u elastic <a href="https://localhost:9200" target="_blank" rel="noopener">https://localhost:9200</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ curl --cacert /home/hadoop/elasticsearch-8.4.0/config/certs/http_ca.crt -u elastic https://192.168.56.113:9200</span><br><span class="line">Enter host password <span class="keyword">for</span> user <span class="string">'elastic'</span>:</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"node-1"</span>,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"hewentian-cluster"</span>,</span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"XnyeZ-UQSWmyocWOUSgyKA"</span>,</span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"8.4.0"</span>,</span><br><span class="line">    <span class="string">"build_flavor"</span> : <span class="string">"default"</span>,</span><br><span class="line">    <span class="string">"build_type"</span> : <span class="string">"tar"</span>,</span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"f56126089ca4db89b631901ad7cce0a8e10e2fe5"</span>,</span><br><span class="line">    <span class="string">"build_date"</span> : <span class="string">"2022-08-19T19:23:42.954591481Z"</span>,</span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"9.3.0"</span>,</span><br><span class="line">    <span class="string">"minimum_wire_compatibility_version"</span> : <span class="string">"7.17.0"</span>,</span><br><span class="line">    <span class="string">"minimum_index_compatibility_version"</span> : <span class="string">"7.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你见到上面的输出，证明安装成功了。</p>
<h3 id="安装kibana"><a href="#安装kibana" class="headerlink" title="安装kibana"></a>安装kibana</h3><p>kibana的版本，要和elasticsearch的版本一致，我们都下载<code>8.4.0</code>，可以在它的<a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="noopener">官网</a>下载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/</span><br><span class="line">$ wget https://artifacts.elastic.co/downloads/kibana/kibana-8.4.0-linux-x86_64.tar.gz</span><br><span class="line">$ wget https://artifacts.elastic.co/downloads/kibana/kibana-8.4.0-linux-x86_64.tar.gz.sha512</span><br><span class="line"></span><br><span class="line">验证下载文件的完整性</span><br><span class="line">$ sha512sum -c kibana-8.4.0-linux-x86_64.tar.gz.sha512</span><br><span class="line">kibana-8.4.0-linux-x86_64.tar.gz: OK</span><br><span class="line"></span><br><span class="line">$ tar -xzf kibana-8.4.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>配置kibana<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vi /home/hadoop/kibana-8.4.0/config/kibana.yml</span><br><span class="line"></span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">"192.168.56.113"</span></span><br></pre></td></tr></table></figure></p>
<p>启动 Kibana<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ /home/hadoop/kibana-8.4.0/</span><br><span class="line">$ ./bin/kibana</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2022-08-20T07:33:26.679+08:00][INFO ][node] Kibana process configured with roles: [background_tasks, ui]</span><br><span class="line">[2022-08-20T07:33:36.041+08:00][INFO ][http.server.Preboot] http server running at http://192.168.56.113:5601</span><br><span class="line">[2022-08-20T07:33:36.141+08:00][INFO ][plugins-system.preboot] Setting up [1] plugins: [interactiveSetup]</span><br><span class="line">[2022-08-20T07:33:36.144+08:00][INFO ][preboot] <span class="string">"interactiveSetup"</span> plugin is holding setup: Validating Elasticsearch connection configuration…</span><br><span class="line">[2022-08-20T07:33:36.214+08:00][INFO ][root] Holding setup until preboot stage is completed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i Kibana has not been configured.</span><br><span class="line"></span><br><span class="line">Go to http://192.168.56.113:5601/?code=299251 to get started.</span><br></pre></td></tr></table></figure></p>
<p>也可以以后台方式启动kibana：<code>nohup ./bin/kibana 2&gt;&amp;1 &amp;</code></p>
<p>打开 Kibana</p>
<ol>
<li>在浏览器打开<code>http://192.168.56.113:5601</code>，输入Enrollment token即可连接到 Elasticsearch。</li>
<li>如果token过期，则要进入<code>$ES_HOME</code>目录，使用命令<code>bin/elasticsearch-create-enrollment-token -s kibana</code>重新生成一个token。</li>
<li>用新生成的 token 粘贴到 kibana 页面上，此时kibana后台会产生一个验证码，类似：Your verification code is:  952 566，在页面上输入。</li>
<li>最后，输入elasticsearch的用户名、密码，即可登录到kibana。</li>
</ol>
<p>登录 Kibana 后，点击左则菜单的”Dev Tools”，即可以打开搜索的窗口。</p>
<h3 id="集群的安装"><a href="#集群的安装" class="headerlink" title="集群的安装"></a>集群的安装</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.4/add-elasticsearch-nodes.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/8.4/add-elasticsearch-nodes.html</a></p>
<p>我们将安装3个节点的集群。在3个节点上面，都要<code>修改linux系统参数</code>，具体设置方式见上面单节点安装。</p>
<p>我们将上面已经安装好的单节点，作为我们集群的第一个节点。然后，我们在另外两台机器上面，分别安装elasticsearch。</p>
<p>在<code>192.168.56.112</code>上面安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/</span><br><span class="line">$ tar -xzf elasticsearch-8.4.0-linux-x86_64.tar.gz</span><br><span class="line">$ vi elasticsearch-8.4.0/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">cluster.name: hewentian-cluster</span><br><span class="line">node.name: node-2</span><br><span class="line"></span><br><span class="line">network.host: 192.168.56.112</span><br><span class="line">http.port: 9200</span><br><span class="line"></span><br><span class="line"><span class="comment">#transport.host    # Defaults to the address given by network.host</span></span><br><span class="line"><span class="comment">#transport.port    # Defaults to 9300-9400</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#discovery.seed_hosts: ["192.168.56.111", "192.168.56.112", "192.168.56.113"]  # 这个不用配置，会自动产生</span></span><br><span class="line"><span class="comment">#cluster.initial_master_nodes: ["node-1", "node-2", "node-3"]</span></span><br></pre></td></tr></table></figure></p>
<p>内存大小的设置，参考上面单节点安装。</p>
<p>到<code>192.168.56.113</code>节点上面的elasticsearch安装目录生成一个新的token：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/</span><br><span class="line">$ ./bin/elasticsearch-create-enrollment-token -s node</span><br></pre></td></tr></table></figure></p>
<p>然后回到我们准备安装的新节点，启动elasticsearch，将<code>&lt;enrollment-token&gt;</code>替换成上面产生的token：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/</span><br><span class="line">$ ./bin/elasticsearch --enrollment-token &lt;enrollment-token&gt;</span><br></pre></td></tr></table></figure></p>
<p>启动后，会自动在<code>/home/hadoop/elasticsearch-8.4.0/config</code>目前下生成一个<code>certs</code>目录，这个目录中的证书和<code>192.168.56.113</code>上的是一样的。</p>
<p>验证安装是否成功：<br>        curl –cacert /home/hadoop/elasticsearch-8.4.0/config/certs/http_ca.crt -u elastic <a href="https://192.168.56.112:9200" target="_blank" rel="noopener">https://192.168.56.112:9200</a></p>
<p>将上面的安装步骤，在<code>192.168.56.111</code>上面安装也执行一次。到此，集群安装完毕。</p>
<p>查看集群状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/health</span><br><span class="line"></span><br><span class="line">GET _cat/nodes</span><br></pre></td></tr></table></figure></p>
<p>重启集群步骤：</p>
<ol>
<li><p>Disable shard allocation.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;persistent&quot;: &#123;</span><br><span class="line">    &quot;cluster.routing.allocation.enable&quot;: &quot;primaries&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Stop indexing and perform a flush.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /_flush</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启所有节点，重启节点的时候使用<code>./bin/elasticsearch</code>就可以了，不用再带<code>&lt;enrollment-token&gt;</code>参数。</p>
</li>
<li><p>Re-enable allocation.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;persistent&quot;: &#123;</span><br><span class="line">    &quot;cluster.routing.allocation.enable&quot;: null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>删除节点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /_cluster/voting_config_exclusions?node_names=node_name</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">POST /_cluster/voting_config_exclusions?node_names=node-3</span><br></pre></td></tr></table></figure></p>
<p>删除的节点重启后，会自动重新加入集群的。</p>
<h3 id="安装ik分词和pinyin分词"><a href="#安装ik分词和pinyin分词" class="headerlink" title="安装ik分词和pinyin分词"></a>安装ik分词和pinyin分词</h3><p>下载和elasticsearch版本对应的ik分词和pinyin分词，下载地址如下：<br><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a><br><a href="https://github.com/medcl/elasticsearch-analysis-pinyin/releases">https://github.com/medcl/elasticsearch-analysis-pinyin/releases</a></p>
<p>这里下载了 elasticsearch-analysis-ik-8.4.0.zip、elasticsearch-analysis-pinyin-8.4.0.zip，安装方式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/plugins</span><br><span class="line">$ mkdir ik pinyin</span><br><span class="line">$</span><br><span class="line">$ <span class="built_in">cd</span> /home/hadoop/</span><br><span class="line">$ unzip -d /home/hadoop/elasticsearch-8.4.0/plugins/ik/ elasticsearch-analysis-ik-8.4.0.zip</span><br><span class="line">$ unzip -d /home/hadoop/elasticsearch-8.4.0/plugins/pinyin/ elasticsearch-analysis-pinyin-8.4.0.zip</span><br></pre></td></tr></table></figure></p>
<p>重启elasticsearch<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hadoop/elasticsearch-8.4.0/</span><br><span class="line">$ pkill -F pid</span><br><span class="line">$ ./bin/elasticsearch -d -p pid</span><br></pre></td></tr></table></figure></p>
<p>查看已经安装的插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd /home/hadoop/elasticsearch-8.4.0</span><br><span class="line">$ ./bin/elasticsearch-plugin list</span><br><span class="line">ik</span><br><span class="line">pinyin</span><br></pre></td></tr></table></figure></p>
<p>由上面的输出可知，安装成功。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2018/09/16/elasticsearch-install/" data-id="clf9thvke00066h3kjey49lkm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/09/18/elasticsearch-note/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          elasticsearch 学习笔记
        
      </div>
    </a>
  
  
    <a href="/2018/09/12/redis-note/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">redis 学习笔记</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/container/">container</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web-server/">web server</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/03/07/xxl-job-note/">xxl-job 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/11/28/seata-note/">seata 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/09/25/spring-note/">spring 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/04/01/mybatis-note/">mybatis 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/01/22/canal-note/">canal 学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<!-- <script src="//code.jquery.com/jquery-2.2.4.min.js"></script> -->
<script src="/js/jquery-3.5.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>