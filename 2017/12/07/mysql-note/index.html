<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>mysql 学习笔记 | Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="mysql 查询重复数据1234SELECT user_name, COUNT(*) AS c FROM user_table GROUP BY user_name HAVING c &amp;gt; 1; 当查询几个列的组合的时候，可以这样1234SELECT CONCAT(first_name, &apos;_&apos;, last_name) AS user_name, COUNT(*) AS c FROM user">
<meta name="keywords" content="mysql">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql 学习笔记">
<meta property="og:url" content="https://github.com/hewentian/2017/12/07/mysql-note/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="mysql 查询重复数据1234SELECT user_name, COUNT(*) AS c FROM user_table GROUP BY user_name HAVING c &amp;gt; 1; 当查询几个列的组合的时候，可以这样1234SELECT CONCAT(first_name, &apos;_&apos;, last_name) AS user_name, COUNT(*) AS c FROM user">
<meta property="og:locale" content="en-US">
<meta property="og:updated_time" content="2021-04-19T01:52:35.056Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mysql 学习笔记">
<meta name="twitter:description" content="mysql 查询重复数据1234SELECT user_name, COUNT(*) AS c FROM user_table GROUP BY user_name HAVING c &amp;gt; 1; 当查询几个列的组合的时候，可以这样1234SELECT CONCAT(first_name, &apos;_&apos;, last_name) AS user_name, COUNT(*) AS c FROM user">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-mysql-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/07/mysql-note/" class="article-date">
  <time datetime="2017-12-07T02:26:13.000Z" itemprop="datePublished">2017-12-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/db/">db</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mysql 学习笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="mysql-查询重复数据"><a href="#mysql-查询重复数据" class="headerlink" title="mysql 查询重复数据"></a>mysql 查询重复数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_name, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> c </span><br><span class="line"><span class="keyword">FROM</span> user_table </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_name </span><br><span class="line"><span class="keyword">HAVING</span> c &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>当查询几个列的组合的时候，可以这样<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(first_name, <span class="string">'_'</span>, last_name) <span class="keyword">AS</span> user_name, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> c </span><br><span class="line"><span class="keyword">FROM</span> user_table </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_name </span><br><span class="line"><span class="keyword">HAVING</span> c &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>当使用<code>CONCAT(str1,str2,...)</code>函数的时候，只要有一个参数为<code>NULL</code>，则整个结果为<code>NULL</code>，而有时候这不是我们所想要的结果，这时候，我们可以使用<code>IFNULL(expr1,expr2)</code>函数来做一个转换，当<code>expr1</code>为<code>NULL</code>的时候，表达式的结果为<code>expr2</code>，否则为<code>expr1</code>，示例如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONCAT('Tim', ' ', 'Ho') FROM DUAL; # Tim Ho</span><br><span class="line">SELECT IFNULL(NULL, 'expr2') FROM DUAL;    # expr2</span><br><span class="line">SELECT IFNULL('expr1', 'expr2') FROM DUAL; # expr1</span><br></pre></td></tr></table></figure></p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>显示索引信息：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> tableName;</span><br></pre></td></tr></table></figure></p>
<p>创建索引，语法一：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tableName <span class="keyword">ADD</span> <span class="keyword">INDEX</span> indexName(columnName);</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>创建索引，语法二：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> indexName <span class="keyword">ON</span> tableName(columnName(<span class="keyword">length</span>));</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_sex <span class="keyword">ON</span> t_user(sex);</span><br></pre></td></tr></table></figure></p>
<p>如果是CHAR，VARCHAR类型，length可以小于字段实际长度或者省略；如果是BLOB和TEXT类型，必须指定length。</p>
<p>创建索引，语法三：<br>创建表的时候直接指定<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tableName (</span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">columnName <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="keyword">INDEX</span> [indexName] (columnName(<span class="keyword">length</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>删除索引：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> [indexName] <span class="keyword">ON</span> tableName;</span><br></pre></td></tr></table></figure></p>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>创建索引，语法一：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tableName <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> [indexName] (columnName)</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> index_name (<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>创建索引，语法二：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> indexName <span class="keyword">ON</span> tableName(columnName(<span class="keyword">length</span>))</span><br><span class="line"></span><br><span class="line">eg: <span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> t_user(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>表<code>t_user</code>结构如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Field        Type          Collation        Null    Key     Default            Extra           Privileges                       <span class="keyword">Comment</span></span><br><span class="line"><span class="comment">-----------  ------------  ---------------  ------  ------  -----------------  --------------  -------------------------------  ----------------------</span></span><br><span class="line"><span class="keyword">id</span>           <span class="built_in">int</span>(<span class="number">11</span>)       (<span class="literal">NULL</span>)           <span class="keyword">NO</span>      PRI     (<span class="literal">NULL</span>)             auto_increment  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  用户<span class="keyword">ID</span></span><br><span class="line">login_name   <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  <span class="keyword">NO</span>              (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  登录名</span><br><span class="line">passwd       <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  <span class="keyword">NO</span>              (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  登录密码</span><br><span class="line">nick_name    <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  别名</span><br><span class="line">gender       tinyint(<span class="number">4</span>)    (<span class="literal">NULL</span>)           YES             <span class="number">1</span>                                  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  性别：<span class="number">1.</span>男；<span class="number">2.</span>女</span><br><span class="line">phone        <span class="built_in">varchar</span>(<span class="number">20</span>)   utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  手机号码</span><br><span class="line">address      <span class="built_in">varchar</span>(<span class="number">255</span>)  utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  地址</span><br><span class="line">create_time  <span class="keyword">timestamp</span>     (<span class="literal">NULL</span>)           YES             <span class="keyword">CURRENT_TIMESTAMP</span>                  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  创建时间</span><br><span class="line">update_time  <span class="keyword">timestamp</span>     (<span class="literal">NULL</span>)           YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  修改时间</span><br></pre></td></tr></table></figure></p>
<p>给 login_name 和 phone 添加联合唯一约束<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (login_name, phone);</span><br></pre></td></tr></table></figure></p>
<p>你也可以在创建唯一约束的时候，给唯一约束起名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_login_name_phone`</span> (login_name, phone);</span><br></pre></td></tr></table></figure></p>
<p>查看结果：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'用户ID'</span>,</span><br><span class="line">  <span class="string">`login_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'登录名'</span>,</span><br><span class="line">  <span class="string">`passwd`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'登录密码'</span>,</span><br><span class="line">  <span class="string">`nick_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'别名'</span>,</span><br><span class="line">  <span class="string">`gender`</span> tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'性别：1.男；2.女'</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'手机号码'</span>,</span><br><span class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'地址'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'修改时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_login_name_phone`</span> (<span class="string">`login_name`</span>,<span class="string">`phone`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure></p>
<p>删除唯一约束:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">DROP</span> <span class="keyword">INDEX</span> uk_login_name_phone;</span><br></pre></td></tr></table></figure></p>
<h3 id="LIMIT-语句"><a href="#LIMIT-语句" class="headerlink" title="LIMIT 语句"></a>LIMIT 语句</h3><p>取得某一范围的记录集。如前5条、第5到第10条，数据分页等。LIMIT写在查询语句的最后位置上。</p>
<pre><code>语法：
SELECT * FROM tableName LIMIT 长度;
SELECT * FROM tableName LIMIT 起始位置, 长度;
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">2</span> <span class="keyword">LIMIT</span> <span class="number">5</span>;     // 前5条记录</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">2</span> <span class="keyword">LIMIT</span> <span class="number">5</span>, <span class="number">10</span>; // 第5条记录之后的前10条记录，不包括第5条记录</span><br></pre></td></tr></table></figure>
<h3 id="MySQL中GROUP-CONCAT函数"><a href="#MySQL中GROUP-CONCAT函数" class="headerlink" title="MySQL中GROUP_CONCAT函数"></a>MySQL中GROUP_CONCAT函数</h3><p><a href="https://www.mysqltutorial.org/mysql-group_concat/" target="_blank" rel="noopener">https://www.mysqltutorial.org/mysql-group_concat/</a></p>
<p>完整的语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT(</span><br><span class="line">    DISTINCT expression</span><br><span class="line">    ORDER BY expression</span><br><span class="line">    SEPARATOR sep</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>基本查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> aa;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| id| name |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|1 | 10|</span><br><span class="line">|1 | 20|</span><br><span class="line">|1 | 20|</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 200 |</span><br><span class="line">|3 | 500 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，逗号分隔(默认)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(name) |</span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">|1 | 10,20,20|</span><br><span class="line">|2 | 20 |</span><br><span class="line">|3 | 200,500|</span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，分号分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">name</span> separator <span class="string">';'</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(name separator ';') |</span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">|1 | 10;20;20 |</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 200;500 |</span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把去冗余的name字段的值打印在一行，逗号分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">distinct</span> <span class="keyword">name</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(distinct name) |</span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">|1 | 10,20|</span><br><span class="line">|2 | 20 |</span><br><span class="line">|3 | 200,500 |</span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，逗号分隔，以name排倒序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">GROUP_CONCAT</span>(<span class="keyword">name</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">DESC</span>) <span class="keyword">FROM</span> aa <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">| id| GROUP_CONCAT(name ORDER BY name DESC) |</span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">|1 | 20,20,10 |</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 500,200|</span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="GROUP-CONCAT使用及报错分析"><a href="#GROUP-CONCAT使用及报错分析" class="headerlink" title="GROUP_CONCAT使用及报错分析"></a>GROUP_CONCAT使用及报错分析</h3><p>函数GROUP_CONCAT，但在使用时，结果报了如下错误。</p>
<pre><code>ERROR 1260 (HY000): Row 17 was cut by GROUP_CONCAT()
</code></pre><p>原因：GROUP_CONCAT截断了结果，GROUP_CONCAT有个最大长度的限制，超过最大长度就会被截断掉。可以用下面命令查看其内存限制。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @@global.group_concat_max_len;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">| @@global.group_concat_max_len |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">|                      1024     |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>1024这就是一般MySQL系统默认的最大长度，解决限制方法有二：<br>方法一：在MySQL配置文件中加上<br>group_concat_max_len = 102400 #你要的最大长度</p>
<p>方法二：可以简单一点，执行语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> group_concat_max_len=<span class="number">102400</span>;</span><br></pre></td></tr></table></figure></p>
<p>我是用方法一解决的</p>
<h3 id="对连接要注意的事项"><a href="#对连接要注意的事项" class="headerlink" title="对连接要注意的事项"></a>对连接要注意的事项</h3><p>当用多个值连接起来产生一个MD5值、或其他用于确定唯一性的时候，几个值之间一定要加分隔符，否则不同记录可能会产生一样的MD5值。如下表：</p>
<pre><code>NAME    AGE    FAMLY_NUM
张三    51     5
李四    5      15
</code></pre><p>如果用AGE， FAMLY_NUM来产生一个MD5值来唯一确定这一条记录，在它们之间一定要加分隔符，否则连接结果都是515</p>
<h3 id="mysql禁用root远程登录"><a href="#mysql禁用root远程登录" class="headerlink" title="mysql禁用root远程登录"></a>mysql禁用root远程登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM mysql.user WHERE User=<span class="string">'root'</span> AND Host NOT IN (<span class="string">'localhost'</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>);</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h3 id="创建数据库用户并授权"><a href="#创建数据库用户并授权" class="headerlink" title="创建数据库用户并授权"></a>创建数据库用户并授权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> bfg_user <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'gXk9IDpybrJPVMKq'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="comment">-- GRANT ALL PRIVILEGES ON *.* TO 'bfg_user'@'%';</span></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>在MYSQL中用<code>数据库管理员</code>用户创建了一个db，其他MYSQL用户是暂时看不到的，除非得到<code>数据库管理员</code>用户的授权<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> bfg_db <span class="keyword">COLLATE</span> = <span class="string">'utf8mb4_general_ci'</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = <span class="string">'utf8mb4'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> bfg_db.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'gXk9IDpybrJPVMKq'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> bfg_db.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'gXk9IDpybrJPVMKq'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="查看用户的权限"><a href="#查看用户的权限" class="headerlink" title="查看用户的权限"></a>查看用户的权限</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW GRANTS;</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">| Grants for canal@%                                                        |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">| <span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'canal'</span>@<span class="string">'%'</span> |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h3><p>删除数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> databaseName;</span><br></pre></td></tr></table></figure></p>
<p>显示所有数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>;</span><br></pre></td></tr></table></figure></p>
<p>进入某一个数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> databaseName;</span><br></pre></td></tr></table></figure></p>
<p>显示所有表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br></pre></td></tr></table></figure></p>
<p>查看指定表的结构<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC tableName;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql添加、删除主键"><a href="#mysql添加、删除主键" class="headerlink" title="mysql添加、删除主键"></a>mysql添加、删除主键</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">添加自增长的主键id</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">删除自增长的主键id，先删除自增长，再删除主键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>); //删除自增长</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>; //删除主建</span><br></pre></td></tr></table></figure>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>创建插入记录的存储过程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE IF EXISTS `proc_insert_student`$$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE `proc_insert_student`(_sname VARCHAR(20), _sex TINYINT(4), _age INT)</span><br><span class="line">BEGIN</span><br><span class="line">    INSERT INTO student(sname, sex, age) VALUES(_sname, _sex, _age);</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>创建统计数据的存储过程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE IF EXISTS `proc_count_student`$$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE `proc_count_student`(OUT cs INT)</span><br><span class="line">BEGIN</span><br><span class="line">    # CALL proc_count_student(@cs)</span><br><span class="line">    SELECT COUNT(*) INTO cs FROM student;</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>查看数据库中的存储过程<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW PROCEDURE STATUS;</span><br><span class="line">+<span class="comment">--------+---------------------+-----------+------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| Db     | Name                | Type      | Definer    | Modified            | Created             | Security_type | <span class="keyword">Comment</span> | character_set_client | collation_connection | <span class="keyword">Database</span> <span class="keyword">Collation</span> |</span><br><span class="line">+<span class="comment">--------+---------------------+-----------+------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| bfg_db | proc_count_student  | <span class="keyword">PROCEDURE</span> | bfg_user@% | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">33</span>:<span class="number">15</span> | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">33</span>:<span class="number">15</span> | DEFINER       |         | utf8                 | utf8_general_ci      | utf8_general_ci    |</span><br><span class="line">| bfg_db | proc_insert_student | <span class="keyword">PROCEDURE</span> | bfg_user@% | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">38</span> | <span class="number">2019</span><span class="number">-10</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">38</span> | DEFINER       |         | utf8                 | utf8_general_ci      | utf8_general_ci    |</span><br><span class="line">+<span class="comment">--------+---------------------+-----------+------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-删除记录"><a href="#mysql-删除记录" class="headerlink" title="mysql 删除记录"></a>mysql 删除记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="mysql-仅保留-1000-条记录而删除其他记录"><a href="#mysql-仅保留-1000-条记录而删除其他记录" class="headerlink" title="mysql 仅保留 1000 条记录而删除其他记录"></a>mysql 仅保留 1000 条记录而删除其他记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">求取总记录数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> tb_name;</span><br><span class="line"></span><br><span class="line">删除部分记录</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tb_name <span class="keyword">LIMIT</span> 总记录数<span class="number">-1000</span></span><br><span class="line"></span><br><span class="line">例如，比如一个表有 <span class="number">10000</span> 条记录，现想保留 <span class="number">1000</span> 条数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tb_name <span class="keyword">LIMIT</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>
<h3 id="mysql查找删除重复数据并只保留一条"><a href="#mysql查找删除重复数据并只保留一条" class="headerlink" title="mysql查找删除重复数据并只保留一条"></a>mysql查找删除重复数据并只保留一条</h3><p>有表数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | age  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | zhang |   21 |</span><br><span class="line">|    2 | li    |   22 |</span><br><span class="line">|    3 | zhang |   23 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>从上面可知，name字段有两条相同的记录zhang，我们要删除重复记录，保存id最小的一条<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    t_user </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    <span class="keyword">name</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t1.name <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> t_user <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span>) t1 ) </span><br><span class="line">    <span class="keyword">AND</span> </span><br><span class="line">    <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t2.id <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>) <span class="keyword">id</span> <span class="keyword">FROM</span> t_user <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span>) t2 );</span><br><span class="line"></span><br><span class="line">然后再执行查询语句：</span><br><span class="line">mysql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | age  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | zhang |   21 |</span><br><span class="line">|    2 | li    |   22 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可知，id为3的记录已经被删掉了。</p>
<h3 id="MySQL中CHAR和VARCHAR的区别"><a href="#MySQL中CHAR和VARCHAR的区别" class="headerlink" title="MySQL中CHAR和VARCHAR的区别"></a>MySQL中CHAR和VARCHAR的区别</h3><table>
<thead>
<tr>
<th style="text-align:left">CHAR</th>
<th style="text-align:left">VARCHAR</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">全称是 CHARACTER</td>
<td style="text-align:left">全称是 VARIABLE CHARACTER</td>
</tr>
<tr>
<td style="text-align:left">存储固定长度的数据，如果不足，会用空格补全，读取的时候可能会调用trim()</td>
<td style="text-align:left">按数据的实际长度存储，不会用空格补全</td>
</tr>
<tr>
<td style="text-align:left">占空间大</td>
<td style="text-align:left">占空间小</td>
</tr>
<tr>
<td style="text-align:left">最大能存储255个字符</td>
<td style="text-align:left">最大能存储65535个字符</td>
</tr>
<tr>
<td style="text-align:left">静态内存分配</td>
<td style="text-align:left">动态内存分配</td>
</tr>
<tr>
<td style="text-align:left">索引效率高</td>
<td style="text-align:left">索引效率没CHAR高</td>
</tr>
</tbody>
</table>
<p><strong>VARCHAR存储的实际长度是它的值的长度+1，多出的这一个用于保存它实际使用了多大的长度。</strong></p>
<h3 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h3><p>语法一，会复制完整的表结构（包括索引、主键等），但不包括数据：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tableName_new <span class="keyword">LIKE</span> tableName_old;</span><br></pre></td></tr></table></figure></p>
<p>语法二，只会复制简单的表结构（不包括索引、主键等），但可以包括数据（根据FROM后的WHERE条件）：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tableName_new <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tableName_old;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-修改字段定义"><a href="#mysql-修改字段定义" class="headerlink" title="mysql 修改字段定义"></a>mysql 修改字段定义</h3><p>下面的关键字<code>COLUMN</code>是可以省略的：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [表名] <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> [字段名] [类型];</span><br><span class="line"></span><br><span class="line">示例: sys_user表里的user_name字段，由原来长度是10个字符，修改改成40个字符</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> user_name <span class="built_in">VARCHAR</span>(<span class="number">40</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-修改字段名"><a href="#mysql-修改字段名" class="headerlink" title="mysql 修改字段名"></a>mysql 修改字段名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [表名] <span class="keyword">CHANGE</span> [旧字段名] [新字段名] [类型];</span><br><span class="line"></span><br><span class="line">示例: sys_user表里的user_name字段，修改改成user_name_new</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">CHANGE</span> user_name user_name_new <span class="built_in">VARCHAR</span>(<span class="number">40</span>);</span><br></pre></td></tr></table></figure>
<h3 id="mysql-增加列（字段）"><a href="#mysql-增加列（字段）" class="headerlink" title="mysql 增加列（字段）"></a>mysql 增加列（字段）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [表名] <span class="keyword">ADD</span> [列名] [列类型] [其他属性，如默认值];</span><br><span class="line"></span><br><span class="line">示例: sys_user表增加一个地址列，长度为200个字符，默认值为null</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">ADD</span> address <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">ADD</span> address <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">AFTER</span> age;</span><br><span class="line"></span><br><span class="line">可以一次增加多个列：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sys_user <span class="keyword">ADD</span> (</span><br><span class="line">  sex <span class="built_in">VARCHAR</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="string">'男'</span>,</span><br><span class="line">  tel <span class="built_in">VARCHAR</span>(<span class="number">11</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">如果新增加的列有默认值，则SQL执行后，该新增的列会自动获得该值。</span><br></pre></td></tr></table></figure>
<h3 id="mysql-删除列（字段）"><a href="#mysql-删除列（字段）" class="headerlink" title="mysql 删除列（字段）"></a>mysql 删除列（字段）</h3><p>语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tableName <span class="keyword">DROP</span> columnName;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-删除表"><a href="#mysql-删除表" class="headerlink" title="mysql 删除表"></a>mysql 删除表</h3><p>语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> tableName;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-分组统计"><a href="#mysql-分组统计" class="headerlink" title="mysql 分组统计"></a>mysql 分组统计</h3><p>表结构和数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>, </span><br><span class="line"><span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">salary <span class="built_in">INT</span>,</span><br><span class="line">birthday <span class="keyword">TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (1, "a", 4000, STR_TO_DATE("2018-01-25 09:30:05","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (2, "a", 2000, STR_TO_DATE("2018-01-25 09:30:14","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (3, "a", 3000, STR_TO_DATE("2018-01-25 09:30:10","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (4, "b", 6000, STR_TO_DATE("2018-01-25 09:30:29","%Y-%m-%d %h:%i:%s"));</span><br><span class="line">sql&gt; INSERT INTO t_user(id, name, salary, birthday) VALUES (5, "b", 5000, STR_TO_DATE("2018-01-25 09:30:24","%Y-%m-%d %h:%i:%s"));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  1 | a    |   4000 | 2018-01-25 09:30:05 |</span><br><span class="line">|  2 | a    |   2000 | 2018-01-25 09:30:14 |</span><br><span class="line">|  3 | a    |   3000 | 2018-01-25 09:30:10 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">|  5 | b    |   5000 | 2018-01-25 09:30:24 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>按用户名分组，查询salary最大的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; SELECT id, name, MAX(salary) FROM t_user GROUP BY name;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----+------+-------------+</span></span><br><span class="line">| id | name | MAX(salary) |</span><br><span class="line">+<span class="comment">----+------+-------------+</span></span><br><span class="line">|  1 | a    |        4000 |</span><br><span class="line">|  4 | b    |        6000 |</span><br><span class="line">+<span class="comment">----+------+-------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">sql &gt; SELECT * FROM (SELECT * FROM t_user ORDER BY salary DESC) t GROUP BY t.name;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  1 | a    |   4000 | 2018-01-25 09:30:05 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>按用户名分组，取生日最小的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; SELECT * FROM (SELECT * FROM t_user ORDER BY birthday DESC) t GROUP BY t.name;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  2 | a    |   2000 | 2018-01-25 09:30:14 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="MySQL数据库备份和还原常用的命令"><a href="#MySQL数据库备份和还原常用的命令" class="headerlink" title="MySQL数据库备份和还原常用的命令"></a>MySQL数据库备份和还原常用的命令</h3><h4 id="一、备份命令"><a href="#一、备份命令" class="headerlink" title="一、备份命令"></a>一、备份命令</h4><p>如果只需要导出表的结构,可以使用mysqldump的<code>-d</code>选项<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、备份MySQL数据库的命令，备份指定的整个库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename &gt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">2、备份MySQL数据库为带删除表的格式，能够让该备份覆盖已有数据库而不需要手动删除原有数据库</span><br><span class="line">mysqldump <span class="comment">--add-drop-table -hhostname -uusername -ppassword databasename &gt; ~/backupfile.sql</span></span><br><span class="line"></span><br><span class="line">3、直接将MySQL数据库压缩备份</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename | gzip &gt; ~/backupfile.sql.gz</span><br><span class="line"></span><br><span class="line">4、备份MySQL数据库某个(些)表</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename specific_table1 [specific_table2] &gt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">5、同时备份多个MySQL数据库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword <span class="comment">--databases databasename1 databasename2 databasename3 &gt; ~/multibackupfile.sql</span></span><br><span class="line"></span><br><span class="line">6、仅仅备份数据库结构</span><br><span class="line">mysqldump -hhostname -uusername -ppassword -d <span class="comment">--databases databasename1 databasename2 databasename3 &gt; ~/structurebackupfile.sql</span></span><br><span class="line"></span><br><span class="line">7、备份服务器上所有数据库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword <span class="comment">--all-databases &gt; ~/allbackupfile.sql</span></span><br><span class="line"></span><br><span class="line">8、备份MySQL数据库某个表中指定条件的数据</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename specific_table1 <span class="comment">--where='age &gt; 10' &gt; ~/backupfile.sql</span></span><br></pre></td></tr></table></figure></p>
<h4 id="二、还原命令"><a href="#二、还原命令" class="headerlink" title="二、还原命令"></a>二、还原命令</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、还原MySQL数据库的命令</span><br><span class="line">mysql -hhostname -uusername -ppassword databasename &lt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">2、还原压缩的MySQL数据库</span><br><span class="line">gunzip &lt; ~/backupfile.sql.gz | mysql -uusername -ppassword databasename</span><br><span class="line"></span><br><span class="line">3、将数据库转移到新服务器</span><br><span class="line">mysqldump -uusername -ppassword databasename | mysql -host=*.*.*.* -C databasename</span><br></pre></td></tr></table></figure>
<h3 id="SELECT-INTO"><a href="#SELECT-INTO" class="headerlink" title="SELECT INTO"></a>SELECT INTO</h3><p>除此之外，你还可以使用<code>SELECT INTO</code>命令来导出数据，它与mysqldump的区别是：</p>
<ol>
<li>mysqldump: 导出的文本包括了数据库的结构和记录；</li>
<li>SELECT INTO: 导出的文本只有记录，并且，一般要数据库的管理员帐号，例如root才能执行；</li>
</ol>
<p>SELECT INTO 有两种使用方式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line">mysql&gt; SELECT * FROM t_user INTO OUTFILE 't_user.txt';</span><br><span class="line">Query OK, 2 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line">mysql&gt; SELECT * INTO OUTFILE 't_user.txt' FROM t_user;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>导出的数据一般在数据库的安装目录下，你也可以使用<code>find / -name t_user.txt</code>来查找到</p>
<h3 id="ERROR-3-HY000-Error-writing-file-‘-tmp-MYeaZGpS’-Errcode-28-No-space-left-on-device"><a href="#ERROR-3-HY000-Error-writing-file-‘-tmp-MYeaZGpS’-Errcode-28-No-space-left-on-device" class="headerlink" title="ERROR 3 (HY000): Error writing file ‘/tmp/MYeaZGpS’ (Errcode: 28 - No space left on device)"></a>ERROR 3 (HY000): Error writing file ‘/tmp/MYeaZGpS’ (Errcode: 28 - No space left on device)</h3><p>根据提示，是说mysql中/tmp使用的磁盘空间不足。<br>在MYSQL命令行下执行：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE 'tmpdir';</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| tmpdir        | /tmp  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可以看到MYSQL的tmpdir是使用/tmp这个临时目录的，使用<code>df -h</code>看下/tmp的空间，确实不足。我们修改tmpdir所指定的目录，我们在空间比较大的分区上面建一个目录。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/data</span><br><span class="line">$ mkdir mysqltmp</span><br><span class="line">$ chmod a+w mysqltmp</span><br></pre></td></tr></table></figure></p>
<p>然后修改my.cnf配置文件在其中修改tmpdir<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ whereis my.cnf</span><br><span class="line">$ <span class="built_in">cd</span> &#123;my.cnf所在的目录&#125;</span><br><span class="line">$ vi my.cnf</span><br><span class="line"></span><br><span class="line">修改的内容如下</span><br><span class="line">tmpdir = /opt/data/mysqltmp</span><br></pre></td></tr></table></figure></p>
<p>重启mysql<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /etc/init.d/mysqld restart    <span class="comment"># 不同Linux系统，命令可能不同</span></span><br></pre></td></tr></table></figure></p>
<p>在MYSQL命令行中查看下是否生效<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE 'tmpdir';</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">| Variable_name | Value              |</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">| tmpdir        | /opt/data/mysqltmp |</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>问题解决。</p>
<h3 id="读一致性"><a href="#读一致性" class="headerlink" title="读一致性"></a>读一致性</h3><p>mysql有一个表，有1000W条记录。在9:00的时候A用户对表进行查询，查询需10分钟才能完成，表没索引，FULL SCAN，表中某条记录的值为100。在9:05分的时候B对表进行了UPDATE操作，将记录的值修改为200。那么在9:10的时候，A获致到的是100还是200？结果是100。因为这是读一致性的问题，在A查的时候，它看到的是整个表在那一刻的快照的数据，返回的是那一刻的结果。不过，它有可能会抛出 snapshot too old 这个异常。</p>
<h3 id="mysql-修改表名"><a href="#mysql-修改表名" class="headerlink" title="mysql 修改表名"></a>mysql 修改表名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name RENAME TO new_table_name;</span><br></pre></td></tr></table></figure>
<h3 id="INSERT-INTO插入数据"><a href="#INSERT-INTO插入数据" class="headerlink" title="INSERT INTO插入数据"></a>INSERT INTO插入数据</h3><p>如果不指定插入的列名，则VALUES的值必须与表的所有列名一一对应<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'Scott'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user <span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'Scott'</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user <span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'Scott'</span>, <span class="number">20</span>), (<span class="literal">NULL</span>, <span class="string">'tiger'</span>, <span class="number">21</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="MYSQL插入数据时忽略重复数据的方法"><a href="#MYSQL插入数据时忽略重复数据的方法" class="headerlink" title="MYSQL插入数据时忽略重复数据的方法"></a>MYSQL插入数据时忽略重复数据的方法</h3><p>使用<code>IGNORE</code>关键字，示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT IGNORE INTO tableName(column_list)</span><br><span class="line">VALUES (value_list),</span><br><span class="line">       (value_list),</span><br><span class="line">       ...</span><br></pre></td></tr></table></figure></p>
<h3 id="将一个数据库中的表导入到另一个数据库中的表"><a href="#将一个数据库中的表导入到另一个数据库中的表" class="headerlink" title="将一个数据库中的表导入到另一个数据库中的表"></a>将一个数据库中的表导入到另一个数据库中的表</h3><p>将数据库A中的表a的数据导入到数据库B中的表b中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT [IGNORE] INTO 数据库B.`表名b` SELECT * FROM 数据库A.`表名a`;</span><br><span class="line">INSERT [IGNORE] INTO 数据库B.`表名b` SELECT col1, col2, col3 FROM 数据库A.`表名a`;</span><br><span class="line">INSERT [IGNORE] INTO 数据库B.`表名b`(col1, col2, col3) SELECT col1, col2, col3 FROM 数据库A.`表名a`;</span><br></pre></td></tr></table></figure></p>
<h3 id="MySQL千万级数据快速分页"><a href="#MySQL千万级数据快速分页" class="headerlink" title="MySQL千万级数据快速分页"></a>MySQL千万级数据快速分页</h3><p>数据量少的时候，可以这样写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName ORDER BY id LIMIT 1000, 10;</span><br></pre></td></tr></table></figure></p>
<p>但在数据量达到百万级，甚至千万级的时候，这样写会慢死：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName ORDER BY id LIMIT 1000000, 10;</span><br></pre></td></tr></table></figure></p>
<p>可能耗费几十秒，网上有很多优化的方法是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName WHERE id &gt;= (SELECT id FROM tableName LIMIT 1000000, 1) LIMIT 10;</span><br></pre></td></tr></table></figure></p>
<p>是的，速度提升到0.x秒了，看样子还行。但，还不是完美的！下面这句才是完美的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName WHERE id BETWEEN 1000000 AND 1000010;</span><br></pre></td></tr></table></figure></p>
<p>比上面那句，还要再快5至10倍</p>
<p>另外，如果需要查询<code>id</code>不是连续的一段，最佳的方法就是先找出<code>id</code>，然后用<code>IN</code>查询，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tableName WHERE id IN (10000, 100000, 1000000, ...);</span><br></pre></td></tr></table></figure></p>
<p>如果查询的字段是一较长字符串的时候，表设计时要为该字段多加一个字段。如，存储网址的字段，查询的时候，不要直接查询该字符串，这样效率低下，应该查询该字符串的CRC32或MD5。</p>
<h3 id="mysql-查询一个字符串字段最长的一条记录"><a href="#mysql-查询一个字符串字段最长的一条记录" class="headerlink" title="mysql 查询一个字符串字段最长的一条记录"></a>mysql 查询一个字符串字段最长的一条记录</h3><p>参考：<a href="http://stackoverflow.com/questions/2357620/maxlengthfield-in-mysql" target="_blank" rel="noopener">http://stackoverflow.com/questions/2357620/maxlengthfield-in-mysql</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, LENGTH(name)</span><br><span class="line">FROM my_table</span><br><span class="line">WHERE LENGTH(name) = (SELECT MAX(LENGTH(name)) FROM my_table);</span><br></pre></td></tr></table></figure></p>
<h3 id="skip-grant-tables-参数的使用"><a href="#skip-grant-tables-参数的使用" class="headerlink" title="skip-grant-tables 参数的使用"></a>skip-grant-tables 参数的使用</h3><p>这是个非常有用的mysql启动参数</p>
<p>在my.cnf文件中增加一行：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure></p>
<p>或者以命令行参数启动mysql：</p>
<pre><code>/usr/bin/mysqld_safe --skip-grant-tables &amp;
</code></pre><p>登陆mysql修改管理员密码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line">UPDATE user SET password=password(&apos;root&apos;) WHERE user=&apos;root&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">EXIT;</span><br></pre></td></tr></table></figure></p>
<p>重启mysql</p>
<h3 id="DELETE和TRUNCATE的区别"><a href="#DELETE和TRUNCATE的区别" class="headerlink" title="DELETE和TRUNCATE的区别"></a>DELETE和TRUNCATE的区别</h3><p>TRUNCATE TABLE 属于DDL，它虽然和对整张表执行DELETE操作产生的效果差不多，但是它是不能回滚的。</p>
<h3 id="三大范式"><a href="#三大范式" class="headerlink" title="三大范式"></a>三大范式</h3><p>第一范式(1NF)：在关系模式R中的每一个具体关系r，必须要有主键，并且每个属性值都是不可再分的最小数据单位，则称R是第一范式的关系；<br>第二范式(2NF)：如果关系模式R中的所有非主属性都完全依赖于主关键字，则称关系R是属于第二范式的；<br>第三范式(3NF)：关系模式R中的非主关键字不能依赖于其他非主关键字。即非主关键字之间不能有函数（传递）依赖关系，则称关系R是属于第三范式的。</p>
<h3 id="VARCHAR类型的说明"><a href="#VARCHAR类型的说明" class="headerlink" title="VARCHAR类型的说明"></a>VARCHAR类型的说明</h3><p>在官方手册中，VARCHAR类型最大支持65535，单位是字节，但实际上。在创建表的时候VARCHAR(N)中的N，指的是字符的长度。但是，如果表的字符集不同，能支持的最大长度也不同。</p>
<ol>
<li>表的CHARSET=latin1时，能使用VARCHAR(65532)；</li>
<li>表的CHARSET=GBK时，能使用VARCHAR(32767)；</li>
<li>表的CHARSET=UTF8，能使用VARCHAR(21845)；</li>
<li>如果表的SQL_MODE为非严格模式，则表的CHARSET=latin1时，或者能使用VARCHAR(65535)成功创建表，但是可能会有warning。warning可能是数据库将那列自动转换为TEXT类型了；</li>
<li>还有一个需要注意的地方是，65535长度是指表中所有VARCHAR列的长度总和。如果列的长度总和超出这个限制，依然无法创建表。</li>
</ol>
<h3 id="CHAR类型的说明"><a href="#CHAR类型的说明" class="headerlink" title="CHAR类型的说明"></a>CHAR类型的说明</h3><p>CHAR(N)中的N指的是字符，对于多字节字符编码的CHAR数据类型，在InnoDB存储引擎中，会将其视为变长类型。对于未能占满长度的字符，还是填充<code>0X20</code>，也即是空格。</p>
<p>在多字节字符集的情况下，CHAR和VARCHAR的实际行存储基本是没有区别的。</p>
<h3 id="强制使用索引"><a href="#强制使用索引" class="headerlink" title="强制使用索引"></a>强制使用索引</h3><p>在查询的过程中可以使用<code>FORCE INDEX</code>来强制查询优化器使用指定的索引，例如表<code>t_user</code>有索引<code>idx_name</code>，则我们可以这样查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t_user FORCE INDEX(idx_name) WHERE name=&apos;Tim&apos; AND age=22;</span><br></pre></td></tr></table></figure></p>
<h3 id="索引提示"><a href="#索引提示" class="headerlink" title="索引提示"></a>索引提示</h3><p>在查询的过程中可以使用<code>USE INDEX</code>来显式地告诉查询优化器使用哪个索引，例如表<code>t_user</code>有索引<code>idx_name</code>，则我们可以这样查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t_user USE INDEX(idx_name) WHERE name=&apos;Tim&apos; AND age=22;</span><br></pre></td></tr></table></figure></p>
<p>主要在以下2种情况下要使用索引提示：</p>
<ol>
<li>MYSQL数据库的优化器错误地选择了某个索引，导致SQL语句运行得很慢；</li>
<li>某SQL语句可以选择的索引非常多，优化器选择执行计划时间的开销大于SQL语句本身。</li>
</ol>
<p><code>USE INDEX</code>只是告诉优化器可以选择该索引，但实际上优化器可能还是会再根据自已的判断进行选择，除非使用<code>FORCE INDEX</code>。</p>
<p>对数据库执行了一个删除操作，实际上并不会删除索引中的数据，相反还会在对应的DELETED表中插入记录，因此随着应用程序的运行，索引会变得非常大。即使索引中的有些数据已经被删除，查询也不会选择这类记录。InnoDb存储引擎，可以在必要时手动将已经删除的记录在索引中删除，命令是 OPTIMIZE TABLE。它还会对Cardinality进行统计，因此可以关闭它的统计。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL innodb_optimize_fulltext_only=1;</span><br><span class="line">mysql&gt; OPTIMIZE TABLE table_name;</span><br></pre></td></tr></table></figure></p>
<h3 id="锁问题"><a href="#锁问题" class="headerlink" title="锁问题"></a>锁问题</h3><p>锁问题有三个：</p>
<ol>
<li><p>脏读：首先了解一下脏数据，脏数据是指事务对缓冲池中行记录的修改，并且还没有被提交。如果读到了脏数据，即一个事务可以读到另外一个事务中未提交的数据，这显然违反了数据库的隔离性。而对脏页的读取，是非常正常的。脏页是因为数据库实例内存和磁盘的异步造成的，这并不影响数据的一致性，因为内存中的数据最终是要刷新回磁盘的。</p>
</li>
<li><p>不可重复读：在同一个事务中多次读取同一个表，在多次读取之间，还有另外一个事务对该表进行了DML，从而导致多次读取到的数据可能不一致。与脏读的区别是：脏读读取到的是未提交的数据，而不可重复读读到的是已经提交的数据。这违反了数据库事务的一致性。</p>
</li>
<li><p>丢失更新：就是一个事务的更新操作，会被另一个事务的更新操作所覆盖，从而导致数据的不一致。可以将事务的处理模式变成串行的，这样来避免。在更新数据的时候，特别是敏感数据的时候，一定要先加一个排他X锁，这样也方便对帐户余额进行先检查，再更新。而不是仅仅学会了简单的SELECT、UPDATE操作就开始处理数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT cash FROM account WHERE user=&apos;user_name&apos; FOR UPDATE;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="事务的ACID特性"><a href="#事务的ACID特性" class="headerlink" title="事务的ACID特性"></a>事务的ACID特性</h3><pre><code>事务是作为一个逻辑单元执行的一系列操作，一个逻辑工作单元必须有四个属性，
</code></pre><p>称为 ACID（原子性、一致性、隔离性和持久性）属性，只有这样才能成为一个事务。</p>
<p>原子性（Atomicity）<br>整个事务中的所有操作，要么全部成功执行，要么全部失败。</p>
<p>一致性（Consistency）<br>事务提交前后，表的所有约束条件都保持完好。对表的修改符合所有的Keys、数据类型、Checks和触发器的约束，没有约束被破坏。</p>
<p>隔离性（Isolation）<br>一个事务，无法访问到另一个事务未提交的数据。</p>
<p>持久性（Durability）<br>事务成功执行后，对数据的修改会持久保存在数据库中，不会被回滚，就算系统死机。</p>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p>对于InnoDB存储引擎而言，它默认的事务隔离级别为REPEATABLE READ，完全遵循和满足事务的ACID特性。而Oracle、sqlServer则是READ COMMITTED。</p>
<p>SQL标准定义了4个隔离级别：<br>READ UNCOMMITTED：会出现脏读、不可重复读、幻读（隔离级别最低，并发性能高）<br>READ COMMITTED：会出现不可重复读、幻读问题（锁定正在读取的行）<br>REPEATABLE READ：会出幻读（锁定所读取的所有行）<br>SERIALIZABLE：保证所有的情况不会发生（锁表）</p>
<p>可以在数据库启动的时候设置它的默认隔离级别：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">transaction-isolation=READ-COMMITTED</span><br></pre></td></tr></table></figure></p>
<p>查看当前会话的事务隔离级别：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @@tx_isolation;</span><br></pre></td></tr></table></figure></p>
<h3 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h3><p>InnoDB存储引擎提供了对XA事务的支持，并通过XA事务来支持分布式事务的实现。分布式事务指的是允许多个独立的事务资源参与到一个全局的事务中。事务资源通常是关系型数据库系统，但也可以是其他类型的资源。全局事务要求在其中的所有参与事务要么都提交，要么都ROLLBACK，这对于事务原有的ACID要求又有了提高。另外，在使用分布式事务时，InnoDB存储引擎的事务隔离级别必须设置为SERIALIZABLE。<br>XA事务允许不同数据库之间的分布式事务，如一台服务器是MySQL数据库，另一台是Oracle数据库，只要参与在全局事务中的每个节点都支持XA事务。分布式事务可能在银行系统的转帐中比较常见。可以通过变量查看数据库是否启用了XA事务支持（默认为ON）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &apos;innodb_support_xa&apos;;</span><br></pre></td></tr></table></figure></p>
<p>MySQL数据库是自动提交的。当用户显式的使用命令<code>START TRANSACTION</code>或<code>BEGIN</code>来开启一个事务时，MySQL会自动地执行<code>SET AUTOCOMMIT=0</code>命令，并在<code>COMMIT</code>或<code>ROLLBACK</code>结束一个事务后，再执行<code>SET AUTOCOMMIT=1</code>。</p>
<p>对长事务的处理，是将长事务分解为多个小事务来分批处理。在应用程序中，最好是将事务的START TRANSACTION、COMMIT、ROLLBACK操作交给程序端来控制，而不是在存储过程中。</p>
<h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><p>Hot Backup 热备： 在数据库运行中直接备份，对运行中的数据库操作没有任何的影响；<br>Cold Backup 冷备： 在数据库停机状态下进行备份，一般备份数据库的物理文件；<br>Warm Backup 温备：也是在数据库运行中进行备份，但是会对当前的数据库操作有所影响，例如它会加一个全局读锁以保证备份数据的一致性。</p>
<p>对于mysqldump备份工具来说，可以通过添加<code>--single-transaction</code>选项获得InnoDB存储引擎的一致性备份，此时的备份是在一个执行时间很长的事务中完成的。请务必加上此选项。</p>
<p>mysqldump不能导出视图。免费好用的开源热备份工具有XtraBackup。</p>
<h3 id="连接到mysql"><a href="#连接到mysql" class="headerlink" title="连接到mysql"></a>连接到mysql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -h192.168.1.100 -uscoot -p</span><br><span class="line">$ mysql -h192.168.1.100 -uscoot -ptiger</span><br></pre></td></tr></table></figure>
<h3 id="不登录MYSQL来执行查询"><a href="#不登录MYSQL来执行查询" class="headerlink" title="不登录MYSQL来执行查询"></a>不登录MYSQL来执行查询</h3><p>可以在操作系统命令行下通过<code>-e</code>参数实现，例如查询test库下的表t_user：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -h192.168.1.100 -uscoot -ptiger test -e &quot;SELECT * FROM t_user&quot;</span><br><span class="line"></span><br><span class="line">+----+-------+------+</span><br><span class="line">| id | name  | age  |</span><br><span class="line">+----+-------+------+</span><br><span class="line">|  1 | zhang |   21 |</span><br><span class="line">|  2 | zhang |   23 |</span><br><span class="line">|  4 | zhang |   21 |</span><br><span class="line">|  5 | zhang |   21 |</span><br><span class="line">+----+-------+------+</span><br></pre></td></tr></table></figure></p>
<p>说明：</p>
<pre><code>-e, --execute=name  Execute command and quit. (Disables --force and history file.)
</code></pre><h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><p>概述：</p>
<ol>
<li>通过约束可以更好的保证数据表里数据的完整性；</li>
<li>约束是在表上强制执行的数据校验规则，约束主要保证数据的完整性；</li>
<li>当表中的数据存在相互依赖时，可以通过约束保护相关的数据不被删除。</li>
</ol>
<p>MYSQL中支持以下五类约束：</p>
<ol>
<li>NOT NULL：非空约束，指定某列不能为空；</li>
<li>UNIQUE：唯一约束，指定某列或者几列组合不能重复，允许空；</li>
<li>PRIMARY KEY：主键，指定该列的值可以唯一的表示每条记录；</li>
<li>FOREIGN KEY：外键，指定该行记录从属于主表中的一条记录，主要用于保证参照完整性；</li>
<li>CHECK：检查，指定一个布尔表达式，用于指定对应列的值必须满足该表达式。</li>
</ol>
<h3 id="NOT-NULL约束"><a href="#NOT-NULL约束" class="headerlink" title="NOT NULL约束"></a>NOT NULL约束</h3><p>如果我们向NOT NULL的字段插入一下NULL值，MySQL数据库会将其更改为0再进行插入。我们可以通过设置SQL_MODE来严格审核输入参数。<br>所有数据类型值都可以为null，如：int，float等。空字符串不等于null，0也不等于null。</p>
<h3 id="UNIQUE约束"><a href="#UNIQUE约束" class="headerlink" title="UNIQUE约束"></a>UNIQUE约束</h3><p>UNIQUE约束用于保证指定列或指定列的组合不允许出现重复，但可以允许出现多个null值。同一张表内可以建多个UNIQUE约束。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> index_uk <span class="keyword">UNIQUE</span>(<span class="keyword">id</span>, userName)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="PRIMARY-KEY约束"><a href="#PRIMARY-KEY约束" class="headerlink" title="PRIMARY KEY约束"></a>PRIMARY KEY约束</h3><p>主键约束相当于唯一约束和非空约束，每个表中最多允许一个主键。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> index_pk PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="FOREIGN-KEY约束"><a href="#FOREIGN-KEY约束" class="headerlink" title="FOREIGN KEY约束"></a>FOREIGN KEY约束</h3><p>概述：</p>
<ol>
<li>外键约束主要用于保证一个或两个数据表之间的参照完整性，外键构建于一个表的两个字段或者两个表的两个字段之间；</li>
<li>建立外键时mysql也会为该列建立索引；</li>
<li>子表外键列的值必须在主表被参照列值的范围之内，或者为空；</li>
<li>为了保证子表参照的主表存在，通常应先建主表；</li>
<li>使用列级约束语法建立外键约束直接使用<code>REFERENCES</code>关键字。指定该列参照的哪个主表，以及参照主表的哪一列。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> teacher (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  teacher_id <span class="built_in">INT</span>,</span><br><span class="line">  FOREIGN <span class="keyword">KEY</span>(teacher_id) <span class="keyword">REFERENCES</span> teacher(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="CHECK约束"><a href="#CHECK约束" class="headerlink" title="CHECK约束"></a>CHECK约束</h3><p>CHECK约束在建表的列定义后增加逻辑表达式即可。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="built_in">INT</span>,</span><br><span class="line">  <span class="keyword">CHECK</span>(age &gt; <span class="number">0</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>目前所有MYSQL存储引擎并没有实现CHECK约束，也就是说，上面的建表语句正确，但约束无效。<br><a href="https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-indexes-keys" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-indexes-keys</a></p>
<pre><code>The CHECK clause is parsed but ignored by all storage engines.
</code></pre><h3 id="COUNT-1-、COUNT-、COUNT-pk-的区别"><a href="#COUNT-1-、COUNT-、COUNT-pk-的区别" class="headerlink" title="COUNT(1)、COUNT(*)、COUNT(pk)的区别"></a>COUNT(1)、COUNT(*)、COUNT(pk)的区别</h3><p>下面两句产生的结果是一样的:<br>COUNT(*) 统计表中有多少行，包括字段为NULL的行<br>COUNT(1) 统计表中有多少行，包括字段为NULL的行</p>
<p>当pk为主键的时候，因为主键不允许为NULL，所以<br>COUNT(pk) 同样是，统计表中有多少行，包括字段为NULL的行</p>
<p>但是，如果pk代表的字段允许为NULL，那么将产生不同的结果<br>COUNT(pk) 统计表中有多少行，不包括pk为NULL的行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; SELECT * FROM t_user;</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">| id | name | salary | birthday            |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">|  1 | a    |   4000 | 2018-01-25 09:30:05 |</span><br><span class="line">|  2 | a    |   2000 | 2018-01-25 09:30:14 |</span><br><span class="line">|  3 | a    |   3000 | 2018-01-25 09:30:10 |</span><br><span class="line">|  4 | b    |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">|  5 | b    |   5000 | 2018-01-25 09:30:24 |</span><br><span class="line">|  6 | NULL |   6000 | 2018-01-25 09:30:29 |</span><br><span class="line">+<span class="comment">----+------+--------+---------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">sql</span>&gt; <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*), <span class="keyword">COUNT</span>(<span class="number">1</span>), <span class="keyword">COUNT</span>(<span class="keyword">name</span>) <span class="keyword">FROM</span> t_user;</span><br><span class="line">+<span class="comment">----------+----------+-------------+</span></span><br><span class="line">| COUNT(*) | COUNT(1) | COUNT(name) |</span><br><span class="line">+<span class="comment">----------+----------+-------------+</span></span><br><span class="line">|        6 |        6 |           5 |</span><br><span class="line">+<span class="comment">----------+----------+-------------+</span></span><br></pre></td></tr></table></figure>
<p>通常，建议使用COUNT(*)，因为它是SQL推荐的，SQL会自动优化到一个字段。</p>
<p>执行效率：</p>
<ol>
<li>当pk为主键时，COUNT(pk)比COUNT(1)快，否则COUNT(1)比COUNT(pk)快；</li>
<li>当表有多个列时，如果没有主键，则COUNT(1)比COUNT(*)快； 如果有主键，则COUNT(pk)的效率是最优的；</li>
<li>当表只有一个列时，COUNT(*)最优。</li>
</ol>
<h3 id="left-join-right-join-inner-join-join区别"><a href="#left-join-right-join-inner-join-join区别" class="headerlink" title="left join, right join, inner join, join区别"></a>left join, right join, inner join, join区别</h3><p>有如下表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_contact (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'t_user的主键 id'</span>,</span><br><span class="line">  card <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'Scott'</span>),(<span class="number">2</span>, <span class="string">'Tiger'</span>),(<span class="number">3</span>, <span class="string">'Larry'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_contact <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'A'</span>),(<span class="number">1</span>, <span class="string">'B'</span>),(<span class="number">2</span>, <span class="string">'C'</span>),(<span class="number">4</span>, <span class="string">'D'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL [test]&gt; select * from t_user;</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">| id | name  |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">|  1 | Scott |</span><br><span class="line">|  2 | Tiger |</span><br><span class="line">|  3 | Larry |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t_contact;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | card |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  1 | A    |</span><br><span class="line">|  1 | B    |</span><br><span class="line">|  2 | C    |</span><br><span class="line">|  4 | D    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br></pre></td></tr></table></figure></p>
<p>join 查询<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">| id | name  | id | card |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">|  1 | Scott |  1 | A    |</span><br><span class="line">|  1 | Scott |  1 | B    |</span><br><span class="line">|  2 | Tiger |  2 | C    |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br></pre></td></tr></table></figure></p>
<p>inner join 查询<br>只返回两个表中联结字段相等的行<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu inner join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">| id | name  | id | card |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br><span class="line">|  1 | Scott |  1 | A    |</span><br><span class="line">|  1 | Scott |  1 | B    |</span><br><span class="line">|  2 | Tiger |  2 | C    |</span><br><span class="line">+<span class="comment">----+-------+----+------+</span></span><br></pre></td></tr></table></figure></p>
<p>left join 查询<br>返回左表中的所有记录和右表中联结字段相等的记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu left join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">----+-------+------+------+</span></span><br><span class="line">| id | name  | id   | card |</span><br><span class="line">+<span class="comment">----+-------+------+------+</span></span><br><span class="line">|  1 | Scott |    1 | A    |</span><br><span class="line">|  1 | Scott |    1 | B    |</span><br><span class="line">|  2 | Tiger |    2 | C    |</span><br><span class="line">|  3 | Larry | NULL | NULL |</span><br><span class="line">+<span class="comment">----+-------+------+------+</span></span><br></pre></td></tr></table></figure></p>
<p>right join 查询<br>返回右表中的所有记录和左表中联结字段相等的记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]&gt; select * from t_user tu right join t_contact tc on tu.id=tc.id;</span><br><span class="line">+<span class="comment">------+-------+----+------+</span></span><br><span class="line">| id   | name  | id | card |</span><br><span class="line">+<span class="comment">------+-------+----+------+</span></span><br><span class="line">|    1 | Scott |  1 | A    |</span><br><span class="line">|    1 | Scott |  1 | B    |</span><br><span class="line">|    2 | Tiger |  2 | C    |</span><br><span class="line">| NULL | NULL  |  4 | D    |</span><br><span class="line">+<span class="comment">------+-------+----+------+</span></span><br></pre></td></tr></table></figure></p>
<h3 id="查询满足多个属性的产品列表"><a href="#查询满足多个属性的产品列表" class="headerlink" title="查询满足多个属性的产品列表"></a>查询满足多个属性的产品列表</h3><p>像淘宝中搜索满足多个条件的产品列表，准备数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'产品名'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product_property (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">product_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'产品id'</span>,</span><br><span class="line">property_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'属性名'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product(<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'car'</span>),(<span class="number">2</span>,<span class="string">'plane'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product_property(<span class="keyword">id</span>, product_id, property_name)</span><br><span class="line">  <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">'drive'</span>),(<span class="number">2</span>,<span class="number">1</span>,<span class="string">'black'</span>),(<span class="number">3</span>,<span class="number">1</span>,<span class="string">'benz'</span>),(<span class="number">4</span>,<span class="number">2</span>,<span class="string">'fly'</span>),(<span class="number">5</span>,<span class="number">2</span>,<span class="string">'white'</span>),(<span class="number">6</span>,<span class="number">2</span>,<span class="string">'boeing'</span>);</span><br></pre></td></tr></table></figure></p>
<p>匹配一个属性：drive<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> p.product_id <span class="keyword">FROM</span> (</span><br><span class="line">    t_product_property p</span><br><span class="line">  ) <span class="keyword">WHERE</span> p.id = <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>匹配两个属性：drive, black<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> p.product_id <span class="keyword">FROM</span> (</span><br><span class="line">    t_product_property p,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">id</span>, product_id <span class="keyword">FROM</span> t_product_property) p2</span><br><span class="line">  ) <span class="keyword">WHERE</span> p.id = <span class="number">1</span> <span class="keyword">AND</span> p2.id = <span class="number">2</span> <span class="keyword">AND</span> p.product_id = p2.product_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>匹配三个属性:drive, black, benz<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_product <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> p.product_id <span class="keyword">FROM</span> (</span><br><span class="line">    t_product_property p,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">id</span>, product_id <span class="keyword">FROM</span> t_product_property) p2,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">id</span>, product_id <span class="keyword">FROM</span> t_product_property) p3</span><br><span class="line">  ) <span class="keyword">WHERE</span> p.id = <span class="number">1</span> <span class="keyword">AND</span> p2.id = <span class="number">2</span> <span class="keyword">AND</span> p3.id = <span class="number">3</span> <span class="keyword">AND</span> p.product_id = p2.product_id <span class="keyword">AND</span> p.product_id = p3.product_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="命令行连接mysql"><a href="#命令行连接mysql" class="headerlink" title="命令行连接mysql"></a>命令行连接mysql</h3><pre><code>mysql -hip_address -uuser_name -Pport -ppassword db_name
</code></pre><p>如果<code>-p</code>后面的密码中有特殊字符，就要加个<code>\</code>来转义<br>        mysql -h192.168.1.100 -uroot -P3306 -pT3O\$8yKl%aRi user_db</p>
<h3 id="mysql报错ERROR-1064-42000"><a href="#mysql报错ERROR-1064-42000" class="headerlink" title="mysql报错ERROR 1064 (42000)"></a>mysql报错ERROR 1064 (42000)</h3><p>原因是使用了mysql的保留字。如果表的字段使用了mysql的保留字，在查询的时候要用反引号将其引起来。<br>        SELECT * FROM t_user WHERE <code>key</code> = ‘abc’;</p>
<h3 id="mysql-update"><a href="#mysql-update" class="headerlink" title="mysql update"></a>mysql update</h3><p>单表更新语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> [<span class="keyword">LOW_PRIORITY</span>] [<span class="keyword">IGNORE</span>] table_name</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    column_name1 = expr1,</span><br><span class="line">    column_name2 = expr2,</span><br><span class="line">    ...</span><br><span class="line">[<span class="keyword">WHERE</span></span><br><span class="line">    condition];</span><br></pre></td></tr></table></figure></p>
<p>也可以用从其他表SELECT出来的数据来SET值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    column_name1 = (<span class="keyword">SELECT</span> column_name1 <span class="keyword">FROM</span> table_name2 <span class="keyword">WHERE</span> column_name2 = <span class="string">'h'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">RAND</span>() <span class="keyword">LIMIT</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    column_name1 <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure></p>
<p>连表更新语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> T1, T2</span><br><span class="line">[<span class="keyword">INNER</span> <span class="keyword">JOIN</span> | <span class="keyword">LEFT</span> <span class="keyword">JOIN</span>] T1 <span class="keyword">ON</span> T1.C1 = T2. C1</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    T1.C2 = T2.C2,</span><br><span class="line">    T2.C3 = expr</span><br><span class="line"><span class="keyword">WHERE</span> condition</span><br></pre></td></tr></table></figure></p>
<p>示例：<br>Suppose you want to adjust the salary of employees based on their performance.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> merits m <span class="keyword">ON</span> e.performance = m.performance</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    e.salary = e.salary + e.salary * m.percentage;</span><br></pre></td></tr></table></figure></p>
<p>The UPDATE LEFT JOIN  statement basically updates a row in a table when it does not have a corresponding row in another table.</p>
<p>For example, you can increase the salary for a new hire by 1.5%  using the following statement:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> merits m <span class="keyword">ON</span> e.performance = m.performance</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    e.salary = e.salary + e.salary * <span class="number">0.015</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    m.percentage <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="FOREIGN-KEY引用导致无法删表"><a href="#FOREIGN-KEY引用导致无法删表" class="headerlink" title="FOREIGN KEY引用导致无法删表"></a>FOREIGN KEY引用导致无法删表</h3><p>这时候，只要按如下方式删除，即可。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> table_name;</span><br></pre></td></tr></table></figure></p>
<h3 id="对MySQL数据库性能的测试工具"><a href="#对MySQL数据库性能的测试工具" class="headerlink" title="对MySQL数据库性能的测试工具"></a>对MySQL数据库性能的测试工具</h3><p>这里有2款比较好的工具：sysbench和mysql-tpcc</p>
<p>主要测试：<br>CPU性能<br>磁盘IO性能<br>调度程序性能<br>内存分配及传输速度<br>POSIX线程性能<br>数据库OLTP基准测试</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/07/mysql-note/" data-id="ckpo1myxo0031uu3k8fa3ikqh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/08/jdk-install/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          安装 JDK
        
      </div>
    </a>
  
  
    <a href="/2017/12/06/zookeeper-cluster/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">zookeeper 集群版安装方法</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/container/">container</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web-server/">web server</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/01/mybatis-note/">mybatis 学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/01/22/canal-note/">canal 学习笔记</a>
          </li>
        
          <li>
            <a href="/2020/06/08/springboot-note/">springboot 学习笔记</a>
          </li>
        
          <li>
            <a href="/2020/01/14/spark-note/">spark 学习笔记</a>
          </li>
        
          <li>
            <a href="/2019/12/30/scala-note/">scala 学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<!-- <script src="//code.jquery.com/jquery-2.2.4.min.js"></script> -->
<script src="/js/jquery-3.5.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>